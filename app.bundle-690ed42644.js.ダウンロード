(function(_){function c(e){this._element=_(e);this._target=this._element.data("target")||{};this._attachmentSettings=this._element.data("attachmentsettings");this._serviceUrlGet=this._element.attr("data-url-get");this._serviceUrlAdd=this._element.attr("data-url-add");this._serviceUrlEdit=this._element.attr("data-url-edit");this._serviceUrlDelete=this._element.attr("data-url-delete");this._serviceUrlGetAttachments=this._element.attr("data-url-get-attachments");this._serviceUrlGetAttachmentsCount=this._element.attr("data-url-get-attachments-count");this._hideFieldLabel=this._element.attr("data-hide-field-label");this._attachmentAcceptTypes=this._element.attr("data-add-accept-types");this._addEnabled=this._element.data("add-enabled");this._editEnabled=this._element.data("edit-enabled");this._deleteEnabled=this._element.data("delete-enabled");this._isRTEEnabled=this._element.data("rte-enabled");this._isTimeLine=this._element.data("is-timeline");this._pageSize=this._element.attr("data-pagesize");this._orders=this._element.data("orders");this._addSuccess=false;this._editSuccess=false;this._deleteSuccess=false;this._useScrollingPagination=this._element.attr("data-use-scrolling-pagination");this._$editModal=this._element.children(".modal-editnote").appendTo("body");this._$deleteModal=this._element.children(".modal-deletenote").appendTo("body");var a=this;this._pageNumber=1;this._isRequired=this._element.attr("is-required");_(e).on("refresh",function(e,t){if(a._useScrollingPagination=="True"){t=-1}a.load(t)})}c.prototype.render=function(){var e=this;var t=e._element;var a=e._hideFieldLabel==="True"?t.children(".timelineheader").find("a.addnote"):t.children(".note-actions").find("a.addnote");var n=t.children(".modal-addnote").appendTo("body");var i=n.find(".modal-footer .btn-primary");var r=t.children(".note-actions").find(".loadmore");n.find("input[type='file']").val("");if(this._hideFieldLabel==="False"){_(".notes-cell .info").show()}e.load();if(e._addEnabled=="True"){a.show();a.on("click",function(e){e.preventDefault();n.modal("show");n.attr("aria-hidden","false")});i.on("click",function(){e.addNote(n)});n.on("hidden.bs.modal",function(){if(e._isRTEEnabled=="True")_("#pcf_notescontrol").val(JSON.stringify("")).change();else n.find("textarea").val("");n.find("input[type='file']").val("");n.find(".alert-danger.error").remove();n.attr("aria-hidden","true")})}if(this._useScrollingPagination=="True"){r.on("click",function(){e._pageNumber+=1;r.hide();e.load(e._pageNumber)})}};c.prototype.load=function(i,r){var l=this;var o=l._element;var d=o.children(".notes");var s=o.children(".notes-error");var c=o.children(".notes-empty");var f=o.children(".notes-access-denied");var e=o.children(".notes-loading");var t=o.children(".notes-loading-more");var a=o.find(".notes-pagination");var u=o.children(".note-actions").find(".loadmore");var n=l._serviceUrlGet;var p=l._serviceUrlGetAttachments;var v=l._serviceUrlGetAttachmentsCount;var h=l._target;var m=l._orders;var g=l._pageSize;var y=l._useScrollingPagination;s.hide();c.hide();f.hide();if(y=="True"){t.show()}else{d.hide().empty();e.show()}var b=a.data("current-page");if(b==null||b==""){b=1}i=i||b;var C=a.data("pagesize");if(C==null||C==""){C=g}var k=false;if(y=="True"&&i==-1){k=true}l.getData(n,h,m,k?1:i,k?1:C,function(e){if(typeof e===typeof undefined||e===false||e==null){c.fadeIn();return}if(typeof e.Records!==typeof undefined&&e.Records!==false&&(e.Records==null||e.Records.length==0&&i==1)){c.fadeIn();return}if(typeof e.AccessDenied!==typeof undefined&&e.AccessDenied!==false&&e.AccessDenied){f.fadeIn();return}var t=false;if(y=="True"){if(k){if(l._pageNumber*C<e.ItemCount){u.show();t=true}}else if(e.PageCount>l._pageNumber){u.show()}}var a=_("#notes-template").html();Handlebars.registerHelper("AttachmentUrlWithTimeStamp",function(){return this.AttachmentUrl+"?t="+(new Date).getTime()});Handlebars.registerHelper("attachments",function(e,t){var a=(new Date).getTime();var n=_("#notes-attachment-template").html();var r=Handlebars.compile(n);var o={Id:e,LogicalName:t};l.getAttachments(p,o,1,a,v,function(e){var t=_(".attachmentasync-"+a);if(Array.isArray(e)&&e.length>0){if(!t.prev().hasClass("attachment-separator")){t.before("<div class='attachment-separator'></div>")}}else{if(o.LogicalName!=="email"){t.parent().removeClass()}}t.append(r(e))});_(document).on("click",".load-more-attachment-btn",function(e){e.stopImmediatePropagation();e.preventDefault();var a=parseInt(_(this).attr("data-page-id"));var t=_(this).attr("data-attachment-id");var n=parseInt(_(this).attr("data-total-records"));o={Id:_(this).attr("data-activity-id"),LogicalName:_(this).attr("data-logical-name")};if(isNaN(a)||isNaN(n)||t==null||typeof o.Id=="undefined"||typeof o.LogicalName=="undefined")return;var i=_(".attachmentasync-"+t);l.getAttachments(p,o,a,t,v,function(e){if(Array.isArray(e)&&e.length>0){i.append(r(e));var t=i.next();if(a*10<n){t.find(".load-more-attachment-btn").attr("data-page-id",a+1)}else t.hide()}})});return _("<div>").html(_("<div>").attr("class","attachmentasync-"+a+" attachment-loadmore-section")).html()});var n=Handlebars.compile(a);if(y=="True"){if(k){d.prepend(n(e));if(t){d.children(".note").last().remove()}}else{d.append(n(e))}}else{d.html(n(e))}d.find(".timeago").each(function(){var e=_(this).attr("title");var t=window.moment;if(t){var a=dateFormatConverter.convert(o.closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(o.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=a+" "+n;if(t(e).format(i)=="Invalid date"){_(this).text(t(new Date(e.replaceAll(".",":"))).format(i))}else{_(this).text(t(e).format(i))}}});d.find(".timeago").timeago();d.fadeIn();if(y=="False"){l.initializePagination(e,r)}if(l._editEnabled&&l._editEnabled!="False"){l.addEditClickEventHandlers()}if(l._deleteEnabled&&l._deleteEnabled!="False"){l.addDeleteClickEventHandlers()}},function(e,t,a){if(e==null){ClientLogWrapper.getLogger().traceError("EntityNotes getData(): jqXhr is null. Error in getData()","entity_notes","","GetData")}else{var n=e.getResponseHeader("content-type")||"";var i=n.indexOf("json")>-1?e.responseJSON.Message:a;ClientLogWrapper.getLogger().traceError("EntityNotes getData(): Error - "+error,"entity_notes","","GetData");s.find(".details").append(i);s.show()}},function(){e.hide();t.hide()})};c.prototype.getData=function(e,t,a,n,i,r,o,l){r=_.isFunction(r)?r:function(){};o=_.isFunction(o)?o:function(){};l=_.isFunction(l)?l:function(){};var d=portal.IsRequestedFromMaker();if(d){l.call(this);r.call(null);return}if(!e||e==""){l.call(this);o.call(this,null,"error",window.ResourceManager["Service_URL_Not_Provided"]);return}if(!t){l.call(this);o.call(this,null,"error",window.ResourceManager["Required_Regarding_EntityReference_Parameter_Was_Not_Provided"]);return}i=i||-1;var s={};s.regarding=t;s.orders=a;s.page=n;s.pageSize=i;ClientLogWrapper.getLogger().traceInfo("EntityNotes getData(): Getting data","entity_notes","","GetData");var c=JSON.stringify(s);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:c,global:false}).done(r).fail(o).always(l)};c.prototype.getAttachments=function(e,i,r,o,t,a,n,l){a=_.isFunction(a)?a:function(){};n=_.isFunction(n)?n:function(){};l=_.isFunction(l)?l:function(){};if(!e||e==""){l.call(this);n.call(this,null,"error",window.ResourceManager["Service_URL_Not_Provided"]);return}if(!i){l.call(this);n.call(this,null,"error",window.ResourceManager["Required_Regarding_EntityReference_Parameter_Was_Not_Provided"]);return}var d={};d.regarding=i;d.page=r;var s=JSON.stringify(d);ClientLogWrapper.getLogger().traceInfo("EntityNotes getAttachments(): Getting attachments","entity_notes","","GetAttachments");shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:s,success:a,error:n,global:false}).then(function(e){var a=10;if(Array.isArray(e)&&(e.length>=a&&r==1)){var n=_(".attachmentasync-"+o).next();n.show();c.prototype.getTotalRecords(t,i,function(e){if(e>a){var t=n.find(".load-more-attachment-btn");if(typeof t=="undefined"||t==null)return;t.attr("data-total-records",e);t.attr("data-page-id",r+1);t.attr("data-attachment-id",o);t.attr("data-activity-id",i.Id);t.attr("data-logical-name",i.LogicalName)}})}})};c.prototype.getTotalRecords=function(e,t,a,n,i){a=_.isFunction(a)?a:function(){};n=_.isFunction(n)?n:function(){};i=_.isFunction(i)?i:function(){};if(!e||e==""){i.call(this);n.call(this,null,"error",window.ResourceManager["Service_URL_Not_Provided"]);return}if(!t){i.call(this);n.call(this,null,"error",window.ResourceManager["Required_Regarding_EntityReference_Parameter_Was_Not_Provided"]);return}var r={};r.entityReference=t;ClientLogWrapper.getLogger().traceInfo("EntityNotes getTotalRecords(): Getting total records","entity_notes","","GetTotalRecords");var o=JSON.stringify(r);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:o,success:a,error:n,global:false})};c.prototype.addEditClickEventHandlers=function(){var y=this;var e=y._element;var b=y._$editModal;if(!b||b.length==0){return}var C=b.find("input[type='file']");var t=b.find("button.primary");if(C.length>0){C.on("change",function(){b.find(".attachment").remove()})}t.unbind("click");t.on("click",function(e){e.preventDefault();y.updateNote(b)});b.on("hidden.bs.modal",function(){b.find(".alert-danger.error").remove();if(y._isRTEEnabled=="True")_("#pcf_edit_notescontrol").val(JSON.stringify("")).change();else b.find("textarea").val("");b.find("input[type='file']").val("");b.find(".alert-danger.error").remove();b.data("id","");b.find(".attachment").empty();b.attr("aria-hidden","true")});e.find(".edit-link").on("click",function(e){e.preventDefault();var t=_(this).closest(".note");var a=t.data("id");var n=t.data("unformattedtext")||"";var i=t.data("subject")||"";if(i!=null&&i.contains("Note created on")){n=n.replaceAll("<br />","\n")}var r=t.data("isprivate");var o=t.data("hasattachment");var l=t.data("attachmentfilename");var d=t.data("attachmentfilesize");var s=t.data("attachmenturl");var c=t.data("attachmentisimage");if(!a||a==""){if(typeof console!="undefined"&&console){console.log("Failed to launch edit note dialog. Data parameter 'id' is null.")}return}b.attr("aria-hidden","false");b.data("id",a);b.data("subject",i);if(y._isRTEEnabled=="True")_("#pcf_edit_notescontrol").val(JSON.stringify(n)).change();else b.find("textarea").val(n);if(r){b.find("input[type='checkbox']").prop("checked",true)}var f=C.parent();if(o){s+="?t="+(new Date).getTime();var u=b.find(".attachment");if(u.length==0){u=_("<div class='attachment clearfix'></div>")}var p=_("<div class='link'></div>");var v=_("<a target='_blank'></a>").attr("href",s).html("<span class='fa fa-file' aria-hidden='true'></span> "+l+" ("+d+")");p.html(v);if(c){var h=_("<a target='_blank' class='thumbnail'></a>").attr("href",s);var m=_("<img />").attr("src",s);var g=_("<div class='img col-md-4'></div>");g.append(h.html(m));u.html(g).append(p);f.prepend(u)}else{u.html(p);f.prepend(u)}}b.modal()})};c.prototype.addDeleteClickEventHandlers=function(){var i=this;var r=i._element;var o=i._serviceUrlDelete;var l=i._$deleteModal;if(!l||l.length==0){return}l.on("hidden.bs.modal",function(){l.find(".alert-danger.error").remove();l.attr("aria-hidden","true");var e=i._hideFieldLabel==="True"?r.children(".timelineheader").find("a.addnote"):r.children(".note-actions").find("a.addnote");e.focus()});r.find(".delete-link").on("click",function(e){e.preventDefault();var t=_(this).closest(".note");var a=t.data("id");if(!a||a==""){console.log("Failed to launch delete note dialog. Data parameter 'id' is null.");return}l.attr("aria-hidden","false");var n=l.find(".modal-footer button.primary");n.unbind("click");n.on("click",function(){_(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var e={};e.id=a;var t=JSON.stringify(e);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:t}).done(function(){var e=r.children(".notes").find("div.note").length;if(e==1){var t=r.find(".notes-pagination");var a=t.data("current-page");if(a>1){a--;t.data("current-page",a)}}i._deleteSuccess=true;r.trigger("refresh");l.modal("hide")}).fail(function(e){g(d(e),l)}).always(function(){n.prop("disabled",false).find(".fa-spin").remove()})});l.modal()})};c.prototype.addNote=function(n){var e=this;var t=e._element;var a=e._target;var i=e._serviceUrlAdd;var r=this._attachmentAcceptTypes;var o=n.find(".modal-footer button.primary");var l="";if(e._isRTEEnabled=="True")l=_("#pcf_notescontrol").val();else l=n.find("textarea").val();var d=false;if(i==null||i==""){var s={Message:"System Error",InnerError:{Message:window.ResourceManager["URL_Service_For_Add_Note_Request_Could_Not_Determined"]}};g(s,n);return}if(this._isRequired=="true"){if(l==null||!/\S+/gm.test(l)){var c=n.find("#note_label_add");if(c){var f={Message:window.ResourceManager["Required_Field_Error"].replace("{0}",c.text())};g(f,n)}return}}var u=t.attr("disable-validation");if(u=="true"){l=_("<div/>").text(l).html()}var p=n.find("input[type='checkbox']");if(p.length>0){d=p.prop("checked")}var v=n.find("input[type='file']");o.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var h=_("<form>").attr("id","add-note-"+(new Date).getTime()).attr("method","POST").attr("action",i).hide().appendTo(_("body"));_("<input>").attr("name","regardingEntityLogicalName").attr("type","hidden").appendTo(h).val(a.LogicalName);_("<input>").attr("name","regardingEntityId").attr("type","hidden").appendTo(h).val(a.Id);_("<input>").attr("name","text").attr("type","hidden").appendTo(h).val(l);_("<input>").attr("name","isRequired").attr("type","hidden").appendTo(h).val(e._isRequired);_("<input>").attr("name","isPrivate").attr("type","hidden").appendTo(h).val(d);_("<input>").attr("name","attachmentSettings").attr("type","hidden").appendTo(h).val(e._attachmentSettings);if(e._isRTEEnabled=="True")_("<input>").attr("name","isRTEEnabled").attr("type","hidden").appendTo(h).val(true);var m=_("<input>").attr("type","file").attr("name","file").attr("accept",r);if(this._isTimeLine=="True"){m.attr("multiple","multiple").insertAfter(v)}else{m.insertAfter(v)}v.appendTo(h);h.on("submit",function(){ClientLogWrapper.getLogger().traceInfo("EntityNotes addNote(): Form submit","entity_notes","","AddNote");shell.ajaxSafePost({success:function(){e._addSuccess=true;t.trigger("refresh");n.modal("hide");h.remove();o.prop("disabled",false).find(".fa-spin").remove()},error:function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?e.responseJSON.Message:e.statusText;g({Message:a},n);v.insertAfter(m);m.remove();h.remove();o.prop("disabled",false).find(".fa-spin").remove()}},_(this));return false});h.trigger("submit")};c.prototype.updateNote=function(n){var e=this;var t=e._element;var a=e._serviceUrlEdit;var i=n.find(".modal-footer button.primary");var r="";if(e._isRTEEnabled=="True")r=_("#pcf_edit_notescontrol").val();else r=n.find("textarea").val();var o=n.data("subject")||"";var l=false;if(a==null||a==""){var d={Message:"System Error",InnerError:{Message:window.ResourceManager["URL_Service_For_Update_Note_Request_Could_Not_Determined"]}};g(d,n);return}var s=n.data("id");if(!s||s==""){var c={Message:"System Error",InnerError:{Message:window.ResourceManager["Failed_Determine_RecordID"]}};g(c,n);return}if(this._isRequired=="true")if(r==null||!/\S+/gm.test(r)){var f=n.find("#note_label_edit");if(f){var u={Message:window.ResourceManager["Required_Field_Error"].replace("{0}",f.text())};g(u,n)}return}var p=n.find("input[type='checkbox']");if(p.length>0){l=p.prop("checked")}var v=n.find("input[type='file']");i.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var h=_("<form>").attr("id","update-note-"+(new Date).getTime()).attr("method","POST").attr("action",a).hide().appendTo(_("body"));_("<input>").attr("name","id").attr("type","hidden").appendTo(h).val(s);_("<input>").attr("name","subject").attr("type","hidden").appendTo(h).val(o);_("<input>").attr("name","text").attr("type","hidden").appendTo(h).val(r);_("<input>").attr("name","isRequired").attr("type","hidden").appendTo(h).val(e._isRequired);_("<input>").attr("name","isPrivate").attr("type","hidden").appendTo(h).val(l);_("<input>").attr("name","attachmentSettings").attr("type","hidden").appendTo(h).val(e._attachmentSettings);if(e._isRTEEnabled=="True")_("<input>").attr("name","isRTEEnabled").attr("type","hidden").appendTo(h).val(true);var m=_("<input>").attr("type","file").attr("name","file").insertAfter(v);v.appendTo(h);h.on("submit",function(){ClientLogWrapper.getLogger().traceInfo("EntityNotes updateNote(): Form submit","entity_notes","","UpdateNote");shell.ajaxSafePost({success:function(){e._editSuccess=true;t.trigger("refresh");n.modal("hide");h.remove();i.prop("disabled",false).find(".fa-spin").remove()},error:function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?e.responseJSON.Message:e.statusText;g({Message:a},n);v.insertAfter(m);m.remove();h.remove();i.prop("disabled",false).find(".fa-spin").remove()}},_(this));return false});h.trigger("submit")};c.prototype.initializePagination=function(e,t){if(typeof e===typeof undefined||e===false||e==null){return}if(typeof e.PageSize===typeof undefined||e.PageSize===false||e.PageSize==null||(typeof e.PageCount===typeof undefined||e.PageCount===false||e.PageCount==null)||(typeof e.PageNumber===typeof undefined||e.PageNumber===false||e.PageNumber==null)||(typeof e.ItemCount===typeof undefined||e.ItemCount===false||e.ItemCount==null)){return}var n=this;var a=n._element;var i=a.find(".notes-pagination");if(e.PageCount<=1){i.hide();return}i.data("pagesize",e.PageSize).data("pages",e.PageCount).data("current-page",e.PageNumber).data("count",e.ItemCount).off("click").pagination({total_pages:i.data("pages"),current_page:i.data("current-page"),callback:function(e,t){e.preventDefault();var a=_(e.target).closest("li");if(a.not(".disabled").length>0&&a.not(".active").length>0){n.load(t,e.currentTarget)}}}).show();i.find("li").first().find("a").attr("aria-label",window.ResourceManager["Pagination_Previous_Page"]);i.find("li").last().find("a").attr("aria-label",window.ResourceManager["Pagination_Next_Page"]);i.find("li.active").find("a").removeAttr("aria-label");i.find("li.active").find("a").attr("aria-current",window.ResourceManager["Pagination_Shortname"]);i.find("li.disabled").find("a").removeAttr("href");_("ul>li>a[data-page='..']",i).attr("aria-label",window.ResourceManager["Load_More_Pages"]);if(t){i.find("a").filter(function(){return _(this).text()==_(t).text()}).trigger("focus")}};function g(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){if(typeof console!="undefined"&&console){ClientLogWrapper.getLogger().traceError("EntityNotes onFail(): Error - "+e,"entity_notes");console.log(e)}var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=_("<div></div>").addClass("alert alert-block alert-danger error clearfix");n.attr("tabIndex","0")}else{n.empty()}setTimeout(function(){n.trigger("focus")});var i=_("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span></p>");if(typeof e.InnerError!==typeof undefined&&typeof e.InnerError.Message!==typeof undefined&&e.InnerError.Message!==false&&e.InnerError.Message!=null){n.append(i).text(e.InnerError.Message+(typeof e.InnerError.Message==="number"?" Error":""))}else if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){n.append(i).text(e.Message+(typeof e.Message==="number"?" Error":""))}a.prepend(n)}else{ClientLogWrapper.getLogger().traceError("EntityNotes onFail(): error object is undefined, false or null","entity_notes")}}function d(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null){ClientLogWrapper.getLogger().traceError("EntityNotes getError(): jqXhr object is null. Error - "+t,"entity_notes");return t}try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?_.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}ClientLogWrapper.getLogger().traceError("EntityNotes getError(): Error - "+t,"entity_notes");return t}function i(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}_(document).ready(function(){var e=_(".entity-notes");if(e.length==0){e=_(".entity-timeline")}e.each(function(){Handlebars.registerHelper("if_eq",function(e,t,a){if(e==t)return a.fn(this);else return a.inverse(this)});Handlebars.registerHelper("if_not_eq",function(e,t,a){if(e!=t)return a.fn(this);else return a.inverse(this)});Handlebars.registerHelper("commaSeparatedList",function(e,t){var a="";for(var n=0;n<e.length;n++){if(e[n].Name){a+=i(e[n].Name)+(n!==e.length-1?", ":"")}}return a});Handlebars.registerHelper("dateTimeFormatter",function(e){var t=window.moment;if(t){var a=dateFormatConverter.convert(_(".entity-timeline").closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(_(".entity-timeline").closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(_(".entity-timeline").closest("[data-datetimeformat]").data("datetimeformat")||a+" "+n,dateFormatConverter.dotNet,dateFormatConverter.momentJs);return t(e).format(i)}});new c(_(this)).render()})})})(jQuery);(function(g){function i(){var e=[];var t=this._layout;if(t&&t.TopFormActionLinks&&t.TopFormActionLinks.length&&(t.BottomFormActionLinks&&t.BottomFormActionLinks.length)){e=_.union(t.TopFormActionLinks,t.BottomFormActionLinks)}else if(t&&t.TopFormActionLinks&&t.TopFormActionLinks.length){e=t.TopFormActionLinks}else if(t){e=t.BottomFormActionLinks}return e}function e(e,t){t=URI(t);var a=e.data("ref-entity");var n=e.data("ref-id");var i=e.data("ref-rel");var r=e.data("ref-rel-role");if(a&&n&&i){t.addSearch("refentity",a);t.addSearch("refid",n);t.addSearch("refrel",i);if(r){t.addSearch("refrelrole",r)}}return t.toString()}function v(e,t,a,n){e=URI(e);if(t&&a&&n){e.addSearch("refentity",t);e.addSearch("refid",a);e.addSearch("refrel",n)}return e.toString()}n.prototype.render=function(){var e=this;var t=e._element;var a=e._layout;if(typeof a===typeof undefined||a==null||a==""){t.hide()}var n=e.addDeleteActionLinkClickEventHandlers();var i=e.addWorkflowActionLinkClickEventHandlers();var r=e.addQualifyLeadActionLinkClickEventHandlers();var o=e.addCloseCaseActionLinkClickEventHandlers();var l=e.addResolveCaseActionLinkClickEventHandlers();var d=e.addReopenCaseActionLinkClickEventHandlers();var s=e.addCancelCaseActionLinkClickEventHandlers();var c=e.addConvertQuoteActionLinkClickEventHandlers();var f=e.addConvertOrderActionLinkClickEventHandlers();var u=e.addCalculateOpportunityActionLinkClickEventHandlers();var p=e.addActivateActionLinkClickEventHandlers();var v=e.addDeactivateActionLinkClickEventHandlers();var h=e.addActivateQuoteActionLinkClickEventHandlers();var m=e.addSetOpportunityOnHoldActionLinkClickEventHandlers();var g=e.addReopenOpportunityActionLinkClickEventHandlers();var y=e.addWinOpportunityActionLinkClickEventHandlers();var b=e.addLoseOpportunityActionLinkClickEventHandlers();var C=e.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers();var k=e.addUpdatePipelinePhaseActionLinkClickEventHandlers();var _=e.addSubmitActionLinkClickEventHandlers();var w=e.addNextActionLinkClickEventHandlers();var L=e.addPreviousActionLinkClickEventHandlers();var S=e.addCreateRelatedRecordClickEventHandlers();if((n||i||r||o||l||d||s||c||f||u||p||v||h||m||y||b||C||k||g||_||w||L)&&a!=null&&(a.EnableActions||_||w||L||S)){t.show()}else{t.hide()}};n.prototype.addDeleteActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var n=e._layout;if(n==null||n==""||n.DeleteActionLink==null||!n.DeleteActionLink.Enabled||!n.DeleteActionLink.URL){var a=t.find(".delete-link");a.hide();a.addClass("hidden");return false}var i=n.DeleteActionLink.URL.PathWithQueryString;var r=t.children(".modal-delete");var o=t.closest(".entity-form");if(o.length<1){var l=t.closest(".crmEntityFormView");o=l.find(".entity-form")}var d=o.find("[id$='_EntityID']").val();var s=r.find("button.primary");s.off("click");s.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");o.find(".navbar-collapse").find(".action-status").empty().append("<span class='fa fa-spinner fa-spin fa-fw' aria-hidden='true'></span>");var t={};t.LogicalName=n.EntityName;t.Id=d;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:i,data:a}).done(function(){r.modal("hide");y(n.DeleteActionLink.SuccessMessage);C(n.DeleteActionLink,true)}).fail(function(e){r.modal("hide");b(k(e),o)}).always(function(){s.prop("disabled",false).find(".fa-spin").remove()})});t.find(".delete-link").on("click",function(e){e.preventDefault();r.modal()});return true};postBackOnSubmit=null;SubmitModal=function(){return t()};function t(){if(typeof Page_ClientValidate=="undefined"||typeof Page_ClientValidate=="function"&&typeof Page_IsValid!="undefined"&&Page_IsValid){var a=c;var n=a.children(".modal-submit");var e=n.find("button.primary");var t=n.find("button.cancel");var i=n.find("button.form-close");e.off("click").on("click",function(){n.attr("aria-hidden","true");n.modal("hide");var e=a.find(".submit-btn").attr("name");postBackOnSubmit(new WebForm_PostBackOptions(e,"",true,"","",false,true))});t.off("click").on("click",function(){n.attr("aria-hidden","true");a.find(".submit-btn").removeAttr("disabled");a.find(".submit-btn")[0].value=o;var e=a.find(".previous-btn");if(e.length>0&&e.attr("disabled")==="disabled"){e.removeAttr("disabled")}});i.off("click").on("click",function(){n.attr("aria-hidden","true");a.find(".submit-btn").removeAttr("disabled");a.find(".submit-btn")[0].value=o});n.on("keydown",function(e){var t=a.find(".submit-btn");if(e.key==="Escape"&&t.length>0){n.attr("aria-hidden","true");t.removeAttr("disabled");t[0].value=o}});n.attr("aria-hidden","false");n.modal("show")}return false}n.prototype.addSubmitActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var a=e._layout;if(a==null||a==""||a.SubmitActionLink==null||!a.SubmitActionLink.Enabled){var n=t.find(".submit-btn");if(r(n)){return true}n.addClass("hidden");n.hide();return false}return true};n.prototype.addNextActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var a=e._layout;if(a==null||a==""||a.NextActionLink==null||!a.NextActionLink.Enabled){var n=t.find(".next-btn");if(r(n)){return true}n.addClass("hidden");n.hide();return false}return true};n.prototype.addPreviousActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var a=e._layout;if(a==null||a==""||a.PreviousActionLink==null||!a.PreviousActionLink.Enabled){var n=t.find(".previous-btn");if(r(n)){return true}n.addClass("hidden");n.hide();return false}return true};n.prototype.addWorkflowActionLinkClickEventHandlers=function(){var e=this;var n=e._element;var v=e._layout;var h=n.closest(".entity-form");if(h.length<1){var t=n.closest(".crmEntityFormView");h=t.find(".entity-form")}if(!v){return false}var m=i.call(e);if(m&&m.length){g.each(m,function(e,t){if(t.Type==7){if(t.Enabled){var a=n.find(".workflow-link[data-filtercriteriaid = '"+t.FilterCriteriaId+"']");if(t.ShowModal===1){var p=n.children(".modal-run-workflow");a.on("click",function(e){e.preventDefault();p.attr("aria-hidden","false");var d=h.find("[id$='_EntityID']").val();var s=p.find("button.primary");var t=p.find("button.cancel");var a=p.find("button.close");var n=g(this);var c=g(this).data("url");var f=g(this).data("workflowid");var u=g(this).data("filtercriteriaid");if(!f||!c){return}var i=g(this).data("modal-title");if(i){p.find(".modal-title").empty().append(i).attr("title",i)}p.parent().find("section").attr("aria-label",i);var r=g(this).data("modal-confirmation");if(r){p.find(".modal-body").empty().append(r)}var o=g(this).data("modal-primary-action");if(o){s.empty().append(o);s.attr("title",o);s.attr("aria-label",o)}var l=g(this).data("modal-cancel-action");if(l){p.find(".cancel").empty().append(l)}s.off("click");s.on("click",function(e){e.preventDefault();p.attr("aria-hidden","true");g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t=null;for(var a=0;a<m.length;a++){var n=m[a];if(n!=null&&typeof n.Type!==typeof undefined&&n.Type==7&&typeof n.Workflow!==typeof undefined&&n.Workflow!=null&&n.Workflow.Id==f&&typeof n.FilterCriteriaId!=typeof undefined&&n.FilterCriteriaId==u){t=n;break}}var i={};var r={};r.LogicalName="workflow";r.Id=f;i.workflow=r;var o={};o.LogicalName=v.EntityName;o.Id=d;i.entity=o;var l=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:c,data:l}).done(function(){p.modal("hide");y(t!=null?t.SuccessMessage:null);C(t)}).fail(function(e){p.modal("hide");b(k(e),h)}).always(function(){s.prop("disabled",false).find(".fa-spin").remove()})});t.on("click",function(e){p.attr("aria-hidden","true")});a.on("click",function(e){p.attr("aria-hidden","true")});p.modal();p.on("shown.bs.modal",function(){p.find("button.primary").trigger("focus")});p.on("hidden.bs.modal",function(){if(n.is(":visible")){n.trigger("focus")}})})}else{a.on("click",function(e){e.preventDefault();var t=h.find("[id$='_EntityID']").val();var a=g(this).data("workflowid");var n=g(this).data("filtercriteriaid");var i=g(this).data("url");if(!a||!i){return}var r=null;for(var o=0;o<m.length;o++){var l=m[o];if(l!=null&&typeof l.Type!==typeof undefined&&l.Type==7&&typeof l.Workflow!==typeof undefined&&l.Workflow!=null&&l.Workflow.Id==a&&typeof l.FilterCriteriaId!=typeof undefined&&l.FilterCriteriaId==n){r=l;break}}var d={};var s={};s.LogicalName="workflow";s.Id=a;d.workflow=s;var c={};c.LogicalName=v.EntityName;c.Id=t;d.entity=c;var f=JSON.stringify(d);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:i,data:f}).done(function(){y(r!=null?r.SuccessMessage:null);C(r,true)}).fail(function(e){b(k(e),h)})})}}else{n.find(".workflow-link[data-filtercriteriaid = '"+t.FilterCriteriaId+"']").hide();n.find(".workflow-link[data-filtercriteriaid = '"+t.FilterCriteriaId+"']").addClass("hidden")}}})}else{n.find(".workflow-link").hide();return false}return true};n.prototype.addQualifyLeadActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.QualifyLeadActionLink==null||!l.QualifyLeadActionLink.Enabled||!l.QualifyLeadActionLink.URL||n!="0"){var i=t.find(".qualify-lead-link");i.addClass("hidden");i.hide();return false}if(l.QualifyLeadActionLink.ShowModal==1){var s=t.children(".modal-qualify");t.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.createAccount=true;t.createContact=true;t.createOpportunity=true;var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.QualifyLeadActionLink.SuccessMessage);C(l.QualifyLeadActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};n.createAccount=true;n.createContact=true;n.createOpportunity=true;var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.QualifyLeadActionLink.SuccessMessage);C(l.QualifyLeadActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addCloseCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var s=e._layout;var c=t.closest(".entity-form");if(c.length<1){var a=t.closest(".crmEntityFormView");c=a.find(".entity-form")}var n=c.find("[id$='_EntityState']").val();if(s==null||s==""||s.CloseIncidentActionLink==null||!s.CloseIncidentActionLink.Enabled||!s.CloseIncidentActionLink.URL||n!="0"){var i=t.find(".close-case-link");i.addClass("hidden");i.hide();return false}if(s.CloseIncidentActionLink.ShowModal==1){var f=t.children(".modal-closecase");t.find(".close-case-link").on("click",function(e){e.preventDefault();var o=c.find("[id$='_EntityID']").val();var l=f.find("button.primary");var d=g(this).data("url");l.off("click");l.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=s.EntityName;a.Id=o;t.entityReference=a;var n=s.CloseIncidentActionLink.DefaultResolution;var i=s.CloseIncidentActionLink.DefaultResolutionDescription;t.resolutionSubject=n;t.resolutionDescription=i;var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:r}).done(function(){f.modal("hide");y(s.CloseIncidentActionLink.SuccessMessage);C(s.CloseIncidentActionLink)}).fail(function(e){f.modal("hide");b(k(e),c)}).always(function(){l.prop("disabled",false).find(".fa-spin").remove()})});f.modal()});f.on("show.bs.modal",function(){f.attr("aria-hidden","false")});f.on("hidden.bs.modal",function(){f.attr("aria-hidden","true")})}else{t.find(".close-case-link").on("click",function(e){e.preventDefault();var t=c.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=s.EntityName;i.Id=t;n.entityReference=i;var r=s.CloseIncidentActionLink.DefaultResolution;var o=s.CloseIncidentActionLink.DefaultResolutionDescription;n.resolutionSubject=r;n.resolutionDescription=o;var l=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:l}).done(function(){y(s.CloseIncidentActionLink.SuccessMessage);C(s.CloseIncidentActionLink)}).fail(function(e){b(k(e),c)})})}return true};n.prototype.addConvertQuoteActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ConvertQuoteToOrderActionLink==null||!l.ConvertQuoteToOrderActionLink.Enabled||!l.ConvertQuoteToOrderActionLink.URL||n!="1"){var i=t.find(".convert-quote-link");i.addClass("hidden");i.hide();return false}if(l.ConvertQuoteToOrderActionLink.ShowModal==1){var s=t.children(".modal-convert-quote");t.find(".convert-quote-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ConvertQuoteToOrderActionLink.SuccessMessage);C(l.ConvertQuoteToOrderActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".convert-quote-link").on("click",function(e){e.preventDefault();var t=g(this);t.attr("disabled","disabled");t.closest("li.action").children(".dropdown-toggle").css("cursor","not-allowed").dropdown("toggle").removeAttr("data-toggle").off("click");t.closest(".navbar-collapse").find(".action-status").empty().append("<span class='fa fa-spinner fa-spin fa-fw' aria-hidden='true'></span>");var a=d.find("[id$='_EntityID']").val();var n=g(this).data("url");var i={};var r={};r.LogicalName=l.EntityName;r.Id=a;i.entityReference=r;var o=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:n,data:o}).done(function(){y(l.ConvertQuoteToOrderActionLink.SuccessMessage);C(l.ConvertQuoteToOrderActionLink)}).fail(function(e){b(k(e),d)}).always(function(){t.removeAttr("disabled");t.closest("li.action").children(".dropdown-toggle").css("cursor","").attr("data-toggle","dropdown").data("toggle","dropdown").on("click",function(){g(this).dropdown()})})})}return true};n.prototype.addConvertOrderActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ConvertOrderToInvoiceActionLink==null||!l.ConvertOrderToInvoiceActionLink.Enabled||!l.ConvertOrderToInvoiceActionLink.URL||n=="2"){var i=t.find(".convert-order-link");i.addClass("hidden");i.hide();return false}if(l.ConvertOrderToInvoiceActionLink.ShowModal==1){var s=t.children(".modal-convert-order");t.find(".convert-order-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ConvertOrderToInvoiceActionLink.SuccessMessage);C(l.ConvertOrderToInvoiceActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".convert-order-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ConvertOrderToInvoiceActionLink.SuccessMessage);C(l.ConvertOrderToInvoiceActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addCalculateOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;if(l==null||l==""||l.CalculateOpportunityActionLink==null||!l.CalculateOpportunityActionLink.Enabled||!l.CalculateOpportunityActionLink.URL){var a=t.find(".calculate-opportunity-link");a.addClass("hidden");a.hide();return false}var d=t.closest(".entity-form");if(d.length<2){var n=t.closest(".crmEntityFormView");d=n.find(".entity-form")}if(l.CalculateOpportunityActionLink.ShowModal==1){var s=t.children(".modal-calculate");t.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.CalculateOpportunityActionLink.SuccessMessage);C(l.CalculateOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.CalculateOpportunityActionLink.SuccessMessage);C(l.CalculateOpportunityActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addResolveCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var s=e._layout;var a=t.closest(".entity-form");if(a.length<1){var n=t.closest(".crmEntityFormView");a=n.find(".entity-form")}var i=a.find("[id$='_EntityState']").val();if(s==null||s==""||s.ResolveCaseActionLink==null||!s.ResolveCaseActionLink.Enabled||!s.ResolveCaseActionLink.URL||i!="0"){var r=t.find(".resolve-case-link");r.addClass("hidden");r.hide();return false}var c=t.children(".modal-resolvecase");c.on("hidden.bs.modal.entityform",function(){c.find(".resolution-input").val("");c.find(".resolution-description-input").val("");c.find(".alert-danger.error").remove()});t.find(".resolve-case-link").on("click",function(e){e.preventDefault();var o=a.find("[id$='_EntityID']").val();var l=c.find("button.primary");var d=g(this).data("url");l.off("click");l.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=s.EntityName;a.Id=o;t.entityReference=a;var n=c.find(".resolution-input");t.resolutionSubject=n.val();var i=c.find(".resolution-description-input");t.resolutionDescription=i.val();var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:r}).done(function(){c.modal("hide");y(s.ResolveCaseActionLink.SuccessMessage);C(s.ResolveCaseActionLink)}).fail(function(e){c.modal("show");f({Message:e.statusText},c)}).always(function(){l.prop("disabled",false).find(".fa-spin").remove()})});c.modal()});return true};function f(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){if(typeof console!="undefined"&&console){ClientLogWrapper.getLogger().traceError("EntityForm onFail(): Error - "+e,"entity_form");console.log(e)}var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=g("<div></div>").addClass("alert alert-block alert-danger error clearfix")}else{n.empty()}if(typeof e.InnerError!==typeof undefined&&typeof e.InnerError.Message!==typeof undefined&&e.InnerError.Message!==false&&e.InnerError.Message!=null){if(typeof e.InnerError.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+"</p>")}}else if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+"</p>")}}a.prepend(n)}else{ClientLogWrapper.getLogger().traceError("EntityForm onFail(): error object is undefined, false or null","entity_form")}}n.prototype.addReopenCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ReopenCaseActionLink==null||!l.ReopenCaseActionLink.Enabled||!l.ReopenCaseActionLink.URL||n=="0"){var i=t.find(".reopen-case-link");i.addClass("hidden");i.hide();return false}if(l.ReopenCaseActionLink.ShowModal==1){var s=t.children(".modal-reopencase");t.find(".reopen-case-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ReopenCaseActionLink.SuccessMessage);C(l.ReopenCaseActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".reopen-case-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ReopenCaseActionLink.SuccessMessage);C(l.ReopenCaseActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addCancelCaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.CancelCaseActionLink==null||!l.CancelCaseActionLink.Enabled||!l.CancelCaseActionLink.URL||n!="0"){var i=t.find(".cancel-case-link");i.addClass("hidden");i.hide();return false}if(l.CancelCaseActionLink.ShowModal==1){var s=t.children(".modal-cancelcase");t.find(".cancel-case-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.CancelCaseActionLink.SuccessMessage);C(l.CancelCaseActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()});s.on("show.bs.modal",function(){s.attr("aria-hidden","false")});s.on("hidden.bs.modal",function(){s.attr("aria-hidden","true")})}else{t.find(".cancel-case-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.CancelCaseActionLink.SuccessMessage);C(l.CancelCaseActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addActivateActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ActivateActionLink==null||!l.ActivateActionLink.Enabled||!l.ActivateActionLink.URL||n=="0"){var i=t.find(".activate-link");i.addClass("hidden");i.hide();return false}if(l.ActivateActionLink.ShowModal==1){var s=t.children(".modal-activate");t.find(".activate-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ActivateActionLink.SuccessMessage);C(l.ActivateActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".activate-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ActivateActionLink.SuccessMessage);C(l.ActivateActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addDeactivateActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.DeactivateActionLink==null||!l.DeactivateActionLink.Enabled||!l.DeactivateActionLink.URL||n=="1"){var i=t.find(".deactivate-link");i.addClass("hidden");i.hide();return false}if(l.DeactivateActionLink.ShowModal==1){var s=t.children(".modal-deactivate");t.find(".deactivate-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.DeactivateActionLink.SuccessMessage);C(l.DeactivateActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".deactivate-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.DeactivateActionLink.SuccessMessage);C(l.DeactivateActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addActivateQuoteActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.ActivateQuoteActionLink==null||!l.ActivateQuoteActionLink.Enabled||!l.ActivateQuoteActionLink.URL||n!="0"){var i=t.find(".activate-quote-link");i.addClass("hidden");i.hide();return false}if(l.ActivateQuoteActionLink.ShowModal==1){var s=t.children(".modal-activate-quote");t.find(".activate-quote-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ActivateQuoteActionLink.SuccessMessage);C(l.ActivateQuoteActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".activate-quote-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ActivateQuoteActionLink.SuccessMessage);C(l.ActivateQuoteActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addSetOpportunityOnHoldActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();var i=d.find("[id$='_EntityStatus']").val();if(l==null||l==""||l.SetOpportunityOnHoldActionLink==null||!l.SetOpportunityOnHoldActionLink.Enabled||!l.SetOpportunityOnHoldActionLink.URL||n!="0"||i=="2"){var r=t.find(".set-opportunity-on-hold-link");r.addClass("hidden");r.hide();return false}if(l.SetOpportunityOnHoldActionLink.ShowModal==1){var s=t.children(".modal-set-opportunity-on-hold");t.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.SetOpportunityOnHoldActionLink.SuccessMessage);C(l.SetOpportunityOnHoldActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.SetOpportunityOnHoldActionLink.SuccessMessage);C(l.SetOpportunityOnHoldActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};n.prototype.addReopenOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();var i=d.find("[id$='_EntityStatus']").val();if(l==null||l==""||l.ReopenOpportunityActionLink==null||!l.ReopenOpportunityActionLink.Enabled||!l.ReopenOpportunityActionLink.URL||n=="0"){var r=t.find(".reopen-opportunity-link");r.addClass("hidden");r.hide();return false}if(l.ReopenOpportunityActionLink.ShowModal==1){var s=t.children(".modal-reopen-opportunity");t.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.ReopenOpportunityActionLink.SuccessMessage);C(l.ReopenOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.ReopenOpportunityActionLink.SuccessMessage);C(l.ReopenOpportunityActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};n.prototype.addWinOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.WinOpportunityActionLink==null||!l.WinOpportunityActionLink.Enabled||!l.WinOpportunityActionLink.URL||n!="0"){var i=t.find(".win-opportunity-link");i.addClass("hidden");i.hide();return false}if(l.WinOpportunityActionLink.ShowModal==1){var s=t.children(".modal-win-opportunity");t.find(".win-opportunity-link").on("click",function(e){e.preventDefault();s.attr("aria-hidden","false");var t=s.attr("aria-label");if(t){s.attr("aria-label",h(t))}var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();s.attr("aria-hidden","true");g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.WinOpportunityActionLink.SuccessMessage);C(l.WinOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.on("hide.bs.modal",function(e){g(this).attr("aria-hidden","true")});s.modal()})}else{t.find(".win-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.WinOpportunityActionLink.SuccessMessage);C(l.WinOpportunityActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};n.prototype.addLoseOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.LoseOpportunityActionLink==null||!l.LoseOpportunityActionLink.Enabled||!l.LoseOpportunityActionLink.URL||n!="0"){var i=t.find(".lose-opportunity-link");i.addClass("hidden");i.hide();return false}if(l.LoseOpportunityActionLink.ShowModal==1){var s=t.children(".modal-lose-opportunity");t.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();s.attr("aria-hidden","false");var t=s.attr("aria-label");if(t){s.attr("aria-label",h(t))}var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();s.attr("aria-hidden","true");g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.LoseOpportunityActionLink.SuccessMessage);C(l.LoseOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.on("hide.bs.modal",function(e){g(this).attr("aria-hidden","true")});s.modal()})}else{t.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.LoseOpportunityActionLink.SuccessMessage);C(l.LoseOpportunityActionLink)}).fail(function(e){b(k(e),d)}).always(function(){})})}return true};n.prototype.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var l=e._layout;var d=t.closest(".entity-form");if(d.length<1){var a=t.closest(".crmEntityFormView");d=a.find(".entity-form")}var n=d.find("[id$='_EntityState']").val();if(l==null||l==""||l.GenerateQuoteFromOpportunityActionLink==null||!l.GenerateQuoteFromOpportunityActionLink.Enabled||!l.GenerateQuoteFromOpportunityActionLink.URL||n!="0"){var i=t.find(".generate-quote-from-opportunity-link");i.addClass("hidden");i.hide();return false}if(l.GenerateQuoteFromOpportunityActionLink.ShowModal==1){var s=t.children(".modal-generate-quote-from-opportunity");t.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var i=d.find("[id$='_EntityID']").val();var r=s.find("button.primary");var o=g(this).data("url");r.off("click");r.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=l.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:o,data:n}).done(function(){s.modal("hide");y(l.GenerateQuoteFromOpportunityActionLink.SuccessMessage);C(l.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){s.modal("hide");b(k(e),d)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});s.modal()})}else{t.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var t=d.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=l.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(l.GenerateQuoteFromOpportunityActionLink.SuccessMessage);C(l.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){b(k(e),d)})})}return true};n.prototype.addUpdatePipelinePhaseActionLinkClickEventHandlers=function(){var e=this;var t=e._element;var c=e._layout;var f=t.closest(".entity-form");if(f.length<1){var a=t.closest(".crmEntityFormView");f=a.find(".entity-form")}var n=f.find("[id$='_EntityState']").val();if(c==null||c==""||c.UpdatePipelinePhaseActionLink==null||!c.UpdatePipelinePhaseActionLink.Enabled||!c.UpdatePipelinePhaseActionLink.URL||n!="0"){var i=t.find(".update-pipeline-phase-link");i.addClass("hidden");i.hide();return false}var u=t.children(".modal-updatepipelinephase");t.find(".update-pipeline-phase-link").on("click",function(e){e.preventDefault();var l=f.find("[id$='_EntityID']").val();var d=u.find("button.primary");var s=g(this).data("url");d.off("click");d.on("click",function(e){e.preventDefault();g(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=c.EntityName;a.Id=l;t.entityReference=a;var n=u.find(".pipelinephase-input");t.salesStage=n.val();var i=n.find("option:selected");t.stepName=i.text();var r=u.find(".resolution-description-input");t.description=r.val();var o=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:s,data:o}).done(function(){u.modal("hide");y(c.UpdatePipelinePhaseActionLink.SuccessMessage);C(c.UpdatePipelinePhaseActionLink)}).fail(function(e){u.modal("hide");b(k(e),f)}).always(function(){d.prop("disabled",false).find(".fa-spin").remove()})});u.modal()});return true};n.prototype.addCreateRelatedRecordClickEventHandlers=function(){var e=this;var f=e._element;var u=e._layout;var p=f.closest(".entity-form");if(p.length<1){var t=f.closest(".crmEntityFormView");p=t.find(".entity-form")}if(!u||!u.CreateRelatedRecordActionLink){return false}window.addEventListener("message",function(e){if(e.data=="Success"){f.children(".modal-form").modal("hide")}});var a=i.call(e);if(a&&a.length){g.each(a,function(e,c){if(c.Type===29){if(c.Enabled){if(u.CreateRelatedRecordActionLink.ShowModal===1){var t=f.find(".create-related-record-link[data-filtercriteriaid = '"+c.FilterCriteriaId+"']");t.on("click",function(e){e.preventDefault();var t=f.children(".modal-form-createrecord[data-filtercriteriaid = '"+c.FilterCriteriaId+"']");t.attr("aria-hidden","false");var a=t.attr("aria-label");if(a){t.attr("aria-label",h(a))}var n=p.find("[id$='_EntityID']").val();var i=t.find("iframe");var r=i.data("page");var o=c.Relationship;var l=c.EntityForm.Id;var d=r+"?id="+n+"&entityformid="+l+"&languagecode="+u.LanguageCode;var s=v(d,u.EntityName,n,o);i.attr("src",s);i.on("load",function(){t.find(".form-loading").hide();t.find("iframe").contents().find("#EntityFormControl").show()});t.find(".form-loading").show();t.find("iframe").contents().find("#EntityFormControl").hide();t.on("hide.bs.modal",function(e){g(this).attr("aria-hidden","true")});t.modal()})}else{f.find(".create-related-record-link[data-filtercriteriaid = '"+c.FilterCriteriaId+"']").on("click",function(e){e.preventDefault();var t=p.find("[id$='_EntityID']").val();var a=g(this).data("url");var n={};var i={};i.LogicalName=u.EntityName;i.Id=t;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:a,data:r}).done(function(){y(u.CreateRelatedRecordActionLink.SuccessMessage);C(u.CreateRelatedRecordActionLink)}).fail(function(e){b(k(e),p)}).always(function(){})})}}else{var a=f.find(".create-related-record-link[data-filtercriteriaid = '"+c.FilterCriteriaId+"']");a.addClass("hidden");a.hide()}}})}else{return false}return true};function y(e){g.cookie("adx-notification",e,{expires:1,path:"/"})}function b(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a;if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){a=e.InnerError.Message}else if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){a=e.Message}else{a=e}var n=g(".notifications");if(n.length==0){var i=g(".page-heading");if(i.length==0){var r=g("#content-container");if(r.length==0){var o=t.closest("#EntityFormPanel");if(o.length>0){n=g("<div class='notifications'></div>").insertBefore(o)}else{var l="No suitable div found to append error notifications";console.warn(l);ClientLogWrapper.getLogger().traceError(l,"entity_form")}}else{n=g("<div class='notifications'></div>").prependTo(r)}}else{n=g("<div class='notifications'></div>").appendTo(i)}}n.find(".notification").slideUp().remove();var d=t.find(".navbar-collapse").find(".action-status");if(d.length==0)d=t.parent().find(".navbar-collapse").find(".action-status");d.empty().append("<span class='fa fa-fw fa-exclamation-circle text-danger' aria-hidden='true'></span>");var s=g("<div class='notification alert alert-danger error alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+a+"</div>").on("closed.bs.alert",function(){d.empty().append("<span class='fa fa-fw' aria-hidden='true'></span>");if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();g("html, body").animate({scrollTop:s.length?s.offset().top-20:0},200)}}function a(e,t,a){var n=g(".notifications");if(n.length==0){var i=g(".page-heading");if(i.length==0){n=g("<div class='notifications'></div>").prependTo(g("#content-container"))}else{n=g("<div class='notifications'></div>").appendTo(i)}}n.find(".notification").slideUp().remove();if(typeof e!==typeof undefined&&e!==false&&e!=null&&e!=""){var r=t.find(".navbar-collapse").find(".action-status");if(r.length==0)r=t.parent().find(".navbar-collapse").find(".action-status");r.empty().append("<span class='fa fa-fw fa-check-circle text-success' aria-hidden='true'></span>");var o=g("<div class='notification alert alert-success success alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"+e+"</div>").on("closed.bs.alert",function(){r.empty().append("<span class='fa fa-fw' aria-hidden='true'></span>");if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();g("html, body").animate({scrollTop:o.length?o.offset().top-20:0},200)}}function C(e,t){if(typeof e==typeof undefined||e==null){d(t);return}var a=0;var n=1;var i=2;var r=typeof e.OnComplete!=typeof undefined&&e.OnComplete!=null&&e.OnComplete!=a;if(r){var o=s(e);if(o!=null&&o!=""){g.cookie("adx-notification",null);l(o)}else{d(t)}}else{d(t)}}function l(e){if(typeof e=="undefined"||e==null||e=="")return;g.blockUI({css:{border:"none",backgroundColor:"transparent",opacity:.5,color:"#fff"},message:"<span class='fa fa-2x fa-spinner fa-pulse' aria-hidden='true'></span>"});if(parent){parent.location.replace(e)}else{window.location.replace(e)}}function d(e){g.blockUI({css:{border:"none",backgroundColor:"transparent",opacity:.5,color:"#fff"},message:"<span class='fa fa-2x fa-spinner fa-pulse' aria-hidden='true'></span>"});if(e&&parent){if(parent.location.href.indexOf("#")!=-1){parent.location.reload(true)}else{parent.location=parent.location.href}}else{if(location.href.indexOf("#")!=-1){window.location.reload(true)}else{window.location=window.location.href}}}function s(e){if(!e||!e.RedirectUrl)return null;if(e.RedirectUrl.Host==window.location.hostname){return URI(e.RedirectUrl.PathWithQueryString)}else{return URI(e.RedirectUrl.Uri)}}function k(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null){ClientLogWrapper.getLogger().traceError("EntityForm getError(): jqXhr object is null. Error - "+t,"entity_form");return t}try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?g.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}ClientLogWrapper.getLogger().traceError("EntityForm getError(): Error - "+t,"entity_form");return t}function h(e){return e.replace(/<(?:.|\n)*?>/gm,"")}function n(e){this._element=g(e);this._layout=null;var t=this._element;var a=t.closest(".entity-form");if(a.length<1){var n=t.closest(".crmEntityFormView");a=n.find(".entity-form")}if(a.length==0)return;var i=a.find("[id$='_EntityLayoutConfig']");if(i.length==0)return;this._layout=i.data("form-layout")}function r(e){if(e&&e.length>0&&e.attr("nonActionLinkButton")){e.css("margin-right","5px");if(g(".form-action-container-left")){var t=g("button:last",g(".form-action-container-left"));if(t&&t.css("margin-right")=="0px"){t.css("margin-right","5px")}}return true}return false}var o=null;var c=null;g(document).ready(function(){g(".form-custom-actions").each(function(){var e=g(this).find(".submit-btn");if(e.length>0){o=e[0].value;postBackOnSubmit=WebForm_DoPostBackWithOptions;c=g(this)}new n(g(this)).render()});g("div.actions").each(function(){var e=g(this).find(".submit-btn");if(e.length>0){o=g(this).find(".submit-btn")[0].value;postBackOnSubmit=WebForm_DoPostBackWithOptions;c=g(this)}});g(".form-custom-actions .dropdown-toggle").each(function(){var e=g(this).parent().find(".dropdown-menu");var t=e.find("a:not(.hidden)").length;if(t<1){g(this).parent().hide()}});g(".crmEntityFormView").attr("role","form");var e=g(".page-header h1").text();var t=window.ResourceManager["Entity_Form_Label"];g(".crmEntityFormView").attr("aria-label",e||t);g("input[type='file']").on("keydown",function(e){var t=e.keycode?e.keycode:e.which;if(t=="13"){e.stopPropagation();e.preventDefault();g(this).trigger("click")}});if(g(".control select.form-control.picklist")&&g(".control select.form-control.picklist").attr("required")){g(".control select.form-control.picklist").removeAttr("required")}})})(jQuery);(function(be){var Ce=0;var ke=1;var _e=2;var M=false;var we=false;var re=undefined;var e=be.cookie("adx-notification");if(typeof e!==typeof undefined&&e!=null){_(e,null,true);be.cookie("adx-notification",null,{path:"/"})}window.getUrlWithRelatedReference=function(e,t){t=URI(t);var a=e.data("ref-entity");var n=e.data("ref-id");var i=e.data("ref-rel");var r=e.data("ref-rel-role");if(a&&n&&i){t.addSearch("refentity",a);t.addSearch("refid",n);t.addSearch("refrel",i);if(r){t.addSearch("refrelrole",r)}}return t.toString()};function oe(e,t,a,n){e=URI(e);if(t&&a&&n){e.addSearch("refentity",t);e.addSearch("refid",a);e.addSearch("refrel",n)}return e.toString()}function Le(e){if(!e||!e.URL)return null;return i(e.URL)}function Se(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){ClientLogWrapper.getLogger().traceError("EntityGrid displayErrorAlert(): Error - "+e,"entity_grid");console.log(e);var a;if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){a=e.InnerError.Message}else{a=e.Message}var n=r(t);var i=be("<div class='notification alert alert-danger error alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+a+"</div>").on("closed.bs.alert",function(){if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();be("html, body").animate({scrollTop:i.length?i.offset().top-20:0},200)}else{ClientLogWrapper.getLogger().traceError("EntityGrid displayErrorAlert(): error object is undefined, false or null","entity_grid")}}o.prototype.render=function(e){try{var t=ClientLogWrapper.getLogger().getBlockPerfTracker();t.start("RenderGrid","entity_grid");var m=this;var g=m._element;var a=m._layouts;var n=m._gridClass;var i=g.data("selected-view");var r=m._deferLoading;var o=m._enableActions;var l=m._allowFilterOff;var d=g.data("ai-insights-enabled");var s=window.ResourceManager["AI_Summary_Button_Title"];var c=g.data("ai-insights-expanded");var y=g.data("id");var f=g.data("ai-insights-position");var u=g.data("is-nl-search-enabled");const ge=document.querySelector('[data-id="'+y+'"]');nlSearchFilter=ge?ge.dataset["nlSearchFilter"]:null;var p=m._toggleFilterText;var v=m._selectMode;var h=m._columnWidthStyle;var b=m._userIsAuthenticated;var C=m._userParentAccountName;var k=m._toggleFilterDisplayName;var _=g.data("mobile-view-enabled");var w=0;if(typeof i!==typeof undefined&&i!==false&&i!=null&&i!=""){w=Ae(a,"Id",i);if(w==-1){w=0}}this._activeLayoutIndex=w;var L=a[w];if(L.Configuration.PartialViewConfig){m.load(true);L=a[w]}var S=URI(window.location).search(true);var E=Te();m._metaFilter=S[L.Configuration.FilterSettings.FilterQueryStringParameterName||"mf"]||null;var A=b&&C&&C!=""&&(L.Configuration.FilterPortalUserAttributeName!=null&&L.Configuration.FilterPortalUserAttributeName!=""&&(L.Configuration.FilterAccountAttributeName!=null&&L.Configuration.FilterAccountAttributeName!=""));var T=g.children(".view-grid");T.empty();g.find("div[id$='_ControlView']").each(function(e){be(this).hide()});g.children(".view-toolbar").remove();var N=be("<div></div>").addClass("view-toolbar").addClass("grid-actions").addClass("clearfix");var I=be("<div></div>").addClass("pull-right").addClass("toolbar-actions");var x=false;if(l){var D=be("<a></a>").attr("href","#").attr("role","button").attr("aria-label",k).attr("aria-pressed","false").addClass("toggle-related-filter").data("placement","bottom").data("toggle","tooltip").addClass("btn btn-default").addClass("active").append(be("<span></span>").addClass("fa").addClass("fa-filter").attr("aria-hidden","true")).append(be("<span></span>").addClass("title").text(k)).on("click",function(e){e.preventDefault();this.ariaPressed=this.ariaPressed=="true"?"false":"true";be(this).toggleClass("active");m.load(true,nlSearchFilter,0,g.children(".view-toolbar").find(".view-filter-select").data("filter"),!be(this).hasClass("active"))});if(p&&p!=""){D.attr("title",p).tooltip()}if(this._compact){D.addClass("btn-xs")}D.prependTo(N);x=true}var M=L.Configuration.Search;var R,O,P,F;if(!u&&M.Enabled){R=be("<div></div>").addClass("input-group").addClass("pull-left").addClass("view-search").addClass("entitylist-search");if(navigator.userAgent.toLowerCase().indexOf("firefox")==-1){R.attr("role","none")}O=be("<button></button>").attr("type","button").attr("aria-label",window.ResourceManager["Search_Results"]).attr("title",window.ResourceManager["Search_Results"]).addClass("btn").addClass("btn-default").addClass("btn-hg").append(be("<span></span>").addClass("sr-only").html("Search Results")).append(be("<span></span>").addClass("fa").addClass("fa-search"));P=be("<div></div>").addClass("input-group-btn").attr("role","presentation").append(O);F=be("<input/>").attr("placeholder",M.PlaceholderText).attr("title",M.TooltipText).attr("aria-label",M.TooltipText).addClass("query").addClass("form-control").val("").on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"){e.preventDefault();O.trigger("click");be(this).trigger("focus")}})}g.children(".modal-form-details").on("hidden.bs.modal.entitygrid",function(){var e=be(this).find("iframe");e.attr("src","")});g.children(".modal-form-edit").on("hidden.bs.modal.entitygrid",function(){var e=be(this).find("iframe");e.attr("src","")});g.children(".modal-form-createrecord").on("hidden.bs.modal.entitygrid",function(){var e=be(this).find("iframe");e.attr("src","")});var j=g.children(".modal-delete");j.on("shown.bs.modal",function(){be('[class="modal fade modal-delete in"]').find('[class="close"]').focus();be('[class="modal fade modal-delete in"]').find('[class="form-close"]').focus()});var $=g.closest(".entity-form").find("[id$='_EntityState']").val();var H=typeof $!=typeof undefined&&$!=null&&$!==""&&$!=="0";if(o&&L.Configuration.InsertActionLink.Enabled&&L.Configuration.InsertActionLink.URL&&!H){var U=be("<a></a>").attr("href",Le(L.Configuration.InsertActionLink)).addClass("btn").addClass("insert-Action-link").addClass("btn-primary").addClass("pull-right").addClass("action").html(L.Configuration.InsertActionLink.Label).attr("title",L.Configuration.InsertActionLink.Tooltip);if(E)U.attr("target","_top");U.prependTo(N);x=true}var J=null;if(o){var W=portal.IsRequestedFromMaker(g);be.each(L.Configuration.ViewActionLinks,function(e,l){if(!l.Enabled)return;switch(l.Type){case 3:if(H){return}var t="#";var a=g.data("ref-entity");var n=g.data("ref-id");var i=g.data("ref-rel");var r=g.data("ref-rel-role");var o="";if(a&&n&&i){o+="refentity="+a+"&refid="+n+"&refrel="+i;if(r){o+="&refrelrole="+r}}if((l.Target==ke||l.Target==_e)&&l.URL!=null){t=getUrlWithRelatedReference(g,URI(Le(l)).toString())}J=be("<div></div>").addClass("input-group").addClass("pull-left");var d=be("<a></a>").attr("href",t).attr("role","link").addClass("btn").addClass("btn-primary").addClass("pull-right").addClass("action create-action").html(l.Label).attr("title",l.Tooltip).attr("tabindex",0);if(t!="#"&&E)d.attr("target","_top");if(l.Target==Ce&&l.EntityForm&&!W){var s=g.children(".modal-form-insert");var c=s.attr("aria-label");d.removeAttr("role");d.attr("role","button");s.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){s.attr("aria-hidden","true");var e=be(this).find("iframe");e.attr("src","");d.trigger("focus")});d.on("click",function(e){e.preventDefault();var t=s.find("iframe");var a=t.data("page");var n=l.EntityForm.Id.toString();var i=getUrlWithRelatedReference(g,a+"?entityformid="+n+"&languagecode="+L.Configuration.LanguageCode);t.attr("src",i);t.attr("title",s[0].ariaLabel);t.on("load",function(){s.find(".form-loading").hide();s.find("iframe").contents().find("#EntityFormControl").show()});$liveNotificationDiv=be("<div></div>").attr("aria-relevant","all").attr("aria-live","assertive").attr("id","notificationDiv").attr("class","loading-text");if(be("#notificationDiv").length==0){J.append($liveNotificationDiv)}s.find(".form-loading").show();s.find("iframe").contents().find("#EntityFormControl").hide();s.modal();if(be("#notificationDiv").length>0){be("#notificationDiv").html("");be("#notificationDiv").html(window.ResourceManager["Loading_Message"])}});s.on("show.bs.modal",function(){s.attr("aria-hidden","false");s.attr("aria-label",c+" "+"dialog")});s.on("shown.bs.modal",function(){$closeBtn=be(this).find("button:visible:first");setTimeout(function(){if(document.activeElement.nodeName=="SECTION"){$closeBtn.trigger("focus")}},3e3)});s.on("hidden.bs.modal",function(){if(be("#notificationDiv").length>0){be("#notificationDiv").remove()}})}if(m._compact){d.addClass("btn-xs")}J.append(d).appendTo(I);x=true;break;case 5:if(H){return}var f=be("<div></div>").addClass("input-group").addClass("pull-left");var u=be("<a></a>").attr("href","#").addClass("btn").addClass("btn-info").addClass("pull-right").addClass("action").html(l.Label).attr("title",l.Tooltip);var p=g.find(".associate-lookup .modal-associate");p.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){u.trigger("focus")});u.on("click",function(e){e.preventDefault();p.modal()});if(m._compact){u.addClass("btn-xs")}f.append(u).appendTo(I);x=true;break;case 8:var v=be("<div></div>").addClass("input-group").addClass("pull-left");var h=be("<a></a>").attr("href","#").addClass("entitylist-download").addClass("btn").addClass("btn-info").addClass("pull-right").addClass("action").attr("title",l.Tooltip).html(l.Label);if(m._compact){h.addClass("btn-xs")}h.on("click",function(e){if(h.attr("disabled")=="disabled"){return false}e.preventDefault();h.attr("disabled","disabled");var t=new Date;var a,n=false;var i={};i.viewName=L.ViewName;i.columns=L.Columns;i.base64SecureConfiguration=L.Base64SecureConfiguration;i.sortExpression=g.find(".view-grid > table").data("sort-expression")||L.SortExpression;i.search=F?F.val():null;i.filter=m.getCurrentFilter();i.metaFilter=m._metaFilter;const r=document.querySelector('[data-id="'+y+'"]');nlSearchFilter=r?r.dataset["nlSearchFilter"]:null;i.nlSearchFilter=nlSearchFilter;i.page=g.children(".view-pagination").data("current-page");i.pageSize=g.children(".view-pagination").data("pagesize");i.timezoneOffset=t.getTimezoneOffset();if((new Date).hasDaylightSavingTime()){a=true}i.isDSTSupport=a;i.isDSTObserved=moment().isDST();var o=JSON.stringify(i);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:l.URL.Path,data:o,global:false,success:function(e){if(e.success){window.location=l.URL.Path+"?key="+e.sessionKey}}}).fail(function(e){var t=e.getResponseHeader("content-type");var a=t.indexOf("json")>-1?be.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};Se(a,g)}).always(function(){h.removeAttr("disabled")})});v.append(h).appendTo(I);x=true;break}})}if(A){var q=be("<ul></ul>").addClass("view-filter-select").addClass("nav").addClass("nav-pills").addClass("pull-left").data("filter","user");var z=be("<li></li>").addClass("dropdown");var V=be("<a></a>").addClass("dropdown-toggle").attr("data-toggle","dropdown").attr("href","#").append(be("<span></span>").addClass("fa").addClass("fa-filter").attr("aria-hidden","true")).append(be("<span></span>").addClass("title").html(" "+L.Configuration.FilterByUserOptionLabel)).append(be("<span></span>").addClass("caret").attr("aria-hidden","true")).dropdown();z.append(V);var Q=be("<ul></ul>").addClass("dropdown-menu");var B=be("<li></li>");B.addClass("active");var G=be("<a></a>").attr("href","#").addClass("filter-user").html(L.Configuration.FilterByUserOptionLabel).on("click",function(e){e.preventDefault();q.find("li").removeClass("active");be(this).closest("li").toggleClass("active");q.data("filter","user");m.changeFilter()});B.append(G).appendTo(Q);var K=be("<li></li>");var Y=be("<a></a>").attr("href","#").addClass("filter-account").html(C).on("click",function(e){e.preventDefault();q.find("li").removeClass("active");be(this).closest("li").toggleClass("active");q.data("filter","account");m.changeFilter()});K.append(Y).appendTo(Q);z.append(Q).appendTo(q);q.prependTo(N);x=true}if(!u&&M.Enabled&&R&&!m._compact){R.append(F).append(P).prependTo(I);x=true}if(a.length>1){var Z=L.Configuration.ViewDisplayName;if(Z==null||Z==""){Z=L.ViewName}var X=be("<ul></ul>").addClass("view-select").addClass("nav").addClass("nav-pills").addClass("pull-left");var ee=be("<li></li>").addClass("dropdown").attr("id","filterDropdownId");var te=be("<a></a>").addClass("selected-view").addClass("dropdown-toggle").attr("data-toggle","dropdown").attr("href","#").attr("role","button").attr("title",Z).attr("tabindex",0).append(be("<span></span>").addClass("fa").addClass("fa-list").attr("aria-hidden","true")).append(be("<span></span>").addClass("title").html(" "+Z)).append(be("<span></span>").addClass("caret").attr("aria-hidden","true")).dropdown().on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){if(be("#filterDropdownId").hasClass("open")){be("#filterDropdownId").removeClass("open")}else{be("#filterDropdownId").addClass("open")}}});ee.append(te);var ae=be("<ul></ul>").addClass("dropdown-menu").attr("role","menu");var ne=be("html").attr("dir");if(ne=="rtl"){ae.css("left","auto")}be.each(a,function(e,t){var a=be("<li role='none'></li>");if(e==w){a.addClass("active")}var n=t.Configuration.ViewDisplayName;if(n==null||n==""){n=t.ViewName}var i=be("<a></a>").attr("href","#").attr("role","menuitem").attr("aria-label",n).attr("tabindex",0).data("id",t.Id).html(n).on("click",function(e){be("#filterDropdownId").trigger("focus");e.preventDefault();var t=be(this).data("id");m.changeView(t)}).on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){be("#filterDropdownId").focus();e.preventDefault();var a=be(this).data("id");m.changeView(a)}});a.append(i).appendTo(ae)});var ie=ae.find("li a").length;ae.find("li a").each(function(e,t){be(t).attr("aria-setsize",ie).attr("aria-posinset",e+1)});ee.append(ae).appendTo(X);X.prependTo(N);x=true}else if(m._compact){be("<ul>").addClass("view-select").addClass("nav").addClass("nav-pills").addClass("pull-left").append(be("<li>").append(be("<div>").addClass("selected-view").append(be("<span>").addClass("title").html(L.Configuration.ViewDisplayName||L.ViewName||"")))).prependTo(N);x=true}if(!u&&M.Enabled&&R&&m._compact){R.removeClass("pull-left").addClass("input-group-sm").append(F).append(P).prependTo(g)}if(d){var re=be("<div></div>").addClass("input-group aiSummaryContainer").addClass("pull-left");var oe=be("<button class='aiSummary' id='AISummary"+y+"'><img style = 'height:20px;' src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIxMC40MiUiIHN0eWxlPSJzdG9wLWNvbG9yOiByZ2IoNTEsIDkyLCAyMDQpOyBzdG9wLW9wYWNpdHk6IDE7Ij48L3N0b3A+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjogcmdiKDEzMSwgNDgsIDIzMyk7IHN0b3Atb3BhY2l0eTogMTsiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48cGF0aCBkPSJNMTIgMjFhMi4wNyAyLjA3IDAgMCAxLTEuOTYtMS40bC0uOC0yLjQyYTMuOCAzLjggMCAwIDAtMi40My0yLjQ0bC0yLjQtLjc4YTIuMDggMi4wOCAwIDAgMS0uMDMtMy45M2wyLjQ0LS43OWEzLjg1IDMuODUgMCAwIDAgMi4zNi0yLjM4bC44LTIuNDZhMi4wNyAyLjA3IDAgMCAxIDMuMTctMS4wM2MuMzUuMjUuNjIuNi43NiAxbC44IDIuNDRhMy44MyAzLjgzIDAgMCAwIDIuNDIgMi40M2wyLjQuNzhhMi4wNyAyLjA3IDAgMCAxIC4wOCAzLjk0bC0yLjQzLjhhMy44MSAzLjgxIDAgMCAwLTIuNDMgMi40MmwtLjc4IDIuNEEyLjA2IDIuMDYgMCAwIDEgMTIgMjFabTExLjUgOWExLjc1IDEuNzUgMCAwIDEtMS42NC0xLjE2bC0uNTQtMS42OGEyLjI4IDIuMjggMCAwIDAtMS40OC0xLjQ4bC0xLjY1LS41M2ExLjc1IDEuNzUgMCAwIDEtLjAzLTMuM2wxLjY5LS41NGEyLjMyIDIuMzIgMCAwIDAgMS40My0xLjQ3bC41NC0xLjY1YTEuNzMgMS43MyAwIDAgMSAzLjI5LS4wMmwuNTQgMS42N2EyLjMzIDIuMzMgMCAwIDAgMS40OCAxLjQ3bDEuNjUuNTRhMS43MyAxLjczIDAgMCAxIC4wNSAzLjNsLTEuNjcuNTRhMi4yNyAyLjI3IDAgMCAwLTEuNDcgMS40N2wtLjU0IDEuNjVBMS43NiAxLjc2IDAgMCAxIDIzLjUgMzBaIiBmaWxsPSJ1cmwoI2dyYWRpZW50MSkiPjwvcGF0aD48L3N2Zz4=' />"+s+"</button>");const ye=document.querySelector('[data-id="'+y+'"]');c=ye.dataset["aiInsightsExpanded"];if(c=="true"){oe.hide()}oe.on("click",()=>{var e=document.getElementById("aiInsights-"+y);const t=document.querySelector('[data-id="'+y+'"]');if(t){if(f=="left"||f=="right"){t.setAttribute("style","width: 50%")}}e.style.display="block";g.attr("data-ai-insights-expanded",true);oe.hide()});re.append(oe).appendTo(I);x=true}if(x){I.appendTo(N);g.prepend(N)}if(L.Columns==undefined||L.Columns.length==0){return}var le=g.data("default-pcf-controlid");var de=g.find("#"+le+"_PcfControlConfig");var se=g.find("#"+L.Configuration.EntityName+"_PcfControlConfig");var ce=g.find("#"+i+"_PcfControlConfig");var fe=null;if((window.loadPcfGridControl||window.modernPCFRendering)&&(de&&de.length==1||se&&se.length==1||ce&&ce.length==1)){ClientLogWrapper.getLogger().traceInfo("EntityGrid render(): Loading PCF dataset control","entity_grid","","Render");if(window.modernPCFRendering){g[0].dispatchEvent(new CustomEvent("refreshDataGrid"));if(!u&&M.Enabled){O.on("click",function(e){e.preventDefault();g[0].dispatchEvent(new CustomEvent("refreshDataGrid"));we=true})}}else{if(!u&&M.Enabled){O.on("click",function(e){e.preventDefault();window.loadPcfGridControl(fe);we=true})}if(de&&de.length==1){g.find("#"+le+"_ControlView").first().show();fe=de[0];window.loadPcfGridControl(de[0])}else if(ce&&ce.length==1){g.find("#"+i+"_ControlView").first().show();fe=ce[0];window.loadPcfGridControl(ce[0])}else if(se&&se.length==1){g.find("#"+L.Configuration.EntityName+"_DefaultPcfEntityGrid_ControlView").first().show();fe=se[0];window.loadPcfGridControl(se[0])}}}else{if(o){window.removeEventListener("message",m._messageEventHandler);window.addEventListener("message",m._messageEventHandler)}if(!u&&M.Enabled){O.on("click",function(e){e.preventDefault();m.load(true,null,1);we=true})}var ue=be("<table></table>").attr("aria-relevant","additions");ue.addClass("table");ue.addClass(n);if(_==true)ue.addClass("table-fluid");else T.addClass("table-responsive");if(navigator.userAgent.match(/iPad/i)&&E){ue.addClass("table-ipad")}if(v=="Single"||v=="Multiple"){ue.addClass("table-hover")}if(h=="Pixels"){ue.attr("style","width:"+L.ColumnsTotalWidth+"px !important; max-width:"+L.ColumnsTotalWidth+"px !important;")}ue.data("sort-expression",L.SortExpression);var pe=be("<thead></thead>");var ve=be("<tbody></tbody>");var he=be("<tr></tr>");var me=Ee(L.SortExpression);be.each(L.Columns,function(e,t){var a=be("<th scope='col'></th>").data("field",t.LogicalName).attr("aria-readonly","true");if(t.LogicalName!=="col-action"){a.data("columnname",t.Name)}if(h=="Pixels"){a.attr("style","width:"+t.Width+"px;")}else{a.attr("style","width:"+t.WidthAsPercent+"%;")}if(!t.SortDisabled){a.addClass("sort-enabled").data("sort-name",t.LogicalName);var n=be("<a></a>").attr("href","#").attr("role","button").attr("aria-label",t.Name).attr("tabindex",0);var i=Ae(me,"name",t.LogicalName);if(i!=-1){var r=me[i];if(r.direction.toLowerCase().indexOf("asc")!=-1){n.append(t.Name+" ").append(be("<span></span>").addClass("fa").addClass("fa-arrow-up").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Ascending_Order"]+"</span>");a.attr("aria-sort","ascending");a.data("sort-dir","ASC").addClass("sort").addClass("sort-asc")}else{n.append(t.Name+" ").append(be("<span></span>").addClass("fa").addClass("fa-arrow-down").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>");a.attr("aria-sort","descending");a.data("sort-dir","DESC").addClass("sort").addClass("sort-desc")}}else{n.html(t.Name).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>")}n.appendTo(a)}else{a.html(t.Name);var o=t.Name.replace(/<(?:.|\n)*?>/gm,"").trim();a.addClass("sort-disabled").attr("aria-label",o).attr("data-th",t.Name)}a.appendTo(he)});he.appendTo(pe);pe.appendTo(ue);ve.appendTo(ue);if(v=="Single"){let e=window.ResourceManager["Lookup_SingleSelection_Text"];$SingleModeText=be("<span>"+e+"</span>");$SingleModeText.attr("aria-label",e);$SingleModeText.attr("tabindex","0");$SingleModeText.prependTo(T)}ue.appendTo(T);m.addSortEventHandlers();if(!r){m.load(true,nlSearchFilter)}else if(e){m.load(true,nlSearchFilter)}}}finally{t.stop()}};o.prototype.changeView=function(e){var t=this;var a=t._element;a.data("selected-view",e);t.resetPagination();t._isChangeViewTriggered=true;var n=t._layouts;var i=0;if(typeof e!==typeof undefined&&e!==false&&e!=null&&e!=""){i=Ae(n,"Id",e);if(i==-1){i=0}}this._activeLayoutIndex=i;var r=n[i];if(r.Configuration.PartialViewConfig){r=n[i]}const o=new CustomEvent("entityGridViewChanged",{detail:{gridId:a.attr("data-id")||"",viewId:e,base64:r.Base64SecureConfiguration||""},bubbles:true});a[0].dispatchEvent(o);a.attr("data-nl-search-filter","");t.render(true);be(a).find("#filterDropdownId>a").attr("tabindex",0).focus()};o.prototype.changeFilter=function(){var e=this;var t=e._element;var a=e._layouts;var n=t.data("selected-view");var i=t.data("id");const r=document.querySelector('[data-id="'+i+'"]');nlSearchFilter=r?r.dataset["nlSearchFilter"]:null;var o=t.children(".view-toolbar").find(".view-filter-select");var l=0;if(typeof n!==typeof undefined&&n!==false&&n!=null&&n!=""){l=Ae(a,"Id",n);if(l==-1){l=0}}this._activeLayoutIndex=l;var d=a[l];var s=e._userIsAuthenticated;var c=e._userParentAccountName;var f=s&&c&&c!=""&&(d.Configuration.FilterPortalUserAttributeName!=null&&d.Configuration.FilterPortalUserAttributeName!=""||d.Configuration.FilterAccountAttributeName!=null&&d.Configuration.FilterAccountAttributeName!="");if(!f){return}var u=e.getCurrentFilter();var p;if(u=="user"){p=d.Configuration.FilterByUserOptionLabel}else{p=c}o.find("li.dropdown").find("span.title").html(" "+p);e.load(true,nlSearchFilter,0,u)};o.prototype.getCurrentFilter=function(){var e=this;var t=e._element;var a=e._layouts;var n=t.data("selected-view");var i=t.children(".view-toolbar").find(".view-filter-select");var r=0;if(typeof n!==typeof undefined&&n!==false&&n!=null&&n!=""){r=Ae(a,"Id",n);if(r==-1){r=0}}this._activeLayoutIndex=r;var o=a[r];var l=e._userIsAuthenticated;var d=e._userParentAccountName;var s="user";if(!l){return null}if(o.Configuration.FilterPortalUserAttributeName==null||o.Configuration.FilterPortalUserAttributeName==""){if(!d||d==""||o.Configuration.FilterAccountAttributeName==null||o.Configuration.FilterAccountAttributeName==""){return null}else{return"account"}}if(!d||d==""||o.Configuration.FilterAccountAttributeName==null||o.Configuration.FilterAccountAttributeName==""){return s}var c=i.data("filter")||s;if(c=="user"||c=="account"){return c}return s};o.prototype.isRelatedRecordFilterEnabled=function(){var e=this;var t=e._element;var a;if(t.children(".view-toolbar").find(".toggle-related-filter").length==0){a=e._applyRelatedRecordFilter||false}else{a=t.children(".view-toolbar").find(".toggle-related-filter").hasClass("active")}return a};function le(e){let t=be(".lookup-modal>.entity-lookup>.modal-lookup>.modal-dialog>.modal-content>.modal-footer");t.find("button.primary").prop("disabled",e);t.find("button.remove-value").prop("disabled",e)}o.prototype.load=function(e,t,a,n,i,V,r){var Q=this;var B=Q._element;var o=B.data("id");var l=B.data("ai-insights-enabled");var d=B.data("is-nl-search-enabled");var G=B.children(".view-grid").find("table");var K=be("<tbody></tbody>");var s=B.children(".view-error");var Y=B.children(".view-empty");var Z=B.children(".view-empty-maker");var X=B.children(".view-access-denied");var c=B.children(".view-loading");var f=B.children(".view-pagination");var u=B.children(".view-toolbar").find(".entitylist-search input.query");var p=G.data("sort-expression");var v=Q._serviceUrlForGet;var ee=Q._layouts;var te=ee[Q._activeLayoutIndex];var ae=te.Configuration;var ne=Q._selectMode;if(ne=="Single"){le(true)}var ie=Q._enableActions;var h;var m=Q._filterRelationshipName;var g=Q._filterEntityName;var y=Q._filterAttributeName;var b=null;var C=B.closest(".entity-form").children("input[type='hidden'][id$='EntityName']").val();var k=B.closest(".entity-form").children("input[type='hidden'][id$='EntityID']").val();var _=Q._metaFilter;B.children(".view-grid").find("tbody").remove();s.hide().prop("aria-hidden",true);Y.hide().prop("aria-hidden",true);Z.hide().prop("aria-hidden",true);X.hide().prop("aria-hidden",true);var w=B.data("id");const L=document.querySelector('[data-id="'+w+'"]');t=L?L.dataset["nlSearchFilter"]:null;c.show().prop("aria-hidden",false);f.data("pagesize",ae.PageSize);var S=f.data("current-page");if(S==null||S==""){S=1}n=n||Q.getCurrentFilter();a=a||S;var E=f.data("pagesize");if(E==null||E==""){E=10}var A=r||u.val();if(typeof A===typeof undefined||A===false){A=null}if(typeof i===typeof undefined){h=Q.isRelatedRecordFilterEnabled()}else{h=!i}if(h){if(g&&C&&C!=""&&g==C&&k&&k!=""){b=k}else if(y&&y!=""){var T=be("#"+y);if(T.length>0){var N=T.val();if(N&&N!=""){b=N}}}}if(e&&l){R(o?o.toString():"",te.Base64SecureConfiguration,A,_,n,t)}Q.hidePagination();function I(t){var e="SearchCountText"+ae.ModalLookupAttributeLogicalName;var a=be("<div></div>").attr("role","alert").attr("id",e).addClass("sr-only");if(be("#"+e).length>0){be("#"+e).remove()}K.empty();if(typeof t===typeof undefined||t===false||t==null){var n=portal.IsRequestedFromMaker(B);if(n){Z.fadeIn().prop("aria-hidden",false)}else{Y.fadeIn().prop("aria-hidden",false);a.attr("aria-label",window.ResourceManager["Default_Grid_Empty_Message"]);B.children(".view-grid").append(a)}B.trigger("loaded");return}if(t.NextPagePagingCookie!=null){Q._pagingCookieMap[t.PageNumber+1]=t.NextPagePagingCookie}if(t.CompleteViewLayout!=null){te=JSON.parse(t.CompleteViewLayout);ee[Q._activeLayoutIndex]=te;Q.render();G=B.children(".view-grid").find("table")}if(t.ViewConfiguration!=null&&t.PageNumber<=t.PageCount){te.Base64SecureConfiguration=t.ViewConfiguration}if(t.CreateActionMetadata&&t.CreateActionMetadata.Disabled){var i=B.find(".grid-actions .create-action").off("click");if(t.CreateActionMetadata.DisabledMessage){i.attr("title",t.CreateActionMetadata.DisabledMessage)}i.on("click",function(e){e.preventDefault();if(t.CreateActionMetadata.DisabledMessage){window.alert(t.CreateActionMetadata.DisabledMessage)}})}if(typeof t.Records!==typeof undefined&&t.Records!==false&&(t.Records==null||t.Records.length==0)){var n=portal.IsRequestedFromMaker(B);if(n){Z.fadeIn().prop("aria-hidden",false)}else{Y.fadeIn().prop("aria-hidden",false);a.attr("aria-label",window.ResourceManager["Default_Grid_Empty_Message"]);B.children(".view-grid").append(a)}B.trigger("loaded");return}if(typeof t.AccessDenied!==typeof undefined&&t.AccessDenied!==false&&t.AccessDenied){X.fadeIn().prop("aria-hidden",false);B.trigger("loaded");return}var r=be.map(G.find("th"),function(e){return be(e).data("field")});var o=r.length==0?"":r[0]=="col-select"?r[1]:r[0];B.data("total-record-count",t.ItemCount);for(var l=0;l<t.Records.length;l++){var d=t.Records[l];var s=se(d);if(!s){var c=Ae(d.Attributes,"Name",o);if(c!=-1){s=d.Attributes[c].DisplayValue}}var f=be("<tr></tr>").attr("data-id",d.Id).attr("data-entity",ae.EntityName).attr("data-name",s||"").on("focus",function(){be(this).addClass("active")}).on("blur",function(){be(this).removeClass("active")});var u=be.noop;if(ne=="Multiple"){u=function(){var e=be(this).hasClass("selected")===true;be(this).find("td:first span").attr("aria-checked",!e);be(this).children("td:first").find(".fa-fw").toggleClass("fa-check",!e);be(this).toggleClass("selected").toggleClass("info")};f.on("click",u).on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){e.preventDefault();u.apply(this,arguments)}}).children("td:first span").attr("aria-checked","false")}else if(ne=="Single"){u=function(){var e=be(this).hasClass("selected")===true;var t=G.find("tr.selected");t.each(function(){be(this).children("td:first").find(".fa-fw").removeClass("fa-check");be(this).find("td:first span").attr("aria-checked",false);be(this).removeClass("selected").removeClass("info")});if(!e){be(this).children("td:first").find(".fa-fw").addClass("fa-check");be(this).find("td:first span").attr("aria-checked",true);be(this).addClass("selected").addClass("info");re=be(this);le(false)}else{re=undefined;le(true)}};f.on("click",u).on("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){e.preventDefault();u.apply(this,arguments)}}).children("td:first span").attr("aria-checked","false")}for(var p=0;p<r.length;p++){var v=false;for(var h=0;h<d.Attributes.length;h++){var m=d.Attributes[h];if(m.Name==r[p]){var g=be("<td></td>").attr("data-type",m.Type).attr("data-attribute",m.Name).attr("data-value",typeof m.Value==="object"?JSON.stringify(m.Value):m.Value).attr("aria-readonly","true");var y=Q.formatAttributeValue(m,m.AttributeMetadata,p,d,t,g);if(y.isHtml){g.html(y.value)}else{g.text(m.DisplayValue)}if(m.AttributeMetadata){g.data("attribute-metadata",m.AttributeMetadata)}f.append(g);v=true;break}}if(!v){if(r[p]=="col-action"){var b=be("<td></td>").attr("addAriaLabel","true");var C=be("<div class='dropdown action'></div>");be("<button class='btn btn-default btn-xs aria-exp'><span class='fa fa-chevron-circle-down' aria-hidden='true'></span></button>").attr("data-toggle","dropdown").attr("aria-expanded","false").attr("aria-label",window.ResourceManager["ActionLink_Aria_Label"]).attr("title",window.ResourceManager["ActionLink_Aria_Label"]).appendTo(C);var k=be("<ul class='dropdown-menu' role='menu'></ul>");k.css("position","fixed").appendTo(C);C.on("show.bs.dropdown",function(){be(this).find(".aria-exp").attr("aria-expanded","true");var e=be(this).get(0).getBoundingClientRect();var t=be(this).find(".dropdown-menu:first");var a=be(window).width();var n=be("html").attr("dir");if(n=="rtl"){var i=document.documentElement.clientWidth+document.documentElement.offsetLeft;var r=i-e.left-e.width;t.css("left","auto").css("top",e.top+be(this).outerHeight());var o=r+t.outerWidth()<=i;t.css("left","auto").css("top",e.top+be(this).outerHeight());if(o){t.css("right",r)}else{t.css("right",r+e.width-t.outerWidth())}}else{var o=e.left+t.outerWidth()<=a;if(o){t.css("left",e.left).css("top",e.top+be(this).outerHeight())}else{t.css("left",e.left+e.width-t.outerWidth()).css("top",e.top+be(this).outerHeight())}}}).on("keydown",function(a){var e=a.keyCode?a.keyCode:a.which;if(e=="9"){B.find(".dropdown.action.open").removeClass("open")}if(e=="40"||e=="38"){a.preventDefault();a.stopImmediatePropagation();let t=B.find(".action .dropdown-menu li:not(.disabled):visible a");if(t!=null&&t.length!=0){let e=t.index(a.target);if(a.which==38&&e>0){e--}if(a.which==40&&e<t.length-1){e++}if(!~e){e=0}t.eq(e)[0].focus()}}});C.on("hide.bs.dropdown",function(){be(this).find(".aria-exp").attr("aria-expanded","false")});be(window).on("scroll",function(){var e=B.find(".dropdown.action.open");if(e.length==0){return}e.removeClass("open")});var _=Te();if(!te.Configuration.ItemActionLinks){te.Configuration.ItemActionLinks=te.Configuration.CreateRelatedRecordActionLinks}if(ie){if(te.Configuration.CreateRelatedRecordActionLinks&&te.Configuration.CreateRelatedRecordActionLinks.length>0){for(var w=0;w<te.Configuration.CreateRelatedRecordActionLinks.length;w++){if(be.inArray(te.Configuration.CreateRelatedRecordActionLinks[w],te.Configuration.ItemActionLinks)<0){te.Configuration.ItemActionLinks.push(te.Configuration.CreateRelatedRecordActionLinks[w])}}}var L=te.Configuration.ItemActionLinks;L.sort(function(e,t){return e.ActionIndex-t.ActionIndex});for(var S=0;S<L.length;S++){var E=L[S];if(t.DisabledItemActionLinks){var A=t.DisabledItemActionLinks.filter(function(e){return e.EntityId==d.Id&&e.LinkUniqueId==E.FilterCriteriaId});if(A&&A.length){continue}}switch(E.Type){case 1:if(E.Enabled){var T="#";if((E.Target==ke||E.Target==_e)&&E.URL!=null){T=getUrlWithRelatedReference(B,URI(Le(E)).addSearch(E.QueryStringIdParameterName,d.Id.toString()))}var N=be("<li role='none'></li>");var I=be("<a class='details-link' role='menuitem' tabindex='-1'></a>").attr("href",T).attr("title",E.Tooltip).html(E.Label);if(T!="#"&&_)I.attr("target","_top");if(E.Target==Ce&&E.EntityForm){I.addClass("launch-modal").attr("data-entityformid",E.EntityForm.Id)}N.append(I).appendTo(k)}break;case 2:if(E.Enabled&&d.CanWrite){var x="#";if((E.Target==ke||E.Target==_e)&&E.URL!=null){x=getUrlWithRelatedReference(B,URI(Le(E)).addSearch(E.QueryStringIdParameterName,d.Id.toString()).toString())}var D=be("<li role='none'></li>");var M=be("<a class='edit-link' role='menuitem' tabindex='-1'></a>").attr("href",x).attr("title",E.Tooltip).html(E.Label);if(x!="#"&&_)M.attr("target","_top");if(E.Target==Ce&&E.EntityForm){M.addClass("launch-modal").attr("data-entityformid",E.EntityForm.Id)}D.append(M).appendTo(k)}break;case 4:if(E.Enabled&&d.CanDelete){be("<li role='none'></li>").append(be("<a class='delete-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 6:if(E.Enabled&&d.CanAppend){be("<li role='none'></li>").append(be("<a class='disassociate-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 7:if(E.URL){var R=be("<a class='workflow-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).attr("data-workflowid",E.Workflow.Id).attr("data-url",Le(E)).html(E.Label);if(E.CustomizeModal===true){R.attr("data-modal",E.ShowModal);R.attr("data-modal-title",E.Modal.Title);R.attr("data-modal-confirmation",E.Confirmation);R.attr("data-modal-primary-action",E.Modal.PrimaryButtonText);R.attr("data-modal-cancel-action",E.Modal.CloseButtonText)}be("<li role='none'></li>").append(R).appendTo(k)}break;case 9:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='close-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("data-resolution",E.DefaultResolution).attr("data-description",E.DefaultResolutionDescription).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 10:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='qualify-lead-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 11:if(E.Enabled&&d.CanWrite&&d.StateCode=="1"){be("<li role='none'></li>").append(be("<a class='convert-quote-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 12:if(E.Enabled&&d.CanWrite&&d.StateCode!="2"){be("<li role='none'></li>").append(be("<a class='convert-order-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 13:if(E.Enabled&&d.CanWrite){be("<li role='none'></li>").append(be("<a class='calculate-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 14:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='resolve-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 15:if(E.Enabled&&d.CanWrite&&d.StateCode!="0"){be("<li role='none'></li>").append(be("<a class='reopen-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 16:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='cancel-case-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 17:if(E.Enabled&&d.CanWrite&&d.StateCode!="1"){be("<li role='none'></li>").append(be("<a class='deactivate-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 18:if(E.Enabled&&d.CanWrite&&d.StateCode!="0"){be("<li role='none'></li>").append(be("<a class='activate-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 19:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='activate-quote-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 20:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"&&d.StatusCode!="2"){be("<li role='none'></li>").append(be("<a class='set-opportunity-on-hold-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 21:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='win-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 22:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='lose-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 23:if(E.Enabled&&d.CanWrite&&d.StateCode=="0"){be("<li role='none'></li>").append(be("<a class='generate-quote-from-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("data-url",Le(E)).attr("data-redirecturl",ce(E)).attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 25:if(E.Enabled&&d.CanWrite&&d.StateCode!="0"){be("<li role='none'></li>").append(be("<a class='reopen-opportunity-link' role='menuitem' tabindex='-1' href='#'></a>").attr("title",E.Tooltip).html(E.Label)).appendTo(k)}break;case 29:var O=B.closest(".entity-form").find("[id$='_EntityState']").val();var P=typeof O!=typeof undefined&&O!=null&&O!==""&&O!=="0";if(E.Enabled&&d.CanWrite&&!P){var F="#";var j=this;if((E.Target===ke||E.Target===_e)&&E.URL!==null){F=getUrlWithRelatedReference(B,URI(Le(E)).addSearch(d.Id.toString()).toString())}var $=be("<li role='none'></li>");var H=be("<a class='create-related-record-link' role='menuitem' tabindex='-1'></a>").attr("href",F).attr("title",E.Tooltip).html(E.Label);if(F!=="#"&&_)H.attr("target","_top");if(E.Target===Ce&&E.EntityForm){H.addClass("launch-modal").attr("data-entityformid",E.EntityForm.Id).attr("data-relationship",E.Relationship).attr("data-filtercriteriaid",E.FilterCriteriaId);var U=B.children(".modal-form-createrecord");if(U.length){for(var J=0,W=U.length;J<W;J++){var q=be(U[J]);q.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){var e=be(this).find("iframe");e.attr("src","");j.createModal.trigger("focus")});q.on("click",function(e){e.preventDefault();var t=j.createModal.find("iframe");var a=t.data("page");var n=j.record.Id.toString();var i=E.Relationship;var r=j.record.EntityName;var o=a+"?id="+n+"&languagecode="+te.Configuration.LanguageCode+"&relationship="+"&entityformid="+te.Configuration.CreateRelatedRecordActionLink.EntityForm.Id;var l=oe(o,r,n,i);t.attr("src",l);t.on("load",function(){j.createModal.find(".form-loading").hide();j.createModal.find("iframe").contents().find("#EntityFormControl").show()});j.createModal.find(".form-loading").show();j.createModal.find("iframe").contents().find("#EntityFormControl").hide();j.createModal.modal()})}$.append(H).appendTo(k)}}}break}}}if(k.children("li").length>0){C.find(".fa").addClass("fa-fw");b.append(C)}var z=C.find("li a").length;C.find("li a").each(function(e,t){be(t).attr("aria-setsize",z).attr("aria-posinset",e+1)});b.appendTo(f)}else{let e=be("<td></td>").attr("aria-readonly","true");f.append(e)}}}if(ne=="Multiple"||ne=="Single"){f.children("td:first").append("<span class='fa fa-fw'></span>")}if(ne=="Single"){if(B.data("selected")===f.attr("data-id")&&re==undefined){f.children("td:first").find(".fa-fw").addClass("fa-check");f.children("td:first").children("span").attr("aria-checked",true);f.addClass("selected").addClass("info");le(false)}}if(re!=undefined&&re.length>0&&re.attr("data-id")==f.attr("data-id")){f.children("td:first").find(".fa-fw").addClass("fa-check");f.children("td:first").children("span").attr("aria-checked",true);f.addClass("selected").addClass("info");le(false)}K.append(f)}if(we==true){a.attr("aria-label",t.ItemCount+" "+window.ResourceManager["SearchCountText"]);B.children(".view-grid").append(a);we=false}B.children(".view-grid").find("tbody").remove();G.append(K.hide());K.fadeIn();Q.initializePagination(t,V);Q.addDetailsActionLinkClickEventHandlers();Q.addEditActionLinkClickEventHandlers();Q.addDeleteActionLinkClickEventHandlers();Q.addQualifyLeadActionLinkClickEventHandlers();Q.addCloseCaseActionLinkClickEventHandlers();Q.addResolveCaseActionLinkClickEventHandlers();Q.addReopenCaseActionLinkClickEventHandlers();Q.addCancelCaseActionLinkClickEventHandlers();Q.addConvertQuoteActionLinkClickEventHandlers();Q.addConvertOrderActionLinkClickEventHandlers();Q.addCalculateOpportunityActionLinkClickEventHandlers();Q.addActivateActionLinkClickEventHandlers();Q.addDeactivateActionLinkClickEventHandlers();Q.addActivateQuoteActionLinkClickEventHandlers();Q.addSetOpportunityOnHoldActionLinkClickEventHandlers();Q.addReopenOpportunityActionLinkClickEventHandlers();Q.addWinOpportunityActionLinkClickEventHandlers();Q.addLoseOpportunityActionLinkClickEventHandlers();Q.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers();Q.addDisassociateActionLinkClickEventHandlers();Q.addWorkflowActionLinkClickEventHandlers();Q.addCreateRelatedRecordLinkEventHandler();de(G);B.trigger("loaded")}function x(e,t,a){var n=e.getResponseHeader("content-type")||"";var i=n.indexOf("json")>-1?e.responseJSON.Message:a;if(i!==""&&i.toString().includes("Unexpected end of JSON input")){i=window.ResourceManager["Entitylist_Error_Text_For_Offline_Experience"]}ClientLogWrapper.getLogger().traceError("EntityGrid getDataFail(): Error - "+i,"entity_grid");s.html(be("<div class='alert alert-block alert-danger'></div>").html(i));s.show().prop("aria-hidden",false)}function D(){c.hide().prop("aria-hidden",true);if(M){G.find("th.sort-enabled a").removeAttr("disabled").css({"pointer-events":"",cursor:""});M=false}}Q.getData(v,ae,te.Base64SecureConfiguration,p,n,_,A,a,E,h,m,g,y,b,I,x,D,C,k,Q._pagingCookieMap[a],t)};o.prototype.initNlSearchListener=function(){var d=this;if(this._nlSearchFilterChangedHandler){window.removeEventListener("nlSearchFilterChanged",this._nlSearchFilterChangedHandler)}d._nlSearchFilterChangedHandler=function(e){const{gridId:t,nlFilter:a,currentsortExpression:n,searchPhrase:i}=e.detail;const r=d._element;const o=r.data("id");if(d._isChangeViewTriggered){d._isChangeViewTriggered=false;return}r.attr("data-nl-search-filter",a||"");if(n){var l=r.children(".view-grid").find("table");l.data("sort-expression",n)}d._searchPhrase=i;d.load(true,a,1,null,false,null,i)};window.addEventListener("nlSearchFilterChanged",d._nlSearchFilterChangedHandler)};o.prototype.getData=function(e,t,a,n,i,r,o,l,d,s,c,f,u,p,v,h,m,g,y,b="",C){v=be.isFunction(v)?v:function(){};h=be.isFunction(h)?h:function(){};m=be.isFunction(m)?m:function(){};var k=portal.IsRequestedFromMaker(this._element);if(k){m.call(this);v.call(null);return}if(!e||e==""){m.call(this);h.call(this,null,"error",window.ResourceManager["EntityGrid_Url_NotFound"]);return}if(!a){m.call(this);h.call(this,null,"error",window.ResourceManager["Required_Secure_ViewConfiguration_Not_Provided"]);return}d=d||-1;var _={};_.base64SecureConfiguration=a;_.sortExpression=n;_.search=o;_.page=l;_.pageSize=d;_.pagingCookie=b;_.filter=i;_.metaFilter=r;_.nlSearchFilter=C;_.timezoneOffset=(new Date).getTimezoneOffset();if(s){_.applyRelatedRecordFilter=s;_.filterRelationshipName=c;_.filterEntityName=f;_.filterAttributeName=u;if(p){_.filterValue=p}}_.customParameters=S(t);_.entityName=g;_.entityId=y;ClientLogWrapper.getLogger().traceInfo("EntityGrid getData(): Get data","entity_grid","","GetData");var w=JSON.stringify(_);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:e,data:w,global:false}).done(v).fail(h).always(m)};o.prototype.formatAttributeValue=function(e,t,a,n,i,r){if(!e){return null}var o=this;var l=o._element;var d=o._layouts;var s=d[o._activeLayoutIndex];var c=o._enableActions;var f=Te();var u={};var p=a==0&&c&&s.Configuration.DetailsActionLink.Enabled;switch(t.AttributeTypeName.Value){case"DateTimeType":var v=window.moment;if(v){var h=dateFormatConverter.convert(l.closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var m=dateFormatConverter.convert(l.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var g=dateFormatConverter.convert(l.closest("[data-datetimeformat]").data("datetimeformat")||h+" "+m,dateFormatConverter.dotNet,dateFormatConverter.momentJs);var y=e.DateTimeBehavior.Value;var b=e.DateTimeFormat;var C="YYYY-MM-DD";var k="YYYY-MM-DDTHH:mm:ssZ";var _="YYYY-MM-DDTHH:mm:ss";var w;var L;if(b=="DateOnly"){L=C;w=h}else if(y=="TimeZoneIndependent"){L=_;w=g}else{L=k;w=g}var S=y=="TimeZoneIndependent"||y=="DateOnly"?v.utc(e.Value):v(e.Value);u.value=be("<time></time>").attr("datetime",S.format(L)).text(S.format(w))}else{u.value=be("<time></time>").attr("datetime",e.DisplayValue).text(e.DisplayValue)}u.isHtml=true;break;case"StringType":if(!p&&typeof t!==typeof undefined&&t!=null&&typeof t.Format!==typeof undefined){if(t.Format==0){var E=e.DisplayValue;if(E&&E!=""){if(!E.toLowerCase().startsWith("mailto")){E="mailto:"+E}}u.value=be("<a></a>").attr("href",E).text(e.DisplayValue);u.isHtml=true}else if(t.Format==3){var A=e.DisplayValue;if(A&&A!=""){if(!A.toLowerCase().startsWith("http")){A="http://"+A}}var T=be("<a></a>");T.attr("href",A).text(e.DisplayValue);if(f)T.attr("target","_top");u.value=T;u.isHtml=true}else if(t.Format==4){var N=e.DisplayValue;if(N&&N!=""){var I="http://go.microsoft.com/fwlink?linkid=8506&Symbol="+encodeURIComponent(N.toUpperCase());var x=be("<a></a>");x.attr("href",I).text(e.DisplayValue);if(f)x.attr("target","_top");u.value=x;u.isHtml=true}}}else{u.value=e.DisplayValue;u.isHtml=false}break;case"MemoType":if(!p&&typeof t!==typeof undefined&&t!=null&&typeof t.Format!==typeof undefined){if(t.Format==0){u.value=be.parseHTML(e.DisplayValue,null,false);r.attr("tabindex","0");u.isHtml=true}}else{u.value=e.DisplayValue;u.isHtml=false}break;case"ImageType":var A="/Image/download.aspx?entity="+n.EntityName+"&attribute="+e.Name+"&ID="+n.Id;u.value=be("<img></img>").attr("src",A).attr("alt","image");u.isHtml=true;break;case"FileType":var A="/File/download.aspx?entity="+n.EntityName+"&attribute="+e.Name+"&ID="+n.Id;var D="";for(var M=0;M<n.Attributes.length;M++){var R=n.Attributes[M];if(R.Name==e.Name+"_name"){D=R.DisplayValue}}u.value=be("<a></a>").attr("href",A).attr("target","_blank").text(D);u.isHtml=true;break;default:u.value=e.DisplayValue;u.isHtml=false;break}if(p){var O="#";var P;if(!s.Configuration.DetailsActionLink.EntityForm&&s.Configuration.DetailsActionLink.URL!=null){for(var F=0;F<s.Configuration.ItemActionLinks.length;F++){var j=s.Configuration.ItemActionLinks[F];if(i.DisabledItemActionLinks){var $=i.DisabledItemActionLinks.filter(function(e){return e.EntityId==n.Id&&e.LinkUniqueId==j.FilterCriteriaId});if($&&$.length){continue}else if(j.Type===2){var H=Le(j);if(H!=null){O=URI(H).addSearch(j.QueryStringIdParameterName,n.Id.toString())}else{P=j}break}}}if(O==="#"){O=URI(Le(s.Configuration.DetailsActionLink)).addSearch(s.Configuration.DetailsActionLink.QueryStringIdParameterName,n.Id.toString())}}var U="";if(u.isHtml){U=be("<a></a>").attr("href",O).addClass("details-link").addClass("has-tooltip").attr("data-toggle","tooltip").attr("title",s.Configuration.DetailsActionLink.Tooltip).html(u.value)}else{U=be("<a></a>").attr("href",O).addClass("details-link").addClass("has-tooltip").attr("data-toggle","tooltip").attr("title",s.Configuration.DetailsActionLink.Tooltip).text(u.value)}if(P&&P.EntityForm!=null){U=be("<a></a>").attr("href",O).addClass("edit-link").addClass("has-tooltip").attr("data-toggle","tooltip").attr("title",window.ResourceManager["Edit_Label"]).html(u.value)}if(O!="#"&&f)U.attr("target","_top");if(P&&P.EntityForm!=null){U.addClass("launch-modal").attr("data-entityformid",P.EntityForm.Id)}else if(s.Configuration.DetailsActionLink.EntityForm){U.addClass("launch-modal").attr("data-entityformid",s.Configuration.DetailsActionLink.EntityForm.Id)}u.value=U;u.isHtml=true}return u};function R(e,t,a,n,i,r){const o=new CustomEvent("updateCard",{detail:{value:{id:e,base64config:t,searchPhrase:a,filter:n,odataFilter:i,nlSearchFilter:r}}});window.dispatchEvent(o)}o.prototype.addSortEventHandlers=function(){var r=this;var e=r._element;var o=e.children(".view-grid").find("table");var t=e.data("id");const a=document.querySelector('[data-id="'+t+'"]');nlSearchFilter=a?a.dataset["nlSearchFilter"]:null;o.find("th.sort-enabled a").on("click",function(e){e.preventDefault();if(!M){o.find("th.sort-enabled a").attr("disabled","disabled").css({"pointer-events":"none",cursor:"default"});M=true}var t=be(this).closest("th");be(this).find(".fa-arrow-down").remove();be(this).find(".fa-arrow-up").remove();be(this).find(".sort-hint").remove();var a=t.data("sort-name");var n=t.data("sort-dir");if(typeof a===typeof undefined||a===false||a===null||a===""){return}if(typeof n===typeof undefined||n===false){n=""}var i;if(n=="ASC"){i=a+" DESC";t.data("sort-dir","DESC").removeClass("sort-asc").addClass("sort-desc");be(this).parent().attr("aria-sort","descending");be(this).append(" ").append(be("<span></span>").addClass("fa").addClass("fa-arrow-down")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Ascending_Order"]+"</span>")}else{i=a+" ASC";t.data("sort-dir","ASC").removeClass("sort-desc").addClass("sort-asc");be(this).parent().attr("aria-sort","ascending");be(this).append(" ").append(be("<span></span>").addClass("fa").addClass("fa-arrow-up")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>")}t.addClass("sort");o.data("sort-expression",i);o.find("th.sort a").each(function(){var e=be(this).closest("th");var t=e.data("sort-name");if(typeof t===typeof undefined||t===false||t===null||t===""){return}if(t!=a){be(this).find(".fa-arrow-down").remove();be(this).find(".fa-arrow-up").remove();e.removeClass("sort-asc").removeClass("sort-desc").removeClass("sort").data("sort-dir","");be(this).parent().removeAttr("aria-sort")}});r.load(false,nlSearchFilter,1)})};function _(e,t,a){if(typeof e!==typeof undefined&&e!==false&&e!=null&&e!=""){var n=r(t);var i=be("<div class='notification alert alert-success success alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"+e+"</div>").on("closed.bs.alert",function(){if(n.find(".notification").length==0)n.hide()}).prependTo(n);n.show();be("html, body").animate({scrollTop:i.length?i.offset().top-20:0},200)}}function r(e){var t=be(".notifications");if(t.length==0){var a=be(".page-heading");if(a.length==0){var n=be("#content-container");if(n.length==0){var i=false;if(e){var r=e.parentsUntil("form");if(r.length>0){var o=be(r[r.length-1]).find("div:visible:first");if(o.length>0){t=be("<div class='notifications'></div>").appendTo(o);i=true}}if(!i){var t=e.find(".subgrid-notifications");if(t.length==0){t=be("<div class='subgrid-notifications'></div>").prependTo(e)}}}}else{t=be("<div class='notifications'></div>").prependTo(n)}}else{t=be("<div class='notifications'></div>").appendTo(a)}}t.find(".notification").slideUp().remove();return t}function w(e,t){if(typeof t==typeof undefined||t==null){e.trigger("refresh");return}var a=0;var n=1;var i=2;var r=typeof t.OnComplete!=typeof undefined&&t.OnComplete!=null&&t.OnComplete!=a;if(r){var o=d(t);if(o!=null&&o!=""){l(o)}else{e.trigger("refresh")}}else{e.trigger("refresh")}}function L(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null){ClientLogWrapper.getLogger().traceError("EntityGrid getError(): jqXhr object is null. Error "+t,"entity_grid");return t}try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?be.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}ClientLogWrapper.getLogger().traceError("EntityGrid getError(): Error - "+t,"entity_grid");return t}o.prototype.addCreateRelatedRecordLinkEventHandler=function(){var e=this;var u=e._element;var t=e._layouts;var p=t[e._activeLayoutIndex];var a=e._enableActions;var n=u.children(".view-grid").find("table");if(!a){return}n.find(".create-related-record-link.launch-modal").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=t.data("relationship");var r=a.data("entity");var o=be(this).data("entityformid");var l=u.children(".modal-form-createrecord").first();if(l[0].getAttribute("data-filtercriteriaid")!=null){u.children(".modal-form-createrecord").each(function(e){if(this.getAttribute("data-filtercriteriaid")==t[0].getAttribute("data-filtercriteriaid")){l=u.children(".modal-form-createrecord:eq("+e+")");return false}})}var d=l.find("iframe");var s=d.data("page");if(!o){return}var c=s+"?id="+n+"&entityformid="+o+"&languagecode="+p.Configuration.LanguageCode;var f=oe(c,r,n,i);if(t[0]!=undefined){d.attr("title",t[0].text)}d.attr("src",f);d.on("load",function(){l.find(".form-loading").hide();l.find("iframe").contents().find("#EntityFormControl").show()});l.find(".modal-title").html(be(this)[0].innerText);l.find(".form-loading").show();l.find("iframe").contents().find("#EntityFormControl").hide();l.on("show.bs.modal",function(){l.attr("aria-hidden","false")});l.modal();l.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){l.attr("aria-hidden","true");t.closest(".action").children("a").trigger("focus")})})};o.prototype.addDetailsActionLinkClickEventHandlers=function(){var e=this;var s=e._element;var t=e._layouts;var c=t[e._activeLayoutIndex];var a=e._enableActions;var n=s.children(".view-grid").find("table");if(!a){return}n.find(".details-link.launch-modal").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=s.children(".modal-form-details");var r=i.find("iframe");var o=r.data("page");var l=be(this).data("entityformid");if(!l)return;var d=getUrlWithRelatedReference(s,o+"?id="+n+"&entityformid="+l+"&languagecode="+c.Configuration.LanguageCode);if(t[0]!=undefined){r.attr("title",t[0].text)}r.attr("src",d);r.on("load",function(){i.find(".form-loading").hide();i.find("iframe").contents().find("#EntityFormControl").show()});i.find(".form-loading").show();i.find("iframe").contents().find("#EntityFormControl").hide();i.on("show.bs.modal",function(){i.attr("aria-hidden","false");i.attr("aria-label",t[0].text+" "+"dialog")});i.on("shown.bs.modal",function(){$closeBtn=be(this).find("button:visible:first");setTimeout(function(){if(document.activeElement.nodeName=="SECTION"){$closeBtn.trigger("focus")}},4e3)});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})};setInterval(function(){be(".modal-form-details").each(function(){be(this).off("hide.bs.modal").on("hide.bs.modal",function(){if(t()){var e=window.ResourceManager["Click_Stay_To_Save_Your_Changes"];if(confirm(e)){return false}else{a()}}else{return true}})})},100);function t(){if(be("iframe[data-page]:visible").contents().find(".dirty").length>0){return true}else return false}function a(){var e=be("iframe[data-page]:visible").contents().find(".dirty");for(var t=0,a=e.length;t<a;t++){var n="dirty";var i=new RegExp("(\\s|^)"+n+"(\\s|$)");e[t].className=e[t].className.replace(i,"")}}o.prototype.addEditActionLinkClickEventHandlers=function(){var e=this;var s=e._element;var t=e._layouts;var c=t[e._activeLayoutIndex];var a=e._enableActions;var n=s.children(".view-grid").find("table");if(!a){return}n.find(".edit-link.launch-modal").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=s.children(".modal-form-edit");var r=i.find("iframe");var o=r.data("page");var l=be(this).data("entityformid");if(!l)return;var d=getUrlWithRelatedReference(s,o+"?id="+n+"&entityformid="+l+"&languagecode="+c.Configuration.LanguageCode);if(t[0]!=undefined){r.attr("title",t[0].text)}r.attr("src",d);r.on("load",function(){i.find(".form-loading").hide();i.find("iframe").contents().find("#EntityFormControl").show()});i.find(".form-loading").show();i.find("iframe").contents().find("#EntityFormControl").hide();i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})};be(document).on("keydown",function(e){if(e.key=="Escape"){if(be(".tooltip").length>0){e.preventDefault();be(".tooltip").remove()}parent.focus();be(".modal.in").find(".form-close").click()}});o.prototype.addDeleteActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.DeleteActionLink.Enabled&&!l.Configuration.DeleteActionLink.URL){return}var d=Le(l.Configuration.DeleteActionLink);n.find(".delete-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-delete");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){var e=o.children(".view-grid").find("tbody tr").length;if(e==1){var t=o.children(".view-pagination");var a=t.data("current-page");if(a>1){a--;t.data("current-page",a)}}i.modal("hide");_(l.Configuration.DeleteActionLink.SuccessMessage,o,true);w(o,l.Configuration.DeleteActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})};o.prototype.addQualifyLeadActionLinkClickEventHandlers=function(){var e=this;var l=e._element;var t=e._layouts;var d=t[e._activeLayoutIndex];var a=e._enableActions;var n=l.children(".view-grid").find("table");if(!a||!d.Configuration.QualifyLeadActionLink.Enabled&&!d.Configuration.QualifyLeadActionLink.URL){return}var s=Le(d.Configuration.QualifyLeadActionLink);if(d.Configuration.QualifyLeadActionLink.ShowModal==1){n.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var i=a.data("id");var r=l.children(".modal-qualify");var o=r.find("button.primary");o.off("click");o.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.createAccount=true;t.createContact=true;t.createOpportunity=true;var a={};a.LogicalName=d.Configuration.EntityName;a.Id=i;t.entityReference=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:s,data:n}).done(function(){r.modal("hide");_(d.Configuration.QualifyLeadActionLink.SuccessMessage,l,true);w(l,d.Configuration.QualifyLeadActionLink)}).fail(function(e){r.modal("hide");Se(L(e),l)}).always(function(){o.prop("disabled",false).find(".fa-spin").remove()})});r.on("show.bs.modal",function(){r.attr("aria-hidden","false")});r.modal();r.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){r.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".qualify-lead-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.createAccount=true;n.createContact=true;n.createOpportunity=true;var i={};i.LogicalName=d.Configuration.EntityName;i.Id=a;n.entityReference=i;var r=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:s,data:r}).done(function(){_(d.Configuration.QualifyLeadActionLink.SuccessMessage,l,true);w(l,d.Configuration.QualifyLeadActionLink)}).fail(function(e){Se(L(e),l)}).always(function(){})})}};o.prototype.addCloseCaseActionLinkClickEventHandlers=function(){var e=this;var s=e._element;var t=e._layouts;var c=t[e._activeLayoutIndex];var a=e._enableActions;var n=s.children(".view-grid").find("table");if(!a||!c.Configuration.CloseIncidentActionLink.Enabled&&!c.Configuration.CloseIncidentActionLink.URL){return}var f=Le(c.Configuration.CloseIncidentActionLink);if(c.Configuration.CloseIncidentActionLink.ShowModal==1){n.find(".close-case-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var o=a.data("id");var l=s.children(".modal-closecase");var d=l.find("button.primary");d.off("click");d.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=c.Configuration.EntityName;a.Id=o;t.entityReference=a;var n=c.Configuration.CloseIncidentActionLink.DefaultResolution;var i=c.Configuration.CloseIncidentActionLink.DefaultResolutionDescription;t.resolutionSubject=n;t.resolutionDescription=i;var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:f,data:r}).done(function(){l.modal("hide");_(c.Configuration.CloseIncidentActionLink.SuccessMessage,s,true);w(s,c.Configuration.CloseIncidentActionLink)}).fail(function(e){l.modal("hide");Se(L(e),s)}).always(function(){d.prop("disabled",false).find(".fa-spin").remove()})});l.on("show.bs.modal",function(){l.attr("aria-hidden","false")});l.modal();l.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){l.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".close-case-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i={};var r={};r.LogicalName=c.Configuration.EntityName;r.Id=n;i.entityReference=r;var o=c.Configuration.CloseIncidentActionLink.DefaultResolution;var l=c.Configuration.CloseIncidentActionLink.DefaultResolutionDescription;i.resolutionSubject=o;i.resolutionDescription=l;var d=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:f,data:d}).done(function(){_(c.Configuration.CloseIncidentActionLink.SuccessMessage,s,true);w(s,c.Configuration.CloseIncidentActionLink)}).fail(function(e){Se(L(e),s)}).always(function(){})})}};o.prototype.addConvertQuoteActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ConvertQuoteToOrderActionLink.Enabled&&!l.Configuration.ConvertQuoteToOrderActionLink.URL){return}var d=Le(l.Configuration.ConvertQuoteToOrderActionLink);if(l.Configuration.ConvertQuoteToOrderActionLink.ShowModal==1){n.find(".convert-quote-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-convert-quote");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.ConvertQuoteToOrderActionLink.SuccessMessage,o,true);w(o,l.Configuration.ConvertQuoteToOrderActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".convert-quote-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.ConvertQuoteToOrderActionLink.SuccessMessage,o,true);w(o,l.Configuration.ConvertQuoteToOrderActionLink)}).fail(function(e){Se(L(e),o)}).always(function(){})})}};o.prototype.addConvertOrderActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ConvertOrderToInvoiceActionLink.Enabled&&!l.Configuration.ConvertOrderToInvoiceActionLink.URL){return}var d=Le(l.Configuration.ConvertOrderToInvoiceActionLink);if(l.Configuration.ConvertOrderToInvoiceActionLink.ShowModal==1){n.find(".convert-order-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-convert-order");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.ConvertOrderToInvoiceActionLink.SuccessMessage,o,true);w(o,l.Configuration.ConvertOrderToInvoiceActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".convert-order-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.ConvertOrderToInvoiceActionLink.SuccessMessage,o,true);w(o,l.Configuration.ConvertOrderToInvoiceActionLink)}).fail(function(e){Se(L(e),o)}).always(function(){})})}};o.prototype.addCalculateOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.CalculateOpportunityActionLink.Enabled&&!l.Configuration.CalculateOpportunityActionLink.URL){return}var d=Le(l.Configuration.CalculateOpportunityActionLink);if(l.Configuration.CalculateOpportunityActionLink.ShowModal==1){n.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-calculate");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.CalculateOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.CalculateOpportunityActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".calculate-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.CalculateOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.CalculateOpportunityActionLink)}).fail(function(e){Se(L(e),o)}).always(function(){})})}};o.prototype.addResolveCaseActionLinkClickEventHandlers=function(){var e=this;var d=e._element;var t=e._layouts;var s=t[e._activeLayoutIndex];var a=e._enableActions;var n=d.children(".view-grid").find("table");if(!a||!s.Configuration.ResolveCaseActionLink.Enabled&&!s.Configuration.ResolveCaseActionLink.URL){return}var c=Le(s.Configuration.ResolveCaseActionLink);var f=d.children(".modal-resolvecase");n.find(".resolve-case-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var o=a.data("id");var l=f.find("button.primary");l.off("click");l.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};var a={};a.LogicalName=s.Configuration.EntityName;a.Id=o;t.entityReference=a;var n=f.find(".resolution-input");t.resolutionSubject=n.val();var i=f.find(".resolution-description-input");t.resolutionDescription=i.val();var r=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:c,data:r}).done(function(){f.modal("hide");_(s.Configuration.ResolveCaseActionLink.SuccessMessage,d,true);w(d,s.Configuration.ResolveCaseActionLink)}).fail(function(e){f.modal("hide");Se(L(e),d)}).always(function(){l.prop("disabled",false).find(".fa-spin").remove()})});f.on("show.bs.modal",function(){f.attr("aria-hidden","false")});f.modal();f.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){f.attr("aria-hidden","true");f.find(".resolution-input").val("");f.find(".resolution-description-input").val("");t.closest(".action").children("button").trigger("focus")})})};o.prototype.addReopenCaseActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ReopenCaseActionLink.Enabled&&!l.Configuration.ReopenCaseActionLink.URL){return}var d=Le(l.Configuration.ReopenCaseActionLink);if(l.Configuration.ReopenCaseActionLink.ShowModal==1){n.find(".reopen-case-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-reopencase");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.ReopenCaseActionLink.SuccessMessage,o,true);w(o,l.Configuration.ReopenCaseActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".reopen-case-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.ReopenCaseActionLink.SuccessMessage,o,true);w(o,l.Configuration.ReopenCaseActionLink)}).fail(function(e){Se(L(e),o)}).always(function(){})})}};o.prototype.addCancelCaseActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.CancelCaseActionLink.Enabled&&!l.Configuration.CancelCaseActionLink.URL){return}var d=Le(l.Configuration.CancelCaseActionLink);if(l.Configuration.CancelCaseActionLink.ShowModal==1){n.find(".cancel-case-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-cancelcase");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.CancelCaseActionLink.SuccessMessage,o,true);w(o,l.Configuration.CancelCaseActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".cancel-case-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.CancelCaseActionLink.SuccessMessage,o,true);w(o,l.Configuration.CancelCaseActionLink)}).fail(function(e){Se(L(e),o)}).always(function(){})})}};o.prototype.addActivateActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ActivateActionLink.Enabled&&!l.Configuration.ActivateActionLink.URL){return}var d=Le(l.Configuration.ActivateActionLink);if(l.Configuration.ActivateActionLink.ShowModal==1){n.find(".activate-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-activate");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.ActivateActionLink.SuccessMessage,o,true);w(o,l.Configuration.ActivateActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".activate-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.ActivateActionLink.SuccessMessage,o,true);w(o,l.Configuration.ActivateActionLink)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addDeactivateActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.DeactivateActionLink.Enabled&&!l.Configuration.DeactivateActionLink.URL){return}var d=Le(l.Configuration.DeactivateActionLink);if(l.Configuration.DeactivateActionLink.ShowModal==1){n.find(".deactivate-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-deactivate");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.DeactivateActionLink.SuccessMessage,o,true);w(o,l.Configuration.DeactivateActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".deactivate-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.DeactivateActionLink.SuccessMessage,o,true);w(o,l.Configuration.DeactivateActionLink)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addActivateQuoteActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ActivateQuoteActionLink.Enabled&&!l.Configuration.ActivateQuoteActionLink.URL){return}var d=Le(l.Configuration.ActivateQuoteActionLink);if(l.Configuration.ActivateQuoteActionLink.ShowModal==1){n.find(".activate-quote-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-activate-quote");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.ActivateQuoteActionLink.SuccessMessage,o,true);w(o,l.Configuration.ActivateQuoteActionLin)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".activate-quote-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.ActivateQuoteActionLink.SuccessMessage,o,true);w(o,l.Configuration.ActivateQuoteActionLin)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addSetOpportunityOnHoldActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.SetOpportunityOnHoldActionLink.Enabled&&!l.Configuration.SetOpportunityOnHoldActionLink.URL){return}var d=Le(l.Configuration.SetOpportunityOnHoldActionLink);if(l.Configuration.SetOpportunityOnHoldActionLink.ShowModal==1){n.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-set-opportunity-on-hold");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.SetOpportunityOnHoldActionLink.SuccessMessage,o,true);w(o,l.Configuration.SetOpportunityOnHoldActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".set-opportunity-on-hold-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.SetOpportunityOnHoldActionLink.SuccessMessage,o,true);w(o,l.Configuration.SetOpportunityOnHoldActionLink)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addReopenOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.ReopenOpportunityActionLink.Enabled&&!l.Configuration.ReopenOpportunityActionLink.URL){return}var d=Le(l.Configuration.ReopenOpportunityActionLink);if(l.Configuration.ReopenOpportunityActionLink.ShowModal==1){n.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-reopen-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.ReopenOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.ReopenOpportunityActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".reopen-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.ReopenOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.ReopenOpportunityActionLink)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addWinOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.WinOpportunityActionLink.Enabled&&!l.Configuration.WinOpportunityActionLink.URL){return}var d=Le(l.Configuration.WinOpportunityActionLink);if(l.Configuration.WinOpportunityActionLink.ShowModal==1){n.find(".win-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-win-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.WinOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.WinOpportunityActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".win-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.WinOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.WinOpportunityActionLink)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addLoseOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.LoseOpportunityActionLink.Enabled&&!l.Configuration.LoseOpportunityActionLink.URL){return}var d=Le(l.Configuration.LoseOpportunityActionLink);if(l.Configuration.LoseOpportunityActionLink.ShowModal==1){n.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-lose-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.LoseOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.LoseOpportunityActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".lose-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.LoseOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.LoseOpportunityActionLink)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addGenerateQuoteFromOpportunityActionLinkClickEventHandlers=function(){var e=this;var o=e._element;var t=e._layouts;var l=t[e._activeLayoutIndex];var a=e._enableActions;var n=o.children(".view-grid").find("table");if(!a||!l.Configuration.GenerateQuoteFromOpportunityActionLink.Enabled&&!l.Configuration.GenerateQuoteFromOpportunityActionLink.URL){return}var d=Le(l.Configuration.GenerateQuoteFromOpportunityActionLink);if(l.Configuration.GenerateQuoteFromOpportunityActionLink.ShowModal==1){n.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=o.children(".modal-generate-quote-from-opportunity");var r=i.find("button.primary");r.off("click");r.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t={};t.LogicalName=l.Configuration.EntityName;t.Id=n;var a=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:a}).done(function(){i.modal("hide");_(l.Configuration.GenerateQuoteFromOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){i.modal("hide");Se(L(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})});i.on("show.bs.modal",function(){i.attr("aria-hidden","false")});i.modal();i.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){i.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".generate-quote-from-opportunity-link").on("click",function(e){e.preventDefault();var t=be(this).closest("tr");var a=t.data("id");var n={};n.LogicalName=l.Configuration.EntityName;n.Id=a;var i=JSON.stringify(n);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:d,data:i}).done(function(){_(l.Configuration.GenerateQuoteFromOpportunityActionLink.SuccessMessage,o,true);w(o,l.Configuration.GenerateQuoteFromOpportunityActionLink)}).fail(function(e){Se(L(e),o)})})}};o.prototype.addDisassociateActionLinkClickEventHandlers=function(){var e=this;var v=e._element;var t=e._layouts;var h=t[e._activeLayoutIndex];var a=e._enableActions;var n=v.children(".view-grid").find("table");if(!a||!h.Configuration.DisassociateActionLink.Enabled||!h.Configuration.DisassociateActionLink.URL){return}var m=Le(h.Configuration.DisassociateActionLink);if(h.Configuration.DisassociateActionLink.ShowModal==1){n.find(".disassociate-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var f=a.data("id");var u=v.children(".modal-disassociate");var p=u.find("button.primary");p.off("click");p.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t=v.data("ref-entity");var a=v.data("ref-id");var n=v.data("ref-rel");var i=v.data("ref-rel-role");if(!t||!a||!n){return}var r={LogicalName:t,Id:a};var o={SchemaName:n};if(i){o.PrimaryEntityRole=i}var l={};l.LogicalName=h.Configuration.EntityName;l.Id=f;var d=[];d[0]=l;var s={};s.target=r;s.RelatedEntities=d;s.Relationship=o;var c=JSON.stringify(s);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:m,data:c}).done(function(){u.modal("hide");_(h.Configuration.DisassociateActionLink.SuccessMessage,v,true);w(v,h.Configuration.DisassociateActionLink)}).fail(function(e){u.modal("hide");Se(L(e),v)}).always(function(){p.prop("disabled",false).find(".fa-spin").remove()})});u.on("show.bs.modal",function(){u.attr("aria-hidden","false")});u.modal();u.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){u.attr("aria-hidden","true");t.closest(".action").children("button").trigger("focus")})})}else{n.find(".disassociate-link").on("click",function(e){e.preventDefault();var t=be(this);var a=be(this).closest("tr");var n=a.data("id");var i=v.data("ref-entity");var r=v.data("ref-id");var o=v.data("ref-rel");var l=v.data("ref-rel-role");if(!i||!r||!o){return}var d={LogicalName:i,Id:r};var s={SchemaName:o};if(l){s.PrimaryEntityRole=l}var c={};c.LogicalName=h.Configuration.EntityName;c.Id=n;var f=[];f[0]=c;var u={};u.target=d;u.RelatedEntities=f;u.Relationship=s;var p=JSON.stringify(u);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:m,data:p}).done(function(){_(h.Configuration.DisassociateActionLink.SuccessMessage,v,true);w(v,h.Configuration.DisassociateActionLink)}).fail(function(e){Se(L(e),v)})})}};o.prototype.addWorkflowActionLinkClickEventHandlers=function(){var e=this;var C=e._element;var t=e._layouts;var k=t[e._activeLayoutIndex];var a=e._enableActions;var n=C.children(".view-grid").find("table");if(!a||!k.Configuration.ItemActionLinks||k.Configuration.ItemActionLinks.length==0){return}var i=null;for(var r=0;r<k.Configuration.ItemActionLinks.length;r++){var o=k.Configuration.ItemActionLinks[r];if(o!=null&&typeof o.Type!==typeof undefined&&o.Type==7&&typeof o.Workflow!==typeof undefined&&o.Workflow!=null){i=o;break}}if(i==null)return;n.find(".workflow-link").on("click",function(e){e.preventDefault();var t=be(this).data("modal");if(t==1){var a=be(this);var n=be(this).closest("tr");var d=n.data("id");var s=be(this).data("workflowid");var c=C.children(".modal-run-workflow");var f=c.find("button.primary");var u=be(this).data("url");if(!s||!u){return}var i=be(this).data("modal-title");if(i){c.find(".modal-title").html(i)}var r=be(this).data("modal-confirmation");if(r){c.find(".modal-body").html(r)}var o=be(this).data("modal-primary-action");if(o){f.html(o);f.attr("title",o);f.attr("aria-label",o)}var l=be(this).data("modal-cancel-action");if(l){c.find(".cancel").html(l)}f.off("click");f.on("click",function(e){e.preventDefault();be(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var t=null;for(var a=0;a<k.Configuration.ItemActionLinks.length;a++){var n=k.Configuration.ItemActionLinks[a];if(n!=null&&typeof n.Type!==typeof undefined&&n.Type==7&&typeof n.Workflow!==typeof undefined&&n.Workflow!=null&&n.Workflow.Id==s){t=n;break}}var i={};var r={};r.LogicalName="workflow";r.Id=s;i.workflow=r;var o={};o.LogicalName=k.Configuration.EntityName;o.Id=d;i.entity=o;var l=JSON.stringify(i);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:u,data:l}).done(function(){c.modal("hide");_(t!=null?t.SuccessMessage:null,C,true);w(C,t)}).fail(function(e){c.modal("hide");Se(L(e),C)}).always(function(){f.prop("disabled",false).find(".fa-spin").remove()})});c.on("show.bs.modal",function(){c.attr("aria-hidden","false")});c.modal();c.off("hidden.bs.modal.entitygrid").on("hidden.bs.modal.entitygrid",function(){c.attr("aria-hidden","true");a.closest(".action").children("button").trigger("focus")})}else{var n=be(this).closest("tr");var d=n.data("id");var s=be(this).data("workflowid");var u=be(this).data("url");if(!s||!u){return}var p=null;for(var v=0;v<k.Configuration.ItemActionLinks.length;v++){var h=k.Configuration.ItemActionLinks[v];if(h!=null&&typeof h.Type!==typeof undefined&&h.Type==7&&typeof h.Workflow!==typeof undefined&&h.Workflow!=null&&h.Workflow.Id==s){p=h;break}}var m={};var g={};g.LogicalName="workflow";g.Id=s;m.workflow=g;var y={};y.LogicalName=k.Configuration.EntityName;y.Id=d;m.entity=y;var b=JSON.stringify(m);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:u,data:b}).done(function(){_(p!=null?p.SuccessMessage:null,C,true);w(C,p)}).fail(function(e){Se(L(e),C)})}})};o.prototype.initializePagination=function(e,t){var i=this;var a=i._element;var n=a.children(".view-pagination");var r=a.data("id");const o=document.querySelector('[data-id="'+r+'"]');nlSearchFilter=o?o.dataset["nlSearchFilter"]:null;if(typeof e===typeof undefined||e===false||e==null){n.hide();return}if(typeof e.PageSize===typeof undefined||e.PageSize===false||e.PageSize==null||(typeof e.PageCount===typeof undefined||e.PageCount===false||e.PageCount==null)||(typeof e.PageNumber===typeof undefined||e.PageNumber===false||e.PageNumber==null)||(typeof e.ItemCount===typeof undefined||e.ItemCount===false||e.ItemCount==null)){n.hide();return}if(e.ItemCount===-1){i.initializePager(n,e,t);return}if(e.PageCount<=1){n.hide();return}if(e.PageNumber>e.PageCount){e.PageCount=e.PageNumber}if(e.PageNumber===e.PageCount&&e.MoreRecords){e.PageCount++}n.data("pagesize",e.PageSize).data("pages",e.PageCount).data("current-page",e.PageNumber).data("count",e.ItemCount).off("click").pagination({total_pages:n.data("pages"),current_page:n.data("current-page"),callback:function(e,t){e.preventDefault();var a=be(e.target).closest("li");if(a.not(".disabled").length>0&&a.not(".active").length>0){var n=i.getCurrentFilter();i.load(false,nlSearchFilter,t,n,!i.isRelatedRecordFilterEnabled(),e.currentTarget,i._searchPhrase)}}}).show();n.find("li").first().find("a").attr("data-toggle","tooltip").attr("aria-label",window.ResourceManager["Pagination_Previous_Page"]).attr("title",window.ResourceManager["Pagination_Previous_Page"]).addClass("entity-pager-prev-link");n.find("li").last().find("a").attr("data-toggle","tooltip").attr("aria-label",window.ResourceManager["Pagination_Next_Page"]).attr("title",window.ResourceManager["Pagination_Next_Page"]).addClass("entity-pager-next-link");n.find("li.active").find("a").removeAttr("aria-label");n.find("li.active").find("a").attr("aria-current",window.ResourceManager["Pagination_Shortname"]);n.find("li.disabled").find("a").removeAttr("href");n.find("li.disabled").find("a").attr("aria-disabled","true");a.children(".view-grid").addClass("has-pagination");a.children(".view-grid").css("height","");be("ul>li>a[data-page='..']",n).attr("aria-label",window.ResourceManager["Load_More_Pages"]);var l=be("[dir=rtl]").length>0?"left":"right";n.find("li").first().find("a").tooltip({trigger:"hover",placement:l});n.find("li").last().find("a").tooltip({trigger:"hover",placement:l});if(t){n.find("a").filter(function(){return be(this).text()==be(t).text()}).trigger("focus")}if(t!=undefined&&e.PageNumber==1&&t.className.includes("entity-pager-prev-link")){ClientLogWrapper.getLogger().traceInfo("EntityGrid initializePagination: Previous button of lookup is disabled, shifting the focus","entity_grid");let e=be("a.entity-pager-prev-link").closest(".pagination").find("li.active");if(e!=undefined&&e.length!=0){e.attr("tabindex","-1");e.trigger("focus");ClientLogWrapper.getLogger().traceInfo("EntityGrid initializePagination: Successfully Shifted the focus from previous button to active li","entity_grid")}}if(t!=undefined&&!e.MoreRecords&&t.className.includes("entity-pager-next-link")){ClientLogWrapper.getLogger().traceInfo("EntityGrid initializePagination: Next button of lookup is disabled, shifting the focus","entity_grid");let e=be("a.entity-pager-next-link").closest(".pagination").find("li.active");if(e!=undefined&&e.length!=0){e.attr("tabindex","-1");e.trigger("focus");ClientLogWrapper.getLogger().traceInfo("EntityGrid initializePagination: Successfully Shifted the focus from next button to active li","entity_grid")}}};o.prototype.hidePagination=function(){this._element.children(".view-pagination").hide();this._element.children(".view-grid").removeClass("has-pagination")};o.prototype.initializePager=function(e,t,a){var r=this;var n=r._element;var i=n.data("id");const o=document.querySelector('[data-id="'+i+'"]');nlSearchFilter=o?o.dataset["nlSearchFilter"]:null;var l=window.ResourceManager["Pagination_First_Page"];var d=be("<a>").attr("href","#").data("page",1).attr("aria-label",l).attr("title",l).text("|<");var s=be("<li>").append(d);var c=window.ResourceManager["Pagination_Previous_Page"];var f=be("<a>").attr("href","#").attr("aria-label",c).attr("title",c).text("<");var u=be("<li>").append(f);var p=be("<li>").addClass("active").append(be("<span>").text(t.PageNumber));var v=window.ResourceManager["Pagination_Next_Page"];var h=be("<a>").attr("href","#").attr("aria-label",v).attr("title",v).text(">");var m=be("<li>").append(h);var g=be("<ul>").addClass("pagination").append(s).append(u).append(p).append(m);e.empty();if(t.PageNumber===1&&!t.MoreRecords){e.hide();return}if(t.PageNumber>1){f.data("page",t.PageNumber-1)}else{s.addClass("disabled");d.attr("aria-disabled",true);u.addClass("disabled");f.attr("aria-disabled",true)}if(t.MoreRecords){h.data("page",t.PageNumber+1)}else{m.addClass("disabled");h.attr("aria-disabled",true)}e.data("pagesize",t.PageSize).data("current-page",t.PageNumber).data("more-records",t.MoreRecords).off("click").append(g).on("click","a",function(e){e.preventDefault();var t=be(e.target);var a=t.data("page");var n=t.closest("li");if(n.not(".disabled").length>0&&n.not(".active").length>0){var i=r.getCurrentFilter();r.load(true,nlSearchFilter,a,i,!r.isRelatedRecordFilterEnabled(),e.currentTarget,r._searchPhrase)}}).show();n.children(".view-grid").addClass("has-pagination");if(a){e.find("a").filter(function(){return be(this).text()==be(a).text()}).trigger("focus")}};o.prototype.createWindowMessageEventHandler=function(){return function(e){var t=null;if(!window.location.origin){t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}else{t=window.location.origin}if(e.origin!=t){return}if(e.data=="Success"){this._element.children(".modal-form").modal("hide");this._element.trigger("refresh")}}.bind(this)};o.prototype.resetPagination=function(){var e=this;var t=e._element;var a=t.children(".view-pagination");a.data("pages",1).data("current-page",1)};function de(e){var a=[];var t=function(e){var t=e.data("columnname");if(t){t=t.replace(/<(?:.|\n)*?>/gm,"").trim();return t}var a=e.children("a");var n=a.length>0?a.first():e;var i=n.contents().get(0);return i?i.nodeValue:""};e.find("thead th").each(function(){var e=be(this);a.push(t(e))});e.find("tbody tr").each(function(){be(this).find("td").each(function(e){var t=be(this)[0].innerText;be(this).attr("data-th",a[e]).attr("aria-label",t);if(be(this).attr("addAriaLabel")=="true"){be(this).attr("aria-label",window.ResourceManager["ActionLink_Aria_Label"]);be(this).removeAttr("addAriaLabel")}});if(a[0]==window.ResourceManager["Select_Column_Header_Text"]){var t=be(this).find("td:first-child span").attr("role","checkbox").attr("aria-label",window.ResourceManager["Aria_Label_For_Checkbox"]).attr("title",window.ResourceManager["Aria_Label_And_Title_For_Checkbox"]).attr("tabindex",0);let e=t.parent().next("td").first();if(e!=null&&e.length!=0){t.attr("aria-label",window.ResourceManager["Aria_Label_For_Checkbox"]+" "+e.text())}t.hasClass("fa-check")?t.attr("aria-checked","true"):t.attr("aria-checked","false")}})}function n(e,t){t.prop("aria-hidden",false);if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a="Error";var n=t.find(".modal-title");var i=t.find(".modal-body");n.data("title",n.html());if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){a=e.Message+" Error"}else{a=e.Message}}n.addClass("text-danger").html("<span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+a);if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){i.html("<p>"+e.InnerError.Message+"</p>")}}t.modal()}function Ee(e){var t=[];if(e==null){return t}var a=/(\w+)\s*(asc|ascending|desc|descending)?\s*(,)?/gi;var n=e.match(a);if(n==null){return t}for(var i=0;i<n.length;i++){var r=n[i];if(r!=null&&r!=""){var o;var l="ASC";var d=r.indexOf(" ");if(d!=-1){o=r.substr(0,d);l=r.substr(d+1,r.length-d)}else{o=r}if(o!=null){o=o.replace(/,\s*$/,"")}if(l!=null){l=l.replace(/,\s*$/,"")}var s={name:o,direction:l};t.push(s)}}return t}function Ae(e,a,n){var i=-1;be.each(e,function(e,t){if(t[a].toString().toLowerCase().indexOf(n.toString().toLowerCase())!=-1){i=e;return false}});return i}if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){t=t||0;return this.lastIndexOf(e,t)===t}}function se(e){var t,a,n;if(!e){return null}t=e.Attributes||[];for(a=0;a<t.length;a++){n=t[a];if(n&&n.AttributeMetadata&&n.AttributeMetadata.EntityLogicalName===e.EntityName&&n.AttributeMetadata.IsPrimaryName){return n.DisplayValue}}}function ce(e){if(!e||!e.RedirectUrl)return null;return i(e.RedirectUrl)}function i(e){if(!e)return null;return URI(e.PathWithQueryString)}function S(e){var t=[];if(!e)return t;if(e.EntityName==="entitlement"){var a=be("#customerid").val();if(a){var n=be("#customerid_entityname").val();var i=be("#primarycontactid").val();var r=be("#productid").val();t=[{Key:"customerid",Value:a},{Key:"customertype",Value:n},{Key:"primarycontactid",Value:i},{Key:"productid",Value:r}]}else if(be("#customerid").length<=0){t=s()}return t}else if(e.ModalLookupEntityLogicalName==="opportunityproduct"){t=[{Key:"productid",Value:be("#productid").val()},{Key:"uomid",Value:be("#uomid").val()}];return t}else{return t}}function l(e){if(typeof e=="undefined"||e==null||e=="")return;be.blockUI({css:{border:"none",backgroundColor:"transparent",opacity:.5,color:"#fff"},message:"<span class='fa fa-2x fa-spinner fa-pulse' aria-hidden='true'></span>"});if(parent){parent.location.replace(e)}else{window.location.replace(e)}}function d(e){if(!e||!e.RedirectUrl)return null;return URI(e.RedirectUrl.PathWithQueryString)}function Te(){try{return window.self!==window.top}catch(e){return true}}function c(e){return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function o(e){this._element=be(e);var t=this._element.data("view-layouts");var a=this._element.data("id");this._searchPhrase=null;this._layouts=JSON.parse(c(t));this._gridClass=this._element.data("grid-class");this._serviceUrlForGet=this._element.data("get-url");this._deferLoading=this._element.data("defer-loading");this._enableActions=this._element.data("enable-actions");this._selectMode=this._element.data("select-mode");this._columnWidthStyle=this._element.data("column-width-style");this._applyRelatedRecordFilter=this._element.data("apply-related-record-filter");this._filterRelationshipName=this._element.data("filter-relationship-name");this._filterEntityName=this._element.data("filter-entity-name");this._filterAttributeName=this._element.data("filter-attribute-name");this._allowFilterOff=this._element.data("allow-filter-off");this._toggleFilterText=this._element.data("toggle-filter-text");this._userIsAuthenticated=this._element.data("user-isauthenticated");this._userParentAccountName=this._element.data("user-parent-account-name");this._toggleFilterDisplayName=this._element.data("toggle-filter-display-name");this._metaFilter=null;this._compact=this._element.closest("[data-entitygrid-layout]").data("entitygrid-layout")==="compact";this._messageEventHandler=this.createWindowMessageEventHandler();this._pagingCookieMap={};this.initNlSearchListener();if(this._compact){this._element.addClass("entity-grid-compact")}this._nlSearchFilterChangedHandler=null;const n=document.querySelector('[data-id="'+a+'"]');nlSearchFilter=n?n.dataset["nlSearchFilter"]:null;var i=this;be(e).on("refresh",function(){i.load(true,nlSearchFilter)});be(e).on("metafilter",function(e,t){i._metaFilter=t;i.resetPagination();i.load(true,nlSearchFilter)});be(e).data("entityGrid",this)}be(".modal-lookup").on("hidden.bs.modal",function(e){re=undefined});be(document).ready(function(){var e=be(".entity-grid");e.each(function(){new o(be(this)).render()});if(e.length===0){de(be(".table-fluid"))}var t=be("[dir=rtl]").length>0?"left":"right";be("body").tooltip({selector:"[data-toggle=tooltip]",container:"body",placement:t});be(".entitylist").on("click.entitylist",".entitylist-filter-option-breaker a",function(e){e.preventDefault();e.stopPropagation();var t=be(this).data("collapsed");var a=be(this).closest("ul");var n=a.data("pagesize");a.children("li.entitylist-filter-option").each(function(e){if(e>=n){if(t){be(this).attr("aria-hidden","false")}else{be(this).attr("aria-hidden","true")}}});be(this).find(".fa").toggleClass("fa-caret-down",t).toggleClass("fa-caret-up",!t);be(this).find(".expand-label").text(t?"Less":"More");be(this).data("collapsed",!t)});if(typeof be.fn.datetimepicker=="function"){be(".datetimepickerclass.dp_linked_0").datetimepicker({sideBySide:true,keepOpen:true});be(".datetimepickerclass.dp_single").datetimepicker({sideBySide:true,keepOpen:true});be(".datetimepickerclass.dp_linked_1").datetimepicker({sideBySide:true,useCurrent:false,keepOpen:true});be(".datepickerclass.dp_linked_0").datetimepicker({format:"L",keepOpen:true});be(".datepickerclass.dp_single").datetimepicker({format:"L",keepOpen:true});be(".datepickerclass.dp_linked_1").datetimepicker({format:"L",useCurrent:false,keepOpen:true});be(".dp_linked_0").on("dp.change",function(e){var t=e.target.getAttribute("dp-id").split("_");var a=t[0]+"_"+t[1]+"_"+"1";be("[dp-id="+a+"]").data("DateTimePicker").minDate(e.date)});be(".dp_linked_1").on("dp.change",function(e){var t=e.target.getAttribute("dp-id").split("_");var a=t[0]+"_"+t[1]+"_"+"0";be("[dp-id="+a+"]").data("DateTimePicker").maxDate(e.date)})}else{console.log("datetimepicker funtion is not available in j-query version used.")}});function s(){var t=[];var o="";var l="";var d="";var s="";try{be.each(be(".entity-lookup"),function(e,n){if(n){var i=false;var r=false;be.each(be.parseJSON(c(be(".entity-grid",n).attr("data-view-layouts"))),function(e,t){if(t&&t.Configuration&&t.Configuration.EntityName&&t.Configuration.EntityName.toLowerCase()=="account"){var a=be("input[type=hidden]",be("div[class=input-group]",be(n).parent().parent()));if(a&&a.length>0){o=a[0].value;if(be("input[type=hidden][id*='_entityname']",be("div[class=input-group]",be(n).parent().parent()))){l=be("input[type=hidden][id*='_entityname']",be("div[class=input-group]",be(n).parent().parent())).val()}i=true}}else if(t&&t.Configuration&&t.Configuration.EntityName&&t.Configuration.EntityName.toLowerCase()=="contact"){var a=be("input[type=hidden]",be("div[class=input-group]",be(n).parent().parent()));if(a&&a.length>0){d=a[0].value;r=true}}else if(t&&t.Configuration&&t.Configuration.EntityName&&t.Configuration.EntityName.toLowerCase()=="product"){var a=be("input[type=hidden]",be("div[class=input-group]",be(n).parent().parent()));if(a&&a.length>0){s=a[0].value}}});if(r&&i){d=""}}})}catch(e){return t}if(o){t=[{Key:"customerid",Value:o},{Key:"customertype",Value:l},{Key:"primarycontactid",Value:d},{Key:"productid",Value:s}]}return t}})(jQuery);(function(f){function e(e){this._element=f(e);this._associate=this._element.data("associate")||{};this._url=this._element.attr("data-url");this._parent=this._element.parent(".entity-grid");this._success=false}e.prototype.render=function(){var e=this;var t=e._element;var l=t.find(".panel-body.selected-records");var a=t.find(".entity-grid");var n=t.find(".modal-footer .btn-primary");var d=t.find(".modal-associate");var i=e._parent;n.on("click",function(){d.find(".alert-danger.error").remove();e.associate()});var r=function(){var a=f(this);var e=a.attr("data-entity");var t=a.attr("data-id");var n=a.attr("data-name");var i=l.find("div[data-entity='"+e+"'][data-id='"+t+"']");if(!a.hasClass("selected")){i.remove();if(l.children(".item").length>=1){return}d.find(".modal-content .modal-footer .primary.btn.btn-primary").attr("disabled","disabled");return}else{d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled")}if(i.length>0){d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled");return}var r=f("<div class='item pull-left btn btn-default'></div>").attr("data-entity",e).attr("data-id",t).attr("data-name",n).append(f("<span class='name'></span>").text(n));var o=f("<span class='remove' role='button' aria-label='"+window.ResourceManager["Remove_DefaultText"]+"' tabindex=0><span class='fa fa-times'></span></span>").on("click keydown",function(e){var t=e.keyCode?e.keyCode:e.which;if(e.type=="click"||t=="13"||t=="32"){r.remove();a.find("td:first span").removeClass("fa-check");a.removeClass("selected").removeClass("info");if(l.children(".item").length>=1){d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled")}else{d.find(".modal-content .modal-footer .primary.btn.btn-primary").attr("disabled","disabled")}}});r.append(o);l.append(r)};a.children(".view-grid").on({click:r,keypress:function(e){var t=e.keyCode?e.keyCode:e.which;if(t=="13"||t=="32"){e.preventDefault();r.apply(this,arguments)}}},"tr");d.on("show.bs.modal",function(){d.attr("aria-hidden","false");if(l.children(".item").length==0){d.find(".modal-content .modal-footer .primary.btn.btn-primary").attr("disabled","disabled")}a.trigger("refresh")});d.on("shown.bs.modal",function(){$closeBtn=f(this).find("button:visible:first");setTimeout(function(){if(document.activeElement.nodeName=="SECTION"){$closeBtn.trigger("focus")}},3500)});d.on("hidden.bs.modal",function(){d.attr("aria-hidden","true");d.find(".alert-danger.error").remove();l.empty();d.find(".modal-content .modal-footer .primary.btn.btn-primary").removeAttr("disabled");a.children(".view-toolbar").find(".view-search input.query").val("");a.children(".view-grid").find("tbody tr.selected").each(function(){f(this).find("td:first").empty();f(this).removeClass("selected").removeClass("info")});if(e._success){i.trigger("refresh")}});d.find(":button").on("keydown",function(e){o(this,e)});d.find(".view-search input.query").on("keydown",function(e){o(f(".entity-grid .associate-lookup").children(".view-toolbar").find("span.sr-only").parent(),e)})};e.prototype.associate=function(){var e=this;var t=e._element;var a=e._associate;var n=e._url;var i=t.find(".panel-body.selected-records");var r=t.find(".modal-footer button.primary");var o=t.find(".modal-associate");if(n==null||n==""){var l={Message:"System Error",InnerError:{Message:window.ResourceManager["Service_URL_To_Associate_Request_Could_Determined"]}};u(l,o);return}var d=f.map(i.find("div.item"),function(e){return{LogicalName:f(e).attr("data-entity"),Id:f(e).attr("data-id"),Name:f(e).attr("data-name")}});if(d.length<=0){return}r.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");var s=a;s.RelatedEntities=d;var c=JSON.stringify(s);ClientLogWrapper.getLogger().traceInfo("EntityAssociate associate(): Associating","entity_associate","","Associate");shell.ajaxSafePost({type:"POST",contentType:"application/json",url:n,data:c}).done(function(){e._success=true;o.modal("hide")}).fail(function(e){u(p(e),o)}).always(function(){r.prop("disabled",false).find(".fa-spin").remove()})};function u(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){ClientLogWrapper.getLogger().traceError("EntityAssociate onFail(): Error - "+e,"entity_associate");console.log(e);var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=f("<div></div>").addClass("alert alert-block alert-danger error clearfix")}else{n.empty()}if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+"</p>")}}if(typeof e.InnerError!==typeof undefined&&e.InnerError!==false&&e.InnerError!=null){n.append("<p>"+e.InnerError.Message+"</p>")}a.prepend(n)}else{ClientLogWrapper.getLogger().traceError("EntityAssociate onFail(): error object is undefined, false or null","entity_associate")}}function p(e){var t={Message:window.ResourceManager["UnKnown_Error_Occurred"]};if(e==null){ClientLogWrapper.getLogger().traceError("EntityAssociate getError(): jqXhr is null. Error - "+t,"entity_associate");return t}try{var a=e.getResponseHeader("content-type");if(a!=null){t=a.indexOf("json")>-1?f.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}}}else{t={Message:e.statusText}}}catch(e){t={Message:e.message}}ClientLogWrapper.getLogger().traceError("EntityAssociate getError(): Error - "+t,"entity_associate");return t}function o(e,t){var a=t.keycode?t.keycode:t.which;if(a=="13"){t.stopPropagation();t.preventDefault();f(e).trigger("click")}}f(document).ready(function(){f(".entity-associate").each(function(){new e(f(this)).render()})})})(jQuery);(function(c){t.prototype.render=function(){var t=this;var i=t._element;var r=i.find(".entity-grid");var e=i.find(".modal-footer button.primary");var a=i.find(".modal-lookup");var o=i.find(".modal-lookup-create-form");var l=this._lookupReferenceEntityFormId;var d=this._languageCode;i.find(".modal-footer .remove-value").on("click",function(e){e.preventDefault();t.clearFieldValue()});e.on("click",function(){a.find(".alert-danger.error").remove();t.setFieldValue()});c("#"+t._lookupDataFieldName+"_name").on("keydown",function(e){if(e.keyCode===8||e.keyCode===46){t.clearFieldValue();e.stopPropagation();e.preventDefault()}});i.closest("td.lookup.form-control-cell").find(".clearlookupfield").on("click",function(e){e.preventDefault();t.clearFieldValue()}).toggle(!!c("#"+t._lookupDataFieldName).val());i.closest("td.lookup.form-control-cell").find(".launchentitylookup").on("click",function(e){e.preventDefault();i.find(".view-pagination").data("pages",1).data("current-page",1);a.modal({backdrop:"static",keyboard:false})});i.closest("td.lookup.form-control-cell").find(".new-value").on("click",function(e){e.preventDefault();var t=o.find("iframe");var a=t.data("page");if(!l){return}var n=a+"?lookup=true&entityformid="+l+"&languagecode="+d;t.attr("src",n);t.on("load",function(){o.find(".form-loading").hide();o.find("iframe").contents().find("#EntityFormControl").show()});o.find(".form-loading").show();o.find("iframe").contents().find("#EntityFormControl").hide();o.modal({backdrop:"static",keyboard:false});window.addEventListener("message",function e(t){var a,n;if(!window.location.origin){a=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}else{a=window.location.origin}if(t.origin!=a){return}try{n=c.parseJSON(t.data)}catch(e){return}if(n.type==="Success"){t.preventDefault();i.children(".modal-form").modal("hide");r.data("selected",n.id);r.trigger("refresh")}t.target.removeEventListener(t.type,e)})});o.on("show.bs.modal",function(){o.attr("aria-hidden","false")});o.on("hidden.bs.modal",function(){o.attr("aria-hidden","true");i.closest("td.lookup.form-control-cell").find(".new-value").trigger("focus")});a.on("show.bs.modal",function(){a.attr("aria-hidden","false");if(navigator.userAgent.toLowerCase().indexOf("firefox")==-1){r.children(".view-toolbar").find(".view-search").attr("role","none")}r.data("selected",c("#"+t._lookupDataFieldName).val());r.trigger("refresh")});a.on("shown.bs.modal",function(){$closeBtn=c(this).find("button:visible:first");setTimeout(function(){if(document.activeElement.nodeName=="SECTION"){$closeBtn.trigger("focus")}},3500)});a.on("hidden.bs.modal",function(e){t.setFocusOnCancel();a.attr("aria-hidden","true");a.find(".alert-danger.error").remove();r.children(".view-toolbar").find(".view-search input.query").val("");r.children(".view-grid").find("tr.selected").each(function(){c(this).find("td:first").empty();c(this).removeClass("selected").removeClass("info")});r.children(".view-toolbar").find(".toggle-related-filter").addClass("active");e.stopImmediatePropagation()})};t.prototype.setFieldValue=function(){var e=this;var t=e._element;var a=t.find(".modal-footer button.primary");var n=t.find(".modal-lookup");var i=t.find(".entity-grid");var r=e._lookupDataFieldName;var o=c("#"+r);if(o.length==0){return}var l=c("#"+r+"_name");if(l.length==0){return}var d=c("#"+r+"_entityname");if(d.length==0){return}var s=c.map(i.children(".view-grid").find("tr.selected"),function(e){var t=c(e).find("td:nth-child(2)[data-type='System.DateTime']>time");if(t&&t.length>0){var a=t[0].innerText}return{LogicalName:c(e).attr("data-entity"),Id:c(e).attr("data-id"),Name:a?a:c(e).attr("data-name")}});if(s.length<=0){return}a.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");l.val(s[0].Name);d.val(s[0].LogicalName);o.val(s[0].Id).trigger("change");n.modal("hide");t.closest("td.lookup.form-control-cell").find(".clearlookupfield").show();a.prop("disabled",false).find(".fa-spin").remove();if(setIsDirty&&c.isFunction(setIsDirty)){setIsDirty(o.attr("id"))}l.trigger("focus")};t.prototype.clearFieldValue=function(){var e=this;var t=e._element;var a=t.find(".modal-footer button.primary");var n=t.find(".modal-lookup");var i=e._lookupDataFieldName;var r=c("#"+i);if(r.length==0){return}var o=c("#"+i+"_name");if(o.length==0){return}var l=c("#"+i+"_entityname");if(l.length==0){return}a.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-spin' aria-hidden='true'></span>");o.val("");l.val("");r.val("").trigger("change");n.modal("hide");a.prop("disabled",false).find(".fa-spin").remove();t.closest("td.lookup.form-control-cell").find(".clearlookupfield").hide();if(setIsDirty&&c.isFunction(setIsDirty)){setIsDirty(r.attr("id"))}o.trigger("focus")};t.prototype.setFocusOnCancel=function(){var e=this;var t=e._element;var a=t.find(".modal-lookup");var n=e._lookupDataFieldName;var i=t.find(".modal-lookup-create-form");if(i.is(":visible")){i.modal("hide")}else{var r=c("#"+n);if(r.length==0){return}var o=c("#"+n+"_name");if(o.length==0){return}a.modal("hide");o.trigger("focus")}};function t(e){this._element=c(e);this._target=this._element.data("target")||{};this._url=this._element.attr("data-url");this._lookupDataFieldName=this._element.attr("data-lookup-datafieldname");this._lookupReferenceEntityFormId=this._element.attr("data-lookup-reference_entityformid");this._languageCode=this._element.attr("data-languageCode")}c(document).ready(function(){c(".entity-lookup").each(function(){new t(c(this)).render()});var e=c("[dir=rtl]").length>0?"left":"right";c("body").tooltip({selector:"[data-toggle=tooltip]",container:"body",placement:e})});c(document).on("keydown",function(e){if(e.which==27){if(c(".entitylist-search").children(".tooltip").length>0){e.preventDefault();c(c(".entitylist-search").children(".tooltip")[0]).remove()}else if(c(".launchentitylookup").next(".tooltip").length>0){e.preventDefault();c(".launchentitylookup").next(".tooltip").remove()}else{if(c(".modal").is(":visible")){c(".modal").modal("hide")}}}})})(jQuery);(function(i){function e(e){this._element=i(e);this._lookupElement=i("#"+this._element.data("lookup-element"));this._lookupEntityNameElement=i("#"+this._element.data("lookup-element")+"_entityname");this._path=this._element.data("path");this._controlId=this._element.data("controlid");this._formName=this._element.data("formname")}i(document).ready(function(){i("iframe.quickform").each(function(){new e(i(this)).bindEvents()})});e.prototype.bindEvents=function(){var a=this;var e=a._element;var t=a._lookupElement;var n=a._lookupEntityNameElement;e.on("load.quickform",function(){a.resize()});t.on("change.quickform",function(){var e=i(this).val();if(e==null||e==""){a.clear()}else{var t=n.val();a.reload(e,t)}});if(t.val()&&n.val()){this.reload(t.val(),n.val())}};e.prototype.reload=function(e,t,a){var n=this;var i=n._element;var r=n._formName;var o=n._controlId;var l=n._path;if(typeof a=="undefined")a="";var d=l+"?entityid="+e+"&entityname="+t+"&entityprimarykeyname="+a+"&formname="+r+"&controlid="+o;i.attr("src",d);i.attr("tabindex","0")};e.prototype.clear=function(){var e=this;var t=e._element;t.attr("src","about:blank");t.attr("tabindex","-1");t.css("height",0)};e.prototype.resize=function(){var e=this;var t=e._element;t.css("height",0);t.css("height",t.contents().outerHeight()+4+"px")}})(jQuery);+function(s,c){"use strict";s(document).on("click.adx.serialized-query.data-api","[data-serialized-query]",e);s(document).ready(function(){s("[data-serialized-query]").each(t)});function e(e){var t=s(this),a=t.data("serialized-query"),n=t.data("target"),i=t.closest(".entitylist"),r=i.find(".entity-grid").filter(":first"),o,l;if(r.length==1&&n){e.preventDefault();var d=s(n).find("input,select").serialize();r.trigger("metafilter",d)}else if(n&&a){o=s(n).find("input,select").serialize();l=new c;l.setSearch(a,o);window.location.href=l.toString()}}function t(){var t=s(this).data("target");if(t){s(t).find("input:radio").on("click",function(){var e=s(this);if(e.data("checked")){e.data("checked",null);e.prop("checked",false)}else{s(t).find("input:radio[name="+e.prop("name")+"]").data("checked",null);e.data("checked",true)}})}}}(jQuery,URI);(function(t,r){"use strict";t.Ad=function(){var e=function(e){this._element=r(e);this.url=this._element.data("url");this._element.data("ad",this)};e.prototype.init=function(){var t=this;this._element.hide();n.call(this).then(function(){i.call(t);t._element.trigger({type:"adplacement_ready",adplacement:t})},function(e){a.call(t,e)})};var a=function(e){if(console&&console.error){console.error({error:e,ad:this})}};var n=function(){var t=this;var a=r.Deferred();if(this.url){r.ajax({url:this.url,type:"GET"}).then(function(e){t.html=r(e.trim());a.resolve()},a.fail)}else{this.html=r(this._element.html().trim());a.resolve()}return a.promise()};var i=function(){this._element.empty().append(this.html).show();this._element.trigger({type:"ad_ready",ad:this})};return e}();t.AdPlacement=function(){var e=function(e){this._element=r(e);this.url=this._element.data("url");this._element.data("adplacement",this)};e.prototype.init=function(){var t=this;t._element.hide();n.call(this).then(function(){i.call(t)},function(e){a.call(t,e)})};var a=function(e){if(console&&console.error){console.error({error:e,ad:this})}};var n=function(){var t=this;var a=r.Deferred();if(this.url){r.ajax({url:this.url,type:"GET",async:true}).then(function(e){t.html=e;a.resolve()},a.fail)}else{this.html=r(this._element.html().trim());a.resolve()}return a.promise()};var i=function(){this._element.empty().append(this.html).show()};return e}();r(document).ready(function(){r(".ad").each(function(){var e=new t.Ad(this);e.init()});r(".adplacement").each(function(){r(this).on("adplacement_ready",function(e,t){console.log(e);console.log(t)});var e=new t.AdPlacement(this);e.init()})})})(window.adx||(window.adx={}),window.jQuery);(function(t,s){"use strict";t.Poll=function(){var e=function(e){this._element=s(e);this._content=this._element.find(".poll-content").length?this._element.find(".poll-content"):this._element;this._url=this._element.data("url");this._submitUrl=this._element.data("submit-url")};e.prototype.init=function(){var t=this;n.call(this).then(function(){i.call(t);d.call(t);t._element.trigger({type:"poll_ready",ad:t})},function(e){a.call(t,e)})};e.prototype.viewPoll=function(){o.call(this,true)};e.prototype.viewResults=function(){o.call(this,false);if(this._submitted){this._element.find(".poll-return").remove()}};var a=function(e){if(console&&console.error){console.error({error:e,poll:this})}};var n=function(){var t=this;var a=s.Deferred();if(this._url){s.ajax({url:this._url,type:"GET"}).then(function(e){t.html=s(e.trim());a.resolve()},a.fail)}else{this.html=s(this._content.html().trim());a.resolve()}return a.promise()};var i=function(){t.call(this);this._id=this._element.find(".poll-questionpanel").data("id");this._name=this._element.find(".poll-questionpanel").data("name");this._submitted=!this._element.find(".poll-questionpanel").length;r.call(this)};var t=function(){this._content.empty().append(this.html).show()};var r=function(){if(this._submitted){this.viewResults()}else{this.viewPoll()}};var o=function(e){this._element.find(".poll-questionpanel").toggle(e);this._element.find(".poll-resultspanel").toggle(!e)};var l=function(){var t=this;var e=this._element.find("input[id^='poll_option_']:checked").val();if(e&&this._submitUrl){var a=shell.ajaxSafePost({url:this._submitUrl,async:false,type:"POST",data:JSON.stringify({pollId:this._id,optionId:e}),contentType:"application/json; charset=utf-8"});a.then(function(e){t.html=s(e.trim());i.call(t)});a.fail(function(){console.log({m:"Post Failed",d:arguments})})}};var d=function(){var e=this;this._element.on("click.poll",".poll-submit",function(){l.call(e)});this._element.on("click.poll",".poll-viewresults",function(){e.viewResults()});this._element.on("click.poll",".poll-return",function(){e.viewPoll()})};return e}();t.PollPlacement=function(){var e=function(e){this._element=s(e).hide();this._url=this._element.data("url");this._element.data("pollplacement",this)};e.prototype.init=function(){var t=this;n.call(this).then(function(){i.call(t);r.call(t);t._element.trigger({type:"pollplacement_ready",pollplacement:t})},function(e){a.call(t,e)})};var a=function(e){if(console&&console.error){console.error({error:e,ad:this})}};var n=function(){var t=this;var a=s.Deferred();if(this._url){s.ajax({url:this._url}).then(function(e){t.html=s(e.trim());a.resolve()},a.fail)}else{this.html=s(this._element.html().trim());a.resolve()}return a.promise()};var i=function(){this._element.empty().append(this.html).show()};var r=function(){o(this._element.find(".poll"))};return e}();function o(e){e.each(function(){var e=new t.Poll(this);e.init()})}function e(e){e.each(function(){var e=new t.PollPlacement(this);e.init()})}s(document).ready(function(){o(s(".poll"));e(s(".pollplacement"))})})(window.adx||(window.adx={}),window.jQuery);(function(e,r){"use strict";var o=null;e.getAuthenticationToken=function(e){o=e;r.ajax({type:"POST",url:"/_services/auth/token",cache:false,success:t,error:function(){o(null)}})};function t(e,t,a){var n=JSON.parse(a.getResponseHeader("X-Responded-JSON"));if(n&&n.status===401){var i=Number(r.cookie("chatForcedLogin"))===1;if(!i){r.cookie("chatForcedLogin",1);l()}else{r.cookie("chatForcedLogin",0);o("","Login Required")}}else{o(e)}}function l(){var e=window.location.pathname+window.location.search;var t=window.location.origin+"/SignIn?returnUrl="+encodeURIComponent(e);window.location=t}})(window.auth||(window.auth={}),window.jQuery);(function(v,r){"use strict";r.registerHelper("urlquerystringcheck",function(e,t){var a=(e||"").split("?");if(a.length<=1){return t.fn(this)}else{return t.inverse(this)}});var h=4;var o=27;r.registerHelper("label",function(e,t,a){if(e===t)return a.fn(this);else return a.inverse(this)});function e(e){this._element=v(e);this._url=this._element.data("url")||v("body").data("case-deflection-url");this._container=this._element.data("container");this._target=this._element.data("target");this._itemTarget=this._element.data("itemtarget");this._template=this._element.data("template");this._itemTemplate=this._element.data("itemtemplate");this._logicalNames=this._element.closest("[data-case-deflection-logicalnames]").length>0?this._element.closest("[data-case-deflection-logicalnames]").data("case-deflection-logicalnames"):this._element.closest("[data-auto-complete-logicalnames]").data("auto-complete-logicalnames");this._sortingOption=this._element.closest("[data-case-deflection-sorting-option]").length>0?this._element.closest("[data-case-deflection-sorting-option]").data("case-deflection-sorting-option"):this._element.closest("[data-auto-complete-sorting-option]").data("auto-complete-sorting-option");this._query=this._element.closest("[data-case-deflection-query]").length?this._element.closest("[data-case-deflection-query]").data("case-deflection-query"):this._element.closest("[data-auto-complete-query]").data("auto-complete-query");this._noResultsText=this._element.data("noresultstext");this._$container=null;this._compiledTemplate=null;this._compiledItemTemplate=null;if(typeof this._query===typeof undefined||this._query==null||this._query===""){this._query="(+(@subject))"}}e.prototype.init=function(){var t=this,e=t._element,a;if(t._element.length===0){return}if(!t._url){return}if(!t._container){a=e.parent()}else{a=e.parents(t._container)}t._$container=a;if(!t._template){if(v("#case-deflection-container").length===0){return}t._compiledTemplate=r.compile(v("#case-deflection-container").html())}else{if(v(t._template).length===0){return}t._compiledTemplate=r.compile(v(t._template).html())}if(!t._itemTemplate){if(v("#case-deflection-results").length===0){return}t._compiledItemTemplate=r.compile(v("#case-deflection-results").html())}else{if(v(t._itemTemplate).length===0){return}t._compiledItemTemplate=r.compile(v(t._itemTemplate).html())}e.off("keyup.adx.case-deflection").on("keyup.adx.case-deflection",_.debounce(function(e){e.stopPropagation();t.clearResults();if(e.keyCode!=o){t.getResults()}},800));var n=a.find(".search-clear"),i=a.find(".search-apply");n.attr("aria-label",window.ResourceManager["CustomerService_Support_ClearButton"]);n.off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();t.clearSearch();t.clearResults()});i.off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();t.clearResults();t.getResults()})};e.prototype.clearSearch=function(){var e=this,t=e._element;t.val("")};e.prototype.clearResults=function(){var e=this,t=e._element,a=e._$container;var n=a.find(".search-more");if(!e._target){t.parent().find(".results").animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}else{n.parent(".panel-footer").animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear");a.find(e._target).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}n.hide();t.data("page",null)};e.prototype.getResults=function(){var e=this;e.getSearchResults()};e.prototype.getMoreResults=function(){var e=this,t=e._element,a=t.data("page");if(a!=null){a=a+1}e.getSearchResults(a)};e.prototype.getSearchResults=function(n){var i=this;var r=i._element;var o=i._$container;var l=r.val();var d=o.find(".search-more"),s,c;if(!l){if(!i._target){r.parent().find(".results").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}else{d.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear");o.find(i._target).stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear",function(){v(this).empty()})}d.hide();r.data("page",null);return}if(l.length<h)return;d.prop("disabled",true);d.append("<span class='fa fa-spinner fa-spin'></span>");if(!i._target){if(!n){d.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear");d.hide();if(r.parent().find(".results").length===1){s=r.parent().find(".results");s.stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear",function(){v(this).empty()})}else{s=v("<div class='results pull-left' style='margin-top: 20px; width: 100%;'></div>");s.hide();r.parent().append(s)}}else{s=r.parent().find(".results")}}else{if(!n){s=o.find(i._target);d.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear");d.hide();s.stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear",function(){v(this).empty()})}else{s=o.find(i._target)}}var e=o.find(".case-deflection-loading");if(e.length===0){e=v("<div class='case-deflection-loading' style='text-align:center;margin-bottom:10px;margin-top:10px;width:100%;'><span class='fa fa-spinner fa-spin' aria-hidden='true'></span></div>").hide();if(!i._target){e.addClass("pull-left");s.before(e)}else{s.after(e)}}if(!n&&i._target){e.css("margin-top",0)}else{e.css("margin-top","10px")}if(!n){e.animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}var t=n||1;var a=r.closest("[data-case-deflection-pagesize]").length>0?r.closest("[data-case-deflection-pagesize]").data("case-deflection-pagesize"):r.closest("[data-auto-complete-pagesize]").data("auto-complete-pagesize");var f=r.closest("[data-case-deflection-filter]").length>0?r.closest("[data-case-deflection-filter]").data("case-deflection-filter"):r.closest("[data-auto-complete-filter]").data("auto-complete-filter");if(a==null||a===""){a=5}var u={};u.parameters={subject:l};u.query=i._query;u.logicalNames=i._logicalNames;u.filter=f;if(typeof i._sortingOption!==typeof undefined&&i._sortingOption!=null){u.sortingOption=i._sortingOption}u.pageNumber=t;u.pageSize=a;var p=JSON.stringify(u);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:i._url,data:p,global:false}).done(function(e){if(e==null||e.itemCount===0){if(!n){if(!i._target){d.parent(".panel-footer").animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear")}else{if(typeof i._noResultsText!=typeof undefined&&i._noResultsText!=null&&i._noResultsText!==""){var t=v("<li class='list-group-item noresults'></li>").text(i._noResultsText);s.empty().append(t);s.stop(true,true).animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}}}d.hide();d.prop("disabled",false);d.find(".fa-spinner").remove();return}e.caseTitle=l;if(!n){s.empty().append(i._compiledTemplate(e))}if(!i._itemTarget){c=o.find("#case-deflection-topics")}else{c=v(i._itemTarget)}if(c.length===0){c=s}if(n){c.append(i._compiledItemTemplate(e))}else{c.empty().append(i._compiledItemTemplate(e));s.stop(true,true).animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}d=o.find(".search-more");if(e.pageCount<=1||e.pageNumber===e.pageCount){if(i._target){d.parent(".panel-footer").stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"normal","linear")}d.hide()}else{r.data("page",e.pageNumber);d.off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();i.getMoreResults()});d.show();d.parent(".panel-footer").stop(true,true).animate({opacity:"show",margin:"show",padding:"show",height:"show"},"normal","linear")}d.prop("disabled",false);d.find(".fa-spinner").remove();o.find(".deflect").off("click.adx.case-deflection").on("click.adx.case-deflection",function(e){e.preventDefault();if(window.parent){window.parent.location.replace("/")}else{window.location.replace("/")}});if(e!=null&&e.itemCount>0){const a=e.itemCount+" "+window.ResourceManager["SearchCountText"];if(v("#caseDeflectionFilterAlert").length){v("#caseDeflectionFilterAlert").remove()}v("<div id='caseDeflectionFilterAlert' class='sr-only' role='alert' aria-label='"+a+"'></div>").insertAfter("#case-deflection-topics");v("#case-deflection-topics").attr("aria-label",a);d.find(".fa-spinner").remove()}}).always(function(){e.stop(true,true).animate({opacity:"hide",margin:"hide",padding:"hide",height:"hide"},"fast","linear")})};v(document).ready(function(){v("input.case-deflection").each(function(){new e(v(this)).init()})})})(jQuery,Handlebars);(function(d){d(document).ready(function(){var e=d("#customerid");if(e.length>0&&d("#entitlementid").length>0&&d("#customerid_name").attr("disabled")!="disabled"&&d("#entitlementid").closest("td").is(":visible")){e.on("change",t);e.trigger("change")}});function t(){var e=[];var t=d("#entitlementid_lookupmodal").find(".entity-grid");var a=d("#customerid").val();var n=d("#customerid_entityname").val();var i=t?JSON.parse(base64DecodeUnicode(t.data("view-layouts")))[0]:null;var r=d("#entitlementid_lookupmodal").find(".entity-lookup").attr("default-entitlements-url");if(!i||!a||!n)return;e=[{Key:"customerid",Value:a},{Key:"customertype",Value:n}];var o={};o.layout=i.Base64SecureConfiguration;o.sortExpression=i.SortExpression;o.customParameters=e;var l=JSON.stringify(o);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:r,data:l,global:false,success:function(e){if(e){d("#entitlementid").val(e.id);d("#entitlementid_entityname").val(e.entityname);d("#entitlementid_name").val(e.name)}}})}})(jQuery);document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".handlebars-search-container");const t=document.querySelector("#content_form > .container");if(e&&t){t.appendChild(e)}});(function(s,o){var n={spacebar:32,enter:13,up:38,down:40,isFiredSpaceOrEnterEvent:function(e){return e.keyCode===n.spacebar||e.charCode===n.spacebar||e.keyCode===n.enter},isFiredSpaceEvent:function(e){return e.keyCode===n.spacebar||e.charCode===n.spacebar}};var a=[{entityLogicalNames:["adx_communityforum","adx_communityforumthread","adx_communityforumpost"],cssClass:"label label-default",label:ResourceManager.Forums_Label},{entityLogicalNames:["adx_blog","adx_blogpost","adx_blogpostcomment"],cssClass:"label label-info",label:ResourceManager.Blogs_Label},{entityLogicalNames:["adx_event","adx_eventschedule"],cssClass:"label label-info",label:ResourceManager.Events_Label},{entityLogicalNames:["adx_idea","adx_ideaforum"],cssClass:"label label-success",label:ResourceManager.Ideas_Label},{entityLogicalNames:["adx_issue"],cssClass:"label label-danger",label:ResourceManager.Issues_Label},{entityLogicalNames:["incident"],cssClass:"label label-warning",label:ResourceManager.Cases_Label},{entityLogicalNames:["kbarticle"],cssClass:"label label-info",label:ResourceManager.Knowledge_Base_Label},{entityLogicalNames:["knowledgearticle"],cssClass:"label label-primary",label:ResourceManager.Knowledge_Base_Label}];o.registerHelper("ifvalue",function(e,t){if(t.hash.value===e){return t.fn(this)}else{return t.inverse(this)}});o.registerHelper("stringFormat",function(e){var t=_.rest(_.initial(arguments)).reduce(function(e,t,a){return e.replace("{"+a+"}",t)},e);return t});function t(e){var t=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=a.exec(t);if(!n)return null;if(!n[2])return"";var i=decodeURIComponent(n[2].replace(/\+/g," "));var r=o.Utils.escapeExpression(i);return r}function i(e,t){e.on("click",function(e){e.preventDefault();e.stopPropagation();t(this)});e.on("keypress",function(e){if(n.isFiredSpaceOrEnterEvent(e)){e.preventDefault();e.stopPropagation();t(this)}})}function l(e,t,a,n){var i=this;i.$templateItem=s(e);i.$insertItem=s(t);i.searchControlData=a;i.initialState=n}l.prototype.render=function(){var e=this;var t=o.compile(e.$templateItem.html());e.$insertItem.empty().append(t(e.searchControlData));if(e.applyInitialState!=null&&e.initialState!=null){e.applyInitialState()}if(e.addOnClickCallback!=null){e.addOnClickCallback()}};function d(e){if(!e){return}e.forEach(function(e){var t=_(e.facetData).where({active:true});var a=!!t&&t.length>0;var n=e.facetName==="modifiedon.date"&&!!e.facetData[0];var i=e.facetName=="_logicalname"&&!!e.facetData[0];if(n||i){var r=!t||t.length===0;var o=!!t&&t.length>1;var l=!!e.facetData[0].active&&!o;e.facetData[0].active=r||l;e.facetData[0].first=true}else{e.noActive=!a}})}function c(e){if(!e){return}var a=[{skipStars:true},{filledStars:[1,2,3,4],emptyStars:[5],ratingLabel:ResourceManager.Facet_Rating_Four_And_Up},{filledStars:[1,2,3],emptyStars:[4,5],ratingLabel:ResourceManager.Facet_Rating_Three_And_Up},{filledStars:[1,2],emptyStars:[3,4,5],ratingLabel:ResourceManager.Facet_Rating_Two_And_Up},{filledStars:[1],emptyStars:[2,3,4,5],ratingLabel:ResourceManager.Facet_Rating_One_And_Up}];var n=_(e).findWhere({facetName:"rating"});if(!n){return}n.facetData=[{},n.facetData[3],n.facetData[2],n.facetData[1],n.facetData[0]];a.forEach(function(e,t){n.facetData[t]=_.assign(n.facetData[t],a[t])})}function f(e,t,a,n){var i=this;l.call(i,e,t,a,n);i.calculateSelectedData();var r=a.facetViews;c(r);d(r)}f.prototype=Object.create(l.prototype);f.prototype.calculateSelectedData=function(){var t=this;if(t.searchControlData==null||t.searchControlData.facetViews==null||t.initialState==null){return}t.initialState.forEach(function(e){e.Constraints.forEach(function(a){var n=e.FacetName;t.searchControlData.facetViews.forEach(function(t){t.facetData.forEach(function(e){if(e.name==a&&t.facetName==n){e.active=true}})})})})};f.prototype.processFacetConstraintClick=function(e,t){var a=s(e);var n=a.parents(".facet-view");var i=n.hasClass("facet-view-multiple-select");var r=a.data("control-value")==="";if(!i||r){n.find(".active").removeClass("active")}a.toggleClass("active");var o=a.attr("data-control-value");var l=a.attr("data-facet");var d="[data-control-value='"+o+"'][data-facet='"+l+"']";t.callback({facetConstraints:t.getSelected()},d)};f.prototype.addOnClickCallback=function(){var t=this;i(t.$insertItem.find(".control-item"),function(e){t.processFacetConstraintClick(e,t)});t.$insertItem.find(".control-item").on("keydown",function(e){var t=s(this);var a;if(e.keyCode===n.up){a=t.prev()}if(e.keyCode===n.down){a=t.next()}if(a!=null&&a.hasClass("control-item")){a.trigger("focus");return false}});i(t.$insertItem.find(".show-more"),function(e){s(e).parents(".facet-view").removeClass("short-list")});i(t.$insertItem.find(".show-less"),function(e){s(e).parents(".facet-view").addClass("short-list")});if(t.$insertItem.find(".control-item:hidden").length===0){t.$insertItem.find(".show-more").hide()}};f.prototype.showLocalizedProductLabels=function(e){var t=[];var a=s(e).parents(".facet-view");var n=a.find(" .control-item[data-control-display-name='']:visible");n.each(function(){var e=s(this).data("control-value");t.push(e);s(this).addClass("hidden")});if(t.length===0){return}a.find(".btn").each(function(){s(this).attr("disabled","true")});shell.ajaxSafePost({url:s("body").data("case-deflection-url")+"/GetLocalizedLabels",type:"POST",dataType:"json",data:{localizedLabelEntityName:"product",localizedLabelField:"name",entityGuids:t}}).done(function(i){n.each(function(){var e=s(this);var t=s(this).data("control-value");var a=i[t];if(a!=null){e.attr("aria-label",a+e.attr("aria-label"));e.attr("data-control-display-name",a);var n=e.find("label");n.empty().append(n.html()+a);e.removeClass("hidden")}})}).always(function(){a.find(".btn").each(function(){s(this).removeAttr("disabled")})})};f.prototype.getSelected=function(){var e=this;var i=[];e.$insertItem.find(".control-item.active").each(function(e,t){var a=s(t).attr("data-control-value");var n=s(t).attr("data-facet");if(a!=null&&a!=""&&n!==""&&a!=="[* TO *]"){i.push({FacetName:n,Constraints:[a]})}});return i};var r=function(e,t){var a=5;var n=Math.max(1,a-1);var i=t-Math.floor(n/2);var r=t+Math.ceil(n/2);var o=Math.max(i,1);var l=Math.min(r,e);var d=o-i;var s=r-l;var c=Math.max(o-s,1);var f=Math.min(l+d,e);var u=_.range(c,f+1);return u};function u(e,t,a,n){var i=this;l.call(i,e,t,a,n);i.data=a;i.data.needsPagination=i.data.pageCount>1;i.data.previousPage=i.data.pageNumber-1;i.data.nextPage=i.data.pageNumber+1;i.data.pageLinks=r(i.data.pageCount,i.data.pageNumber)}u.prototype=Object.create(l.prototype);u.prototype.addOnClickCallback=function(){var t=this;var e=_.union(t.data.pageLinks,[1,t.data.pageCount]);e.forEach(function(e){i(t.$insertItem.find(".js-go-to-"+e),function(){t.callback({pageNumber:e})})})};u.prototype.getSelected=function(){var e=this;return e._state||e.data.pageNumber};function p(e,t,a,n){var i=this;l.call(i,e,t,a,n)}p.prototype=Object.create(l.prototype);p.prototype.addOnClickCallback=function(){var e=this;if(e.callback!=null){e.$insertItem.find("select").on("change",function(){e.callback({sortOptions:e.getSelected()})});e.$insertItem.find("select").on("keydown",function(e){if(n.isFiredSpaceEvent(e)){s(this).trigger("focus");s(this).find("option").trigger("click")}})}};p.prototype.getSelected=function(){var e=this;return e.$insertItem.find(":selected").val()};p.prototype.applyInitialState=function(){var e=this;e.$insertItem.find("select").val(e.initialState)};function v(e,t,a,n){var i=this;a.isResetVisible=n!=null&&n.length>0;l.call(i,e,t,a,n)}v.prototype=Object.create(l.prototype);v.prototype.addOnClickCallback=function(){var e=this;var t=s(".search-results")[0].children;i(e.$insertItem.find(".facet-clear-all"),function(){e.callback({facetConstraints:null})});if(t.length>0){s(t[0]).attr("tabindex","0").trigger("focus")}};function e(){var e=this;e._element=s(".handlebars-search-container");e._searchComponents=[];e._state={pageNumber:1,url:s("body").data("case-deflection-url"),query:e._element.data("query"),facetsOrder:e._element.data("facets-order"),logicalNames:t("logicalNames"),filter:t("filter"),searchTerm:t("q")}}var h=function(t,e){var a=e.map(function(e){return _(t.facetViews).findWhere({facetName:e})}).filter(function(e){return e});t.facetViews=a};e.prototype.init=function(){this.updateState()};e.prototype.initSearchComponents=function(){var e=o.compile(s("#facets-view-body-container").html());s(".search-body-container").empty().append(e(this.searchData));var t=_(s(".js-facet-order-definition").children()).map(function(e){return s(e).text()});if(!_.isEmpty(t)){h(this.searchData,t)}var a=new f("#facets-view-results",".facets",this.searchData,this._state.facetConstraints);a.callback=this.setState.bind(this);this._searchComponents.push(a);var n=new p("#search-order-select",".search-order",this.searchData,this._state.sortOptions);n.callback=this.setState.bind(this);this._searchComponents.push(n);var i=new u("#facets-view-pagination",".search-pagination",this.searchData);i.callback=this.setState.bind(this);this._searchComponents.push(i);var r=new v("#search-view-results",".search-results",this.searchData,this._state.facetConstraints);r.callback=this.setState.bind(this);this._searchComponents.push(r)};e.prototype.breadCrumbs=function(e){s("ul.breadcrumb > li.active").removeClass("active");s("#searchterm").remove();var t=e||"";var a=s("<li id='searchterm' >").empty().append("<span class='searchterm'>"+t+"</span>").addClass("active");s("ul.breadcrumb li:last").after(a)};e.prototype.render=function(){this._searchComponents.forEach(function(e){e.render()});if(s("#search_sort_options").length){s("#search_sort_options").parent().addClass("sortoption")}};e.prototype.mapResponseData=function(e){var t=this;e.firstResultNumber=(e.pageNumber-1)*e.pageSize+1;e.lastResultNumber=Math.min(e.pageNumber*e.pageSize,e.approximateTotalHits);e.items.forEach(function(t){t.tags=a.filter(function(e){return _.contains(e.entityLogicalNames,t.entityLogicalName)})});e.query=t._state.searchTerm;return e};e.prototype.setState=function(e,t){var a=this;var n=!!e.facetConstraints;if(n){e.pageNumber=1}a._state=_.assign(a._state,e);a.updateState(t)};e.prototype.updateState=function(a){var n=this;n._element.find(".js-search-body").hide();n._element.find(".loader").show();s("#searchErrorMessage h2").empty();var e={};e.query=n._state.query;e.parameters={Query:n._state.searchTerm};e.logicalNames=n._state.logicalNames;e.facetConstraints=n._state.facetConstraints;e.sortingOption=n._state.sortOptions;e.pageNumber=n._state.pageNumber;e.filter=n._state.filter;e.isFacetedSearch=true;var t=JSON.stringify(e);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:n._state.url,data:t,global:false}).done(function(e){n.breadCrumbs(n._state.searchTerm);if(e&&e.errorMessage==undefined){n.searchData=n.mapResponseData(e);n.initSearchComponents();n.render();n._element.find(".js-search-body").show();if(a!=null){if(s(a).find("input").length>0){s(a).find("input").trigger("focus")}else{s(a).trigger("focus")}}if(e&&e.enableProgressiveSearch===true){var t=parseInt(e.postProcessedResultLimit);if(e.postProcessedResultCount&&parseInt(e.postProcessedResultCount)>=t){s('[aria-label="'+window.ResourceManager["Pagination_Last_Page"]+'"]').hide()}if(s('span:contains("0+")').length>0){s('span:contains("0+")').each(function(){if(s.trim(s(this).text())==="0+"){s(this).empty().append('<i class="fa fa-info" aria-hidden="true"></i>')}})}}}}).fail(function(e){if(e.responseJSON.errorMessage!=undefined){s("#searchErrorMessage").addClass("search-results");s("#searchErrorMessage h2").append(e.responseJSON.errorMessage);ClientLogWrapper.getLogger().traceError("Error: "+e.responseJSON.errorMessage,"faceted-search","","UpdateState")}ClientLogWrapper.getLogger().traceError("Error in POST for updating state","faceted-search","","UpdateState")}).always(function(e,t){n._element.find(".loader").hide();if(e.errorMessage!=undefined){s("#searchErrorMessage").addClass("search-results");s("#searchErrorMessage h2").append(e.errorMessage);ClientLogWrapper.getLogger().traceError(e.errorMessage,"faceted-search","","UpdateState")}})};window.FacetedSearch=e})(jQuery,Handlebars);$(document).ready(function(){function t(e,t){t.stopPropagation();t.preventDefault();var a=$("#"+e.id).attr("data-parent");var n=a==="#RelatedArticles"?$(a).find("a.list-group-item"):$(a).find("li.list-group-item");n.show();$("#"+e.id).hide();var i="#"+e.nextElementSibling.id;$(i).show();$(i).css("display","block");$(i).trigger("focus")}function a(e,t){t.stopPropagation();t.preventDefault();var a=$("#"+e.id).attr("data-parent");var n=a==="#RelatedArticles"?$(a).find("a.list-group-item"):$(a).find("li.list-group-item");var i=n.filter(function(e){return e>4});i.hide();$("#"+e.id).hide();var r="#"+e.previousElementSibling.id;$(r).show();$(r).trigger("focus")}$("#showMoreNotesButton").on("click",function(e){t(this,e)});$("#showLessNotesButton").on("click",function(e){a(this,e)});$("#showMoreArticleButton").on("click",function(e){t(this,e)});$("#showLessArticleButton").on("click",function(e){a(this,e)})});function expandCollapse(e){var t=e.currentTarget;if(!t.classList.contains("collapsible_panel_head")){return}t=t.parentElement;if(t===null||!t.classList.contains("collapsible_panel")){return}var a=t.getElementsByClassName("collapsible_panel_body").length>0?t.getElementsByClassName("collapsible_panel_body")[0]:null;var n=t.getElementsByClassName("collapsible_panel_icon").length>0?t.getElementsByClassName("collapsible_panel_icon")[0]:null;if(a===null||n===null){return}if(a.classList.contains("collapsible_panel_body_show")){a.classList.remove("collapsible_panel_body_show");a.classList.add("collapsible_panel_body_hide");n.classList.remove("collapsible_panel_icon_downArrow");n.classList.add("collapsible_panel_icon_sideArrow")}else{a.classList.remove("collapsible_panel_body_hide");a.classList.add("collapsible_panel_body_show");n.classList.remove("collapsible_panel_icon_sideArrow");n.classList.add("collapsible_panel_icon_downArrow")}}(function e(){var t=document.getElementsByClassName("collapsible_panel_head");for(var a=0;a<t.length;a++){t[a].addEventListener("click",expandCollapse,false);t[a].addEventListener("keydown",function(e){if(e.keyCode===32||e.keyCode===13){expandCollapse(e)}},false)}})();$(document).ready(function(){if($("[data-badge]")){var a={},e,n;$("[data-badge]").each(function(e,t){n=$(t).attr("data-uri");if(!a[n]){a[n]=Array()}a[n].push($(t))});$.each(a,function(e,t){if(t[0].attr("data-uri")){$.ajax({type:"GET",url:t[0].attr("data-uri"),contentType:"application/json; charset=utf-8",dataType:"html"}).done(function(a){$.each(t,function(e,t){$(t).empty().append(a);$(t).find('[data-toggle="popover"]').popover({html:true,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content" style="padding-bottom:3px;"></div></div>'})})})}})}});(function(k){function e(e){this._element=k(e);this._target=this._element.data("target")||{};this._serviceUrlGet=this._element.attr("data-url-get");this._serviceUrlAddFiles=this._element.attr("data-url-add-files");this._serviceUrlAddFolder=this._element.attr("data-url-add-folder");this._serviceUrlDelete=this._element.attr("data-url-delete");this._addEnabled=this._element.data("add-enabled");this._deleteEnabled=this._element.data("delete-enabled");this._pageSize=this._element.attr("data-pagesize");this._addSuccess=false;this._deleteSuccess=false;var n=this;k(e).on("refresh",function(e,t,a){n.load(a,t)})}k(document).ready(function(){k(".sharepoint-grid").each(function(){new e(k(this)).render()})});e.prototype.render=function(){var e=this;var a=e._element;var t=a.children(".grid-actions").find("a.add-file");var n=a.children(".modal-add-file");var i=n.find(".modal-footer .btn-primary");var r=n.find("input[type='file']");var o=a.children(".grid-actions").find("a.add-folder");var l=a.children(".modal-add-folder");var d=l.find(".modal-footer .btn-primary");var s=a.children(".modal-delete-file");var c=a.children(".modal-delete-folder");e.load();s.on("shown.bs.modal",function(){k('[class="modal fade modal-delete modal-delete-file in"]').find('[class="primary btn btn-primary"]').trigger("focus")});c.on("shown.bs.modal",function(){k('[class="modal fade modal-delete modal-delete-folder in"]').find('[class="primary btn btn-primary"]').trigger("focus")});if(e._addEnabled){t.on("click",function(){var e=n.find(".destination-group");var t=a.attr("data-folderpath");if(!t){e.hide()}else{e.find("p.destination-folder").html(t+"/");e.show()}n.modal("show");n.attr("aria-hidden","false")});i.on("click",function(){e.addFile()});n.on("shown.bs.modal",function(){setTimeout(function(){n.find("input").first().attr("tabindex",0);n.find("input").first().focus()},1e3);i.prop("disabled",true)});n.on("hidden.bs.modal",function(){n.find("input[type='file']").val("");n.find(".alert-danger.error").remove();n.attr("aria-hidden","true")});r.change(function(){i.prop("disabled",!r.val())});o.on("click",function(){var e=l.find(".destination-group");var t=a.attr("data-folderpath");if(!t){e.hide()}else{e.find("p.destination-folder").html(t+"/");e.show()}l.modal("show");l.attr("aria-hidden","false");d.prop("disabled",true)});var f=l.find("#FolderName");f.on("keyup",function(){d.prop("disabled",false);if(f.val()==""){d.prop("disabled",true)}});d.on("click",function(){e.addFolder()});l.on("shown.bs.modal",function(){k(this).find("input:visible:first").trigger("focus")});l.on("hidden.bs.modal",function(){l.find("#FolderName").val("");l.find(".alert-danger.error").remove();l.attr("aria-hidden","true")})}};e.prototype.load=function(e,o){var l=this;var d=l._element;var s=d.children(".sharepoint-data");var r=d.children(".sharepoint-error");var c=d.children(".sharepoint-empty");var f=d.children(".sharepoint-access-denied");var u=d.children(".sharepoint-config-error");var t=d.children(".sharepoint-loading");var a=d.find(".sharepoint-breadcrumbs");var n=d.find(".sharepoint-pagination");var i=l._serviceUrlGet;var p=l._target;var v=l._pageSize;r.hide();c.hide();f.hide();u.hide();s.children(".view-grid").find("tbody").remove();a.hide().empty();n.hide();t.show();var h=d.attr("data-sort-expression")||"FileLeafRef ASC";var m=n.data("current-page");if(m==null||m==""){m=1}e=e||m;var g=n.data("pagesize");if(g==null||g==""){g=v}var y=d.attr("data-folderpath")||"";var b=y.replace(/[^a-zA-Z0-9_.-]/g,"");var C=d.attr("data-paging-info"+e+b);l.getData(i,p,h,e,g,C,y,function(e){if(typeof e===typeof undefined||e===false||e==null){c.fadeIn();return}if(typeof e.AccessDenied!==typeof undefined&&e.AccessDenied!==false&&e.AccessDenied){f.fadeIn();return}if(typeof e.ConfigError!==typeof undefined&&e.ConfigError!==false&&e.ConfigError){u.fadeIn();return}if(e.TotalCount==0){--m;if(m>=1){l.load(m);d.attr("data-page-count"+b,m)}else{c.fadeIn()}return}var t=k("#sharepoint-template").html();var a=Handlebars.compile(t);s.html(a(e));s.find("abbr.timeago").each(function(){var e=k(this).attr("title");var t=window.moment;if(t){var a=dateFormatConverter.convert(d.closest("[data-dateformat]").data("dateformat")||"M/d/yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(d.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=a+" "+n;k(this).text(t(e).format(i))}});s.find("abbr.timeago").timeago();l.initializeBreadcrumbs(y);s.fadeIn();l.addFolderClickEventHandlers();if(l._deleteEnabled&&l._deleteEnabled!="False"){l.addDeleteClickEventHandlers()}var n=h.split(" ");var i=n[0];var r=n[1];d.find(".view-grid").find("table").find("th.sort-enabled a").each(function(){var e=k(this).closest("th");e.attr("aria-label",e.find("span").html());if(e.data("sort-name")==i){if(r=="ASC"){e.data("sort-dir","ASC").addClass("sort").removeClass("sort-desc").addClass("sort-asc");e.attr("aria-sort","ascending");k(this).append(" ").append(k("<span></span>").addClass("fa").addClass("fa-arrow-up").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Ascending_Order"]+"</span>")}else{e.data("sort-dir","DESC").addClass("sort").removeClass("sort-asc").addClass("sort-desc");e.attr("aria-sort","descending");k(this).append(" ").append(k("<span></span>").addClass("fa").addClass("fa-arrow-down").attr("aria-hidden","true")).append("<span class='sr-only sort-hint'>. "+window.ResourceManager["Sort_Descending_Order"]+"</span>")}e.addClass("sort")}});l.addSortEventHandlers(o);l.initializePagination(e,b,o);if(o!=null&&k.isNumeric(o)){if(o!=-1)d.find(".view-grid").find("table").find("tr.sp-item td").filter('[data-type="System.String"]').find("a")[o].focus();else d.find(".view-grid").find("table")[0].focus()}},function(e,t,a){if(a){ClientLogWrapper.getLogger().traceError("Error: "+a,"sharepoint_grid","","GetData");var n=e.getResponseHeader("content-type")||"";var i=n.indexOf("json")>-1?e.responseJSON.Message:a;r.find(".alert.alert-block.alert-danger").html(i)}ClientLogWrapper.getLogger().traceError("Error in getting data","sharepoint_grid","","GetData");r.show()},function(){t.hide()})};e.prototype.getData=function(e,t,a,n,i,r,o,l,d,s){l=k.isFunction(l)?l:function(){};d=k.isFunction(d)?d:function(){};s=k.isFunction(s)?s:function(){};if(!e||e==""){s.call(this);d.call(this,null,"error","A required service url was not provided.");return}if(!t){s.call(this);d.call(this,null,"error","A required regarding EntityReference parameter was not provided.");return}i=i||-1;var c={};c.regarding=t;c.sortExpression=a;c.page=n;c.pageSize=i;c.pagingInfo=r;c.folderPath=o;var f=JSON.stringify(c);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json",url:e,data:f,global:false}).done(l).fail(d).always(s)};e.prototype.initializeBreadcrumbs=function(e){if(!e)return;var n=this;var i=n._element;var r=i.find(".sharepoint-breadcrumbs");var o="";var l=e.split("/");k.each(l,function(e,t){if(e==l.length-1){r.append("<li class='active'>"+t+"</li>")}else if(!t){var a=window.ResourceManager["All"];r.append("<li><a href= '#' data-folderpath='' \" title= \""+a+'">'+a+"</a></li>")}else{o=o+"/"+t;r.append("<li><a href='#' data-folderpath=\""+o+'">'+t+"</a></li>")}r.find("a").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();var t=1;if(k(this).attr("data-folderpath")=="")t=0;i.attr("data-folderpath",k(this).attr("data-folderpath"));n.load(1,t)})});r.fadeIn()};e.prototype.addFolderClickEventHandlers=function(){var t=this;var a=t._element;a.find(".folder-link").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();a.attr("data-folderpath",k(this).attr("data-folderpath"));t.load(1)})};e.prototype.addFile=function(){var e=this;var t=e._element;var a=e._target;var n=e._serviceUrlAddFiles;var i=t.find(".modal-add-file");var r=i.find(".modal-footer button.primary");var o=false;b(i);if(n==null||n==""){var l={Message:"System Error",InnerError:{Message:"The URL to the service for this Add File Request could not be determined."}};y(l,i);return}var d=i.find("input[type='file']");var s=0;var c=this._element.attr("data-maxFileUploadSize");var f=c*1024*1024;for(var u=0;u<d[0].files.length;u++){var p=d[0].files[u].size;if(p>f){var l={Message:"System Error",InnerError:{Message:String.format(window.ResourceManager["Sharepoint_File_Size_Not_Supported"],c)}};y(l,i);return}s+=p}var v=this._element.attr("data-maxTotalUploadSize");if(s>v*1024*1024){var l={Message:"System Error",InnerError:{Message:String.format(window.ResourceManager["Sharepoint_Total_File_Size_Not_Supported"],v)}};y(l,i);return}var h=i.find("input[type='checkbox']");if(h.length>0){o=h.prop("checked")}r.html(window.ResourceManager["Adding_Files"]);if(window.FormData!==undefined){var m=new FormData;m.append("regardingEntityLogicalName",a.LogicalName);m.append("regardingEntityId",a.Id);if(d.length>0){if(typeof d[0].files!==typeof undefined&&d[0].files.length>0){var g=d[0].files;for(var u=0;u<g.length;u++){m.append("files",g[u])}}}m.append("overwrite",o);if(t.attr("data-folderpath")){m.append("folderPath",t.attr("data-folderpath"))}r.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-pulse' aria-hidden='true'></span> ");d.attr("disabled","disabled");shell.ajaxSafePost({url:n,type:"POST",data:m,mimeType:"multipart/form-data",contentType:false,cache:false,processData:false}).done(function(){e._addSuccess=true;t.trigger("refresh");i.modal("hide")}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?k.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};y(a,i)}).always(function(){r.prop("disabled",false).find(".fa-pulse").remove();d.prop("disabled",false);r.html(window.ResourceManager["Add_Files"])})}else{y({Message:"Your browser does not support FormData."},i)}};e.prototype.addFolder=function(){var e=this;var t=e._element;var a=e._target;var n=e._serviceUrlAddFolder;var i=t.find(".modal-add-folder");var r=i.find(".modal-footer button.primary");if(n==null||n==""){var o={Message:"System Error",InnerError:{Message:"The URL to the service for this Add Folder Request could not be determined."}};y(o,i);return}r.attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-pulse' aria-hidden='true'></span> ");var l=i.find("#FolderName").val();var d=t.attr("data-folderpath")||"";var s={};s.regarding=a;s.name=l;s.folderPath=d;var c=JSON.stringify(s);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:n,data:c}).done(function(){e._addSuccess=true;t.attr("data-folderpath",d+"/"+l);i.modal("hide");e.load(1)}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?k.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};y(a,i)}).always(function(){r.prop("disabled",false).find(".fa-pulse").remove()})};e.prototype.addDeleteClickEventHandlers=function(){var s=this;var c=s._element;var f=s._target;var u=s._serviceUrlDelete;var p=c.children(".modal-delete-file");if(p.length==0){return}p.on("hidden.bs.modal",function(){p.find(".sp-item-name").remove();p.find(".alert-danger.error").remove();v.attr("aria-hidden","true")});var v=c.children(".modal-delete-folder");if(v.length==0){return}v.on("hidden.bs.modal",function(){v.find(".sp-item-name").remove();v.find(".alert-danger.error").remove();v.attr("aria-hidden","true")});c.find(".delete-link").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();var t=k(this).closest(".sp-item");var i=t.data("id");if(!i||i==""){console.log("Failed to launch delete dialog. Data parameter 'id' is null.");return}var r=t.data("foldername")?v:p;var a=r.find(".modal-body");a.append(k("<p class='sp-item-name'>").html(t.find("a").html()));var o=r.find(".modal-footer button.primary");var l=c.find(".view-grid").find("table").find("tr.sp-item").index(t);var n=r.find("button[class='cancel btn btn-default']");var d=r.find("button[class='form-close']");n.off("click");n.on("click",function(){r.modal("hide");c.find(".view-grid").find("table").find("tr.sp-item a.btn-xs")[l].trigger("focus")});d.off("click");d.on("click",function(){r.modal("hide");c.find(".view-grid").find("table").find("tr.sp-item a.btn-xs")[l].trigger("focus")});o.off("click");o.on("click",function(){k(this).attr("disabled","disabled").prepend("<span class='fa fa-spinner fa-pulse' aria-hidden='true'></span>");var e=c.find(".view-grid").find("table").find("tr.sp-item").length;if(e==1||l==e-1)l=-1;var t={};var a=c.attr("data-folderpath")||"";t.regarding=f;t.id=i;t.folderPath=a;var n=JSON.stringify(t);shell.ajaxSafePost({type:"POST",contentType:"application/json",url:u,data:n}).done(function(){s._deleteSuccess=true;c.trigger("refresh",[l]);r.modal("hide")}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?k.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};y(a,p)}).always(function(){o.prop("disabled",false).find(".fa-pulse").remove()})});r.modal("show");r.attr("aria-hidden","false")})};e.prototype.addSortEventHandlers=function(e){var r=this;var o=r._element;o.find(".view-grid").find("table").find("th.sort-enabled a").on("click",function(e){e.stopImmediatePropagation();e.preventDefault();var t=k(this).closest("th");var a=t.data("sort-name");var n=t.data("sort-dir");if(typeof a===typeof undefined||a===false||a===null||a===""){return}if(typeof n===typeof undefined||n===false){n=""}var i;if(n=="ASC"){i=a+" DESC"}else{i=a+" ASC"}o.attr("data-sort-expression",i);r.load(1,e.currentTarget)});if(e!=null&&!k.isNumeric(e)){var t=k.trim(k("span:first",k(e)).text());o.find(".view-grid").find("table").find("th.sort-enabled a").filter(function(){var e=k.trim(k("span:first",k(this)).text());return e==t}).trigger("focus")}};e.prototype.initializePagination=function(e,t,a){if(typeof e===typeof undefined||e===false||e==null){return}if(typeof e.PageSize===typeof undefined||e.PageSize===false||e.PageSize==null||(typeof e.PageNumber===typeof undefined||e.PageNumber===false||e.PageNumber==null)||(typeof e.TotalCount===typeof undefined||e.TotalCount===false||e.TotalCount==null)){return}var n=this;var i=n._element;var r=i.find(".sharepoint-pagination");var o=parseInt(i.attr("data-page-count"+t))||1;var l=Math.ceil(e.TotalCount/e.PageSize);if(o>l){o=o-1}if(e.PagingInfo){i.attr("data-paging-info"+(e.PageNumber+1)+t,e.PagingInfo);if(o<e.PageNumber+1){o=e.PageNumber+1;i.attr("data-page-count"+t,o)}}if(o<=1&&e.PageNumber==1){r.hide();return}r.data("pagesize",e.PageSize).data("pages",o).data("current-page",e.PageNumber).data("count",e.TotalCount).off("click").pagination({total_pages:r.data("pages"),current_page:r.data("current-page"),callback:function(e,t){e.stopImmediatePropagation();e.preventDefault();var a=k(e.target).closest("li");if(a.not(".disabled").length>0&&a.not(".active").length>0){n.load(t,e.currentTarget)}}}).show();r.find("li").first().find("a").attr("aria-label",window.ResourceManager["Pagination_Previous_Page"]);r.find("li").last().find("a").attr("aria-label",window.ResourceManager["Pagination_Next_Page"]);r.find("li.active").find("a").attr("aria-label",window.ResourceManager["Pagination_Current_Page"].replace("{0}",e.PageNumber));r.find("li.disabled").find("a").removeAttr("href");if(a!=null&&!k.isNumeric(a)){r.find("a").filter(function(){return k(this).text()==k(a).text()}).trigger("focus")}};function y(e,t){if(typeof e!==typeof undefined&&e!==false&&e!=null){console.log(e);var a=t.find(".modal-body");var n=t.find(".alert-danger.error");if(n.length==0){n=k("<div></div>").addClass("alert alert-block alert-danger error clearfix")}else{n.empty()}if(typeof e.InnerError!==typeof undefined&&typeof e.InnerError.Message!==typeof undefined&&e.InnerError.Message!==false&&e.InnerError.Message!=null){if(typeof e.InnerError.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.InnerError.Message+"</p>")}ClientLogWrapper.getLogger().traceError("Error: "+e.message+", Details: "+e.InnerError.Message,"sharepoint_grid")}else if(typeof e.Message!==typeof undefined&&e.Message!==false&&e.Message!=null){if(typeof e.Message==="number"){n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+" Error</p>")}else{n.append("<p><span class='fa fa-exclamation-triangle' aria-hidden='true'></span> "+e.Message+"</p>")}ClientLogWrapper.getLogger().traceError("Error: "+e.Message,"sharepoint_grid")}a.prepend(n)}else{ClientLogWrapper.getLogger().traceError("Unknown error in SharePoint grid","sharepoint_grid")}}function b(e){e.find(".alert-danger.error").hide()}})(jQuery);
/*RateIt | v1.0.24 / 06/14/2016 https://github.com/gjunge/rateit.js
Copyright (c) 2016 Gideon Junge

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/(function(_){function w(e){var t=e.originalEvent.changedTouches,a=t[0],n="",i;switch(e.type){case"touchmove":n="mousemove";break;case"touchend":n="mouseup";break;default:return}i=document.createEvent("MouseEvent");i.initMouseEvent(n,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(i);e.preventDefault()}_.rateit={aria:{resetLabel:"reset rating",ratingLabel:"rating"}};_.fn.rateit=function(m,g){var y=1,b={},C="init",k=function(e){return e.charAt(0).toUpperCase()+e.substr(1)},e;if(this.length===0)return this;if(e=_.type(m),e=="object"||m===undefined||m===null)b=_.extend({},_.fn.rateit.defaults,m);else{if(e=="string"&&m!=="reset"&&g===undefined)return this.data("rateit"+k(m));e=="string"&&(C="setvalue")}return this.each(function(){var i=_(this),r=function(e,t){if(t!=null){var a="aria-value"+(e=="value"?"now":e),n=i.find(".rateit-range");n.attr(a)!=undefined&&n.attr(a,t)}return arguments[0]="rateit"+k(e),i.data.apply(i,arguments)},e,t,o,a,n,l,d,s,c,f,u;if(m=="reset"){e=r("init");for(t in e)i.data(t,e[t]);r("backingfld")&&(a=_(r("backingfld")),a.val(r("value")),a.trigger("change"),a[0].min&&(a[0].min=r("min")),a[0].max&&(a[0].max=r("max")),a[0].step&&(a[0].step=r("step")));i.trigger("reset")}if(i.hasClass("rateit")||i.addClass("rateit"),o=i.css("direction")!="rtl",C=="setvalue"){if(!r("init"))throw"Can't set value before init";m!="readonly"||g!=!0||r("readonly")||(i.find(".rateit-range").unbind(),r("wired",!1));m=="value"&&(g=g==null?r("min"):Math.max(r("min"),Math.min(r("max"),g)));r("backingfld")&&(a=_(r("backingfld")),m=="value"&&a.val(g),m=="min"&&a[0].min&&(a[0].min=g),m=="max"&&a[0].max&&(a[0].max=g),m=="step"&&a[0].step&&(a[0].step=g));r(m,g)}r("init")||(r("min",isNaN(r("min"))?b.min:r("min")),r("max",isNaN(r("max"))?b.max:r("max")),r("step",r("step")||b.step),r("readonly",r("readonly")!==undefined?r("readonly"):b.readonly),r("resetable",r("resetable")!==undefined?r("resetable"):b.resetable),r("backingfld",r("backingfld")||b.backingfld),r("starwidth",r("starwidth")||b.starwidth),r("starheight",r("starheight")||b.starheight),r("value",Math.max(r("min"),Math.min(r("max"),isNaN(r("value"))?isNaN(b.value)?b.min:b.value:r("value")))),r("ispreset",r("ispreset")!==undefined?r("ispreset"):b.ispreset),r("backingfld")&&(a=_(r("backingfld")).hide(),(a.attr("disabled")||a.attr("readonly"))&&r("readonly",!0),a[0].nodeName=="INPUT"&&(a[0].type=="range"||a[0].type=="text")&&(r("min",parseInt(a.attr("min"))||r("min")),r("max",parseInt(a.attr("max"))||r("max")),r("step",parseInt(a.attr("step"))||r("step"))),a[0].nodeName=="SELECT"&&a[0].options.length>1?(r("min",isNaN(r("min"))?Number(a[0].options[0].value):r("min")),r("max",Number(a[0].options[a[0].length-1].value)),r("step",Number(a[0].options[1].value)-Number(a[0].options[0].value)),n=a.find("option[selected]"),n.length==1&&r("value",n.val())):r("value",a.val())),l=i[0].nodeName=="DIV"?"div":"span",y++,d='<button id="rateit-reset-{{index}}" type="button" data-role="none" class="rateit-reset" aria-label="'+_.rateit.aria.resetLabel+'" aria-controls="rateit-range-{{index}}"></button><{{element}} id="rateit-range-{{index}}" class="rateit-range" tabindex="0" role="slider" aria-label="'+_.rateit.aria.ratingLabel+'" aria-owns="rateit-reset-{{index}}" aria-valuemin="'+r("min")+'" aria-valuemax="'+r("max")+'" aria-valuenow="'+r("value")+'"><{{element}} class="rateit-selected" style="height:'+r("starheight")+'px"></{{element}}><{{element}} class="rateit-hover" style="height:'+r("starheight")+'px"></{{element}}></{{element}}>',i.append(d.replace(/{{index}}/gi,y).replace(/{{element}}/gi,l)),o||(i.find(".rateit-reset").css("float","right"),i.find(".rateit-selected").addClass("rateit-selected-rtl"),i.find(".rateit-hover").addClass("rateit-hover-rtl")),r("init",JSON.parse(JSON.stringify(i.data()))));i.find(".rateit-selected, .rateit-hover").height(r("starheight"));s=i.find(".rateit-range");s.width(r("starwidth")*(r("max")-r("min"))).height(r("starheight"));c="rateit-preset"+(o?"":"-rtl");r("ispreset")?i.find(".rateit-selected").addClass(c):i.find(".rateit-selected").removeClass(c);r("value")!=null&&(f=(r("value")-r("min"))*r("starwidth"),i.find(".rateit-selected").width(f));u=i.find(".rateit-reset");u.data("wired")!==!0&&u.bind("click",function(e){e.preventDefault();u.blur();var t=_.Event("beforereset");if(i.trigger(t),t.isDefaultPrevented())return!1;i.rateit("value",null);i.trigger("reset")}).data("wired",!0);var p=function(e,t){var a=t.changedTouches?t.changedTouches[0].pageX:t.pageX,n=a-_(e).offset().left;return o||(n=s.width()-n),n>s.width()&&(n=s.width()),n<0&&(n=0),f=Math.ceil(n/r("starwidth")*(1/r("step")))},v=function(e){var t=e*r("starwidth")*r("step"),a=s.find(".rateit-hover"),n;a.data("width")!=t&&(s.find(".rateit-selected").hide(),a.width(t).show().data("width",t),n=[e*r("step")+r("min")],i.trigger("hover",n).trigger("over",n))},h=function(e){var t=_.Event("beforerated");return(i.trigger(t,[e]),t.isDefaultPrevented())?!1:(r("value",e),r("backingfld")&&_(r("backingfld")).val(e).trigger("change"),r("ispreset")&&(s.find(".rateit-selected").removeClass(c),r("ispreset",!1)),s.find(".rateit-hover").hide(),s.find(".rateit-selected").width(e*r("starwidth")-r("min")*r("starwidth")).show(),i.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[e]),!0)};r("readonly")?u.hide():(r("resetable")||u.hide(),r("wired")||(s.bind("touchmove touchend",w),s.mousemove(function(e){var t=p(this,e);v(t)}),s.mouseleave(function(){s.find(".rateit-hover").hide().width(0).data("width","");i.trigger("hover",[null]).trigger("over",[null]);s.find(".rateit-selected").show()}),s.mouseup(function(e){var t=p(this,e),a=t*r("step")+r("min");h(a);s.blur()}),s.keyup(function(e){(e.which==38||e.which==(o?39:37))&&h(Math.min(r("value")+r("step"),r("max")));(e.which==40||e.which==(o?37:39))&&h(Math.max(r("value")-r("step"),r("min")))}),r("wired",!0)),r("resetable")&&u.show());s.attr("aria-readonly",r("readonly"))})};_.fn.rateit.defaults={min:0,max:5,step:.5,starwidth:16,starheight:16,readonly:!1,resetable:!0,ispreset:!1};_(function(){_("div.rateit, span.rateit").rateit()})})(jQuery);(function(f){function e(e){this._element=f(e);this._urlSave=this._element.attr("data-url-save");this._logicalName=this._element.attr("data-logicalname");this._id=this._element.attr("data-id");this._min=this._element.attr("data-rateit-min");this._max=this._element.attr("data-rateit-max")}f(document).ready(function(){f(".rateit").each(function(){new e(f(this)).initialize()})});e.prototype.initialize=function(){var a=this;var e=a._element;var t=a._urlSave;var n=a._logicalName;var i=a._id;if(typeof t===typeof undefined||t===null||t===""){return}if(typeof n===typeof undefined||n===null||n===""){return}if(typeof i===typeof undefined||i===null||i===""){return}e.rateit("readonly",false);e.focusout(function(){var e=f(this).rateit("value");var t=parseInt(f(this).attr("data-rateit-value"));if(e!=t)a.saveRating(e)})};e.prototype.saveRating=function(e){var t=this;var n=t._element;var a=t._urlSave;var i=t._logicalName;var r=t._id;var o=t._min;var l=t._max;if(typeof e===typeof undefined||e===null||e===""){n.rateit("reset");return}if(typeof a===typeof undefined||a===null||a===""){n.rateit("reset");return}if(typeof i===typeof undefined||i===null||i===""){n.rateit("reset");return}if(typeof r===typeof undefined||r===null||r===""){n.rateit("reset");return}if(typeof o===typeof undefined||o===null||o===""){o=0}else{o=parseInt(o);if(isNaN(o)){o=0}}if(typeof l===typeof undefined||l===null||l===""){l=5}else{l=parseInt(l);if(isNaN(l)){l=5}}n.rateit("readonly",true);var d={};var s={};s.LogicalName=i;s.Id=r;d.entityReference=s;d.rating=e;d.min=o;d.max=l;var c=JSON.stringify(d);shell.ajaxSafePost({type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:a,data:c,processData:false,global:false}).done(function(e){if(typeof e!==typeof undefined&&e!=null&&e!==""){n.rateit("value",e.AverageRatingRounded);var t=n.closest(".rating").find(".rating-count");t.text(e.RatingCount);n.attr("data-rateit-value",e.AverageRatingRounded)}else{n.rateit("reset");return}}).fail(function(e){var t=e.getResponseHeader("content-type")||"";var a=t.indexOf("json")>-1?f.parseJSON(e.responseText):{Message:e.status,InnerError:{Message:e.statusText}};if(typeof console!==typeof undefined&&typeof console.log!==typeof undefined){console.log(a)}n.rateit("reset")}).always(function(){n.rateit("readonly",false)})}})(jQuery);var portal=portal||{};portal.convertAbbrDateTimesToTimeAgo=function(o){o("abbr.timeago").each(function(){var e=o(this),t=Date.parse(e.text()),a;if(t){a=moment(t);var n=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var r=dateFormatConverter.convert(e.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||n+" "+i;e.attr("title",a.format("YYYY-MM-DDTHH:mm:ss"));e.text(a.format(r))}});o("abbr.timeago").timeago();o("abbr.posttime").each(function(){var e=o(this),t=Date.parse(e.text()),a;if(t){a=moment(t);var n=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var r=dateFormatConverter.convert(e.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||n+" "+i;e.attr("title",a.format(r));e.text(a.format(r))}})};portal.initializeHtmlEditors=function(){var e=$("[data-app-path]").data("app-path")||"/";$(document).on("focusin",function(e){if($(e.target).closest(".mce-window").length){e.stopImmediatePropagation()}});$(".html-editors textarea").each(function(){if(window.DisableCkEditor==undefined||window.DisableCkEditor.Value=="False"){var e=240;var t=e+120;var a=this.id+"Control";$("<div id='"+a+"' style='height:"+t+"px'></div>").insertAfter(this);var n=new MscrmControls.CkEditorCustomControl.CKEditorCustomToolbar("Portals",[{name:"clipboard",items:["Cut","Copy","Paste","PasteText","PasteFromWord","Undo","Redo"]},{name:"links",items:["Link","Unlink"]},{name:"editing",items:["Find","Replace","-","SelectAll","-","Scayt"]},{name:"insert",items:["Image","Flash","Table","HorizontalRule","Smiley","SpecialChar","PageBreak","Iframe"]},{name:"forms",items:["Form","Checkbox","Radio","TextField","Textarea","Select","Button","ImageButton","HiddenField"]},{name:"tools",items:["ShowBlocks"]},{name:"document",items:["Source","-","Save","NewPage","Preview","Print","-","Templates"]},"/",{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Subscript","Superscript","-","CopyFormatting","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},"/",{name:"styles",items:["Styles","Format","Font","FontSize"]},{name:"colors",items:["TextColor","BGColor"]},{name:"about",items:["About"]}]);(new MscrmControls.CkEditorCustomControl.CKEditorFactory).create(a,this.id,n,["/css/bootstrap.min.css","/css/ckeditor.css"],this.value,[],function(){if(CKEDITOR.stylesSet.registered.portal==null||CKEDITOR.stylesSet.registered.portal==undefined){CKEDITOR.stylesSet.add("portal",[{name:window.ResourceManager["CKEditor_Code_Style"],element:"code"},{name:window.ResourceManager["CKEditor_Code_Block_Style"],element:"pre",attributes:{class:"linenums prettyprint"}}])}CKEDITOR.config.contentsCss=["/css/bootstrap.min.css","/css/ckeditor.css"];CKEDITOR.config.height=e;CKEDITOR.config.stylesSet="portal";CKEDITOR.config.format_tags="p;h1;h2;h3;h4;h5;h6;pre";CKEDITOR.config.disableNativeSpellChecker=false;CKEDITOR.config.removePlugins=CKEDITOR.config.removePlugins.split(",").filter(function(e){return e!=="contextmenu"}).join();CKEDITOR.config.extraPlugins="contextmenu,";CKEDITOR.config.removeButtons="Save,NewPage,Preview,Print,Templates,SelectAll,Find,Replace,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Anchor,Flash,Smiley,PageBreak,Iframe,ShowBlocks,Font,FontSize,CreateDiv,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,BidiRtl,BidiLtr,Language,TextColor,BGColor,About,Subscript,Superscript,Underline"}.bind(this),window.ResourceManager["CkEditor_Aria_Label"]);this.style.display="none";this.style.visibility="hidden"}})};(function(s,o){if(window.DisableCkEditor==undefined||window.DisableCkEditor.Value=="False"){portal.initializeHtmlEditors()}s(function(){moment.locale(s("html").attr("lang"));portal.convertAbbrDateTimesToTimeAgo(s);var t=s(".facebook-signin");t.on("click",function(e){e.preventDefault();window.open(t.attr("href"),"facebook_auth","menubar=1,resizable=1,scrollbars=yes,width=800,height=600")});s(".crmEntityFormView input:not([value])[readonly]:not([placeholder]), .crmEntityFormView input[value=''][readonly]:not([placeholder])").filter(function(){var e=s(this).val();return e==null||e.length===0}).each(function(){s(this).parent().css("position","relative");s(this).after(s("<div>&mdash;</div>").addClass("text-muted").css("position","absolute").css("top",4).attr("aria-hidden","true"))});s(".crmEntityFormView select[readonly] option:checked[value='']").closest("select").each(function(){s(this).parent().css("position","relative");try{s(this).css("display","none")}catch(e){console.error("Error hiding select element:",e)}s(this).after(s("<div>&mdash;</div>").addClass("text-muted").css("top",4).attr("aria-hidden","true"))});s(".crmEntityFormView select[readonly]").closest("select").on("keydown",function(e){if(e.keyCode!=9){e.preventDefault()}});s(".crmEntityFormView textarea[readonly]").filter(function(){return s(this).val().length===0}).each(function(){s(this).parent().css("position","relative");s(this).after(s("<div>&mdash;</div>").addClass("text-muted").css("position","absolute").css("top",4).attr("aria-hidden","true"))});s(".btn-select").each(function(){var a=s(this),n=s(a.data("target")),i=s(a.data("focus")),r=s(".btn .selected",a);n.on("change",function(){var e=s("option:selected",n);a.find(".dropdown-menu li.active a").prop("aria-selected",false);a.find(".dropdown-menu li.active").removeClass("active");r.text(e.text())});s(".dropdown-menu li > a",a).on("click",function(){var e=s(this),t=e.data("value");s(".dropdown-menu li a",a).attr("aria-selected",false);s(".dropdown-menu li",a).removeClass("active");e.parent("li").addClass("active");e.attr("aria-selected",true);n.val(t);r.text(e.text());i.trigger("focus")})});s("abbr.timestamp").each(function(){var e=s(this),t=Date.parse(e.text()),a;if(t){a=moment(t);var n=dateFormatConverter.convert(element.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=dateFormatConverter.convert(element.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var r=dateFormatConverter.convert(element.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||n+" "+i;e.text(a.format(r));e.attr("title",a.format(r))}});s("time").each(function(){var e=s(this),t=moment(e.attr("datetime"));if(t){var a=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var n=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);var i=a+" "+n;e.text(t.format(e.hasClass("date-only")?a:i))}});s(".vevent").each(function(){var e=s(".dtstart",this),t=s(".dtend",this),a=Date.parse(e.text()),n=Date.parse(t.text()),i,r,o,l,d;if(a){l=moment(a);i=dateFormatConverter.convert(e.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);r=dateFormatConverter.convert(e.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);o=dateFormatConverter.convert(e.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||i+" "+r;e.text(l.format(o));e.attr("title",l.format(o))}if(n){d=moment(n);i=dateFormatConverter.convert(t.closest("[data-dateformat]").data("dateformat")||"MMMM d, yyyy",dateFormatConverter.dotNet,dateFormatConverter.momentJs);r=dateFormatConverter.convert(t.closest("[data-timeformat]").data("timeformat")||"h:mm tt",dateFormatConverter.dotNet,dateFormatConverter.momentJs);o=dateFormatConverter.convert(t.attr("data-format"),dateFormatConverter.dotNet,dateFormatConverter.momentJs)||i+" "+r;t.text(d.format(a&&d.isSame(moment(a),"day")?r:o));t.attr("title",d.format(o))}});s(".carousel").carousel();if(s.ui&&s.ui.tooltip){s.widget.bridge("uitooltip",s.ui.tooltip)}s(".has-tooltip").tooltip({container:"body"});prettyPrint();(function(){var r={};s(".shopping-cart-status").each(function(){var t=s(this),e=t.attr("data-href"),a=t.find(".count"),n=a.find(".value"),i;if(!e){return}i=r[e];if(!s.isArray(i)){i=r[e]=[]}i.push(function(e){if(e!=null&&e.Count&&e.Count>0){n.text(e.Count);a.addClass("visible");t.addClass("visible")}})});s.each(r,function(e,t){s.getJSON(e,function(a){s.each(t,function(e,t){t(a)})})})})();s('[data-state="sitemap"]').each(function(){var e=s(this),i=e.data("sitemap-current"),r=e.data("sitemap-ancestor"),t=e.closest("[data-sitemap-state]").data("sitemap-state"),o,l;if(!(t&&(i||r))){return}o=t.split(":");l=o[o.length-1];e.find("[data-sitemap-node]").each(function(){var a=s(this),n=a.data("sitemap-node");if(!n){return}s.each(o,function(e,t){if(e===0){if(i&&t==n){a.addClass(i)}}else{if(r&&t==n&&n!=l){a.addClass(r)}}})})});(function(){var a=URI?URI(document.location.href).search(true)||{}:{};s("[data-query]").each(function(){var e=s(this),t=a[e.data("query")];if(typeof t==="undefined"){return}e.val(t).trigger("change")})})()});if(typeof o!="undefined"&&o&&(window.DisableCkEditor==undefined||window.DisableCkEditor.Value=="False")){o.zindex=2e3;(function(){var e=[o.ckeditorSettings,o.ckeditorCompactSettings];for(var t=0;t<e.length;t++){var a=e[t];if(!a)continue;var n=s('head > link[rel="stylesheet"]').map(function(e,t){var a=s(t).attr("href");return a.match(/,/)?null:a}).get();n.push((s("[data-app-path]").data("app-path")||"/")+"css/ckeditor.css");a.contentsCss=n}var i=CKEDITOR.stylesSet.get("cms");if(i){var r=[{name:window.ResourceManager["CKEditor_Page_Header_Style"],element:"div",attributes:{class:"page-header"}},{name:window.ResourceManager["CKEditor_Alert_Info_Style"],element:"div",attributes:{class:"alert alert-info"}},{name:window.ResourceManager["CKEditor_Alert_Success_Style"],element:"div",attributes:{class:"alert alert-success"}},{name:window.ResourceManager["CKEditor_Alert_Warning_Style"],element:"div",attributes:{class:"alert alert-warning"}},{name:window.ResourceManager["CKEditor_Alert_Danger_Style"],element:"div",attributes:{class:"alert alert-danger"}},{name:window.ResourceManager["CKEditor_Well_Style"],element:"div",attributes:{class:"well"}},{name:window.ResourceManager["CKEditor_Well_Small_Style"],element:"div",attributes:{class:"well well-sm"}},{name:window.ResourceManager["CKEditor_Well_Large_Style"],element:"div",attributes:{class:"well well-lg"}},{name:window.ResourceManager["CKEditor_Label_Style"],element:"span",attributes:{class:"label label-default"}},{name:window.ResourceManager["CKEditor_Label_Info_Style"],element:"span",attributes:{class:"label label-info"}},{name:window.ResourceManager["CKEditor_Label_Success_Style"],element:"span",attributes:{class:"label label-success"}},{name:window.ResourceManager["CKEditor_Label_Warning_Style"],element:"span",attributes:{class:"label label-warning"}},{name:window.ResourceManager["CKEditor_Label_Danger_Style"],element:"span",attributes:{class:"label label-danger"}}];for(var t=0;t<r.length;t++){i.push(r[t])}}})()}var e=s.cookie("adx-notification");if(typeof e===typeof undefined||e==null)return;t(e,true);s.cookie("adx-notification",null,{path:"/"});function t(e,t){var a=s(".notifications");if(a.length==0){var n=s(".page-heading");if(n.length==0){a=s("<div class='notifications'></div>").prependTo(s("#content-container"))}else{a=s("<div class='notifications'></div>").appendTo(n)}}a.find(".notification").slideUp().remove();if(typeof e!==typeof undefined&&e!==false&&e!=null&&e!=""){var i=s("<div class='notification alert alert-success success alert-dismissible' role='alert'><button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>"+e+"</div>").on("closed.bs.alert",function(){if(a.find(".notification").length==0)a.hide()}).prependTo(a);a.show();window.scrollTo(0,0)}}})(window.jQuery,window.XRM);$(document).ready(function(){let e=$(".page_section .btn-select .dropdown-menu li a");let t=$(".navbar .btn-select .dropdown-menu li a");if(e!=null&&e.length!=0&&e.first().length!=0){e.first().attr("aria-selected",true)}if(t!=null&&t.length!=0&&t.first().length!=0){t.first().attr("aria-selected",true)}$(".dropdown-menu li a").on("focus",function(e){var t=$(e.target);t.parent().toggleClass("active",true)});$(".dropdown-menu li a").on("focusout",function(e){var t=$(e.target);t.parent().toggleClass("active",false)});$(".dropdown-submenu").on("click",function(e){$(this).toggleClass("open");var t=$(this).find("#search-filter");var a=t.attr("aria-expanded")==="true";t.attr("aria-expanded",!a);var n=$(this).find("#search-filter-blogs");var i=n.attr("aria-expanded")==="true";n.attr("aria-expanded",!i);if(!a&&t.length>0||!i&&n.length>0){var r=$(this).find(".dropdown-menu li:first-child a");r.trigger("focus")}e.stopPropagation();e.preventDefault()});$(".dropdown-menu li a").on("click",function(e){var t=$(this).parent().parent().prev().first();t.trigger("focus")});$(".dropdown-submenu > #search-filter").on("focusout",function(e){var t=$(this).attr("aria-expanded")==="true";if(!t){$(this).parent().toggleClass("open",false)}});$(".dropdown-submenu > #search-filter-blogs").on("focusout",function(e){var t=$(this).attr("aria-expanded")==="true";if(!t){$(this).parent().toggleClass("open",false)}});$(document).on("click.bs.dropdown.data-api",".dropdown form",function(e){var t=$(e.target).closest("form").find(".dropdown-submenu");t.toggleClass("open",false);var a=t.find("#search-filter");a.attr("aria-expanded",false)});$("tr td.clearfix.cell.lookup.form-control-cell .control .input-group").each(function(){$(this).attr("role","none")})});$(document).ready(function(){var e=$("div.required");var t=$('input[type="radio"]');$("#profile-dropdown").find("a").each(function(){$(this).attr("role","button")});$('li.weblink>a[title="Home"]').attr("aria-label",window.ResourceManager["Home_DefaultText"]);$("li.dropdown>a.navbar-icon").attr("title",window.ResourceManager["Search_DefaultText"]);$("label.required").next().find("input,select,textarea").each(function(){$(this).attr("aria-label",$(this).attr("title"));$(this).attr("aria-required",true)});$("li.dropdown>a.dropdown-toggle").each(function(){$(this).attr("aria-label",$(this).attr("title")).attr("aria-expanded",false).removeAttr("aria-haspopup")});$('li.dropdown>a.dropdown-toggle[role="menuitem"]').each(function(){$(this).attr("aria-haspopup",true)});$("li.weblink.dropdown>a").each(function(){$(this).attr("aria-label",$(this).attr("title"))});$('section.modal input[type="file"]').on("keydown",function(e){if(e.shiftKey&&e.keyCode==9){if($('input[type="file"]').is(":focus")){setTimeout(function(){$('section.modal textarea[name="text"]').trigger("focus")},0)}}});$("div.list-group>a").each(function(){$(this).attr("aria-label",$(this).attr("title"))});if(e!==undefined&&e!=null&&e.length>0){e.next().find('input[type="checkbox"]').each(function(){$(this).attr("aria-required",true)})}if(t!==undefined&&t!=null&&t.length>0){t.each(function(){if($(this).closest("tr")!==undefined&&$(this).closest("tr")!=null){$(this).closest("tr").attr("role","group");$(this).closest("td").attr("role","radiogroup")}})}});$(document).ready(function(){let e=$("iframe#_yuiResizeMonitor");if(e!=null&&e.length!=0){e.removeAttr("tabindex")}let t=$('.nav.weblinks a[href="'+location.pathname+'"]');if(t!=undefined&&t!=null&&t.length!=0){t.attr("aria-current","page")}});$(document).ready(function(){var e=$("select>option");$.each(e,function(e,t){if($(t).text()==""){$(t).text($(t).attr("label"))}})});portal.CompositeControl=function(e){var i=this;i.controlTrigger=e;i.$popverTriger=null;i.contentid="";i.$content=null;i.$contentInputs=null;i.valueTemplate="";i.isPopoverOpen=false;i.isEditable=false;i.showOrHidePopover=function(){if(i.isPopoverOpen){i.$popverTriger.popover("hide")}else{i.$popverTriger.popover("show");i.$popverTriger.next().removeAttr("role");i.$popverTriger.next().find("input").first().trigger("focus")}};i.updateContent=function(){var t=$("."+i.contentid).find("input");i.$contentInputs.each(function(e,n){var i=$(n).prop("id");t.each(function(e,t){var a=$(t);if(a.prop("id")==i){$(n).attr("value",a.val().trim())}})});i.updateValue()};i.updateValue=function(){if(i.isMakerRequest)return;if(!i.isEditable)return;var r=i.valueTemplate.split("{BREAK}");i.$contentInputs.each(function(e,t){var a=$(t).attr("id");var n=$.trim($("#"+$(t).attr("id")).val());for(var i=0;i<r.length;i++){r[i]=r[i].replace("{"+a+"}",n).trim()}});i.$popverTriger.val(r.join("\r\n"))};i.init=function(){i.$popverTriger=$(i.controlTrigger);i.contentid=i.$popverTriger.attr("data-content-id");i.valueTemplate=i.$popverTriger.attr("data-content-template");i.isEditable=i.$popverTriger.attr("data-editable").toLowerCase()==="true";i.isMakerRequest=i.$popverTriger.attr("data-gjs-type")!==undefined;i.$popverTriger.on("click",function(){i.showOrHidePopover()});i.$content=$("#"+i.contentid);i.$contentInputs=i.$content.find("input");i.$popverTriger.attr("readonly","true");i.updateValue();if(i.isEditable){i.$popverTriger.popover({trigger:"manual",html:true,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div role="application" class="popover-content '+i.contentid+' "></div></div>',content:function(){return $(i.$content.html())},placement:function(){return"bottom"}});i.$popverTriger.on("inserted.bs.popover",function(){var e=$("."+i.contentid);e.find("input").removeAttr("name");i.isPopoverOpen=true});i.$popverTriger.on("hide.bs.popover",function(){i.isPopoverOpen=false});i.$popverTriger.on("shown.bs.popover",function(){$("."+i.contentid+" .btn").on("click",function(){i.$popverTriger.popover("hide")})})}$("body").on("click",function(e){if(!$(i.$popverTriger).is(e.target)&&$(".popover-content").length!==0&&$(e.target).data("toggle")!=="popover"&&$(e.target).parents('[data-toggle="popover"]').length===0&&$(e.target).parents(".popover.in").length===0){i.$popverTriger.popover("hide")}if($(e.target).parents(".popover-content").length>0&&e.target.id.contains("UpdateButton")){i.updateContent()}});$("#"+i.contentid).parent().on("keydown",function(e){if(e.keyCode===13&&(i.isPopoverOpen&&e.target.id.indexOf("Button")!==-1||!i.isPopoverOpen)){if(i.isPopoverOpen&&e.target.id.indexOf("Button")!==-1){var t=true}i.showOrHidePopover();i.updateContent();if(t){var n=function(){var e=i.$popverTriger.closest("form").find(":input:visible");for(var t=0;t<e.length;t++){if(i.$popverTriger[0]==e[t]){var a=t}else if(a!=undefined){$(e[t]).trigger("focus");i.$popverTriger.off("hidden.bs.popover",n);break}}};i.$popverTriger.on("hidden.bs.popover",n)}}if(e.keyCode===27){i.$popverTriger.popover("hide");let e=i.$popverTriger;if(e!==undefined&&e.attr("data-composite-control")!==undefined&&e.attr("data-composite-control")!==false){e.focus()}}if(e.target.id.indexOf("Button")!==-1&&e.keyCode===9&&!e.shiftKey){i.$popverTriger.popover("hide")}})}};$(document).ready(function(){var e=[];$(document).on("show.bs.modal",function(){e.push(document.activeElement)});$(document).on("hidden.bs.modal",function(){$(e[e.length-1]).trigger("focus");e.pop(document.activeElement)})});$(document).ready(function(){$("*[data-composite-control]").each(function(e,t){var a=new portal.CompositeControl(t);a.init()})});$("body").on("keydown",".dropdown",function(e){var t=e.target.parentElement.parentElement;if(e.keyCode===9&&!e.shiftKey&&t!==null&&t.className.indexOf("dropdown")!==-1){if($(t).children().last().attr("class")==="active"){$(t).children().first().children().first().trigger("focus");e.preventDefault()}}var a=$(".dropdown").hasClass("open");if(e.keyCode==40&&!a){var n=$(this).find(".dropdown-menu li:first-child a");if(n.length>0){setTimeout(function(){$(n).trigger("focus")});e.preventDefault()}}});$(document).ready(function(){try{var e=$("html").attr("same-site-mode");$.cookie("timezoneoffset",(new Date).getTimezoneOffset(),{path:"/;SameSite="+e+";",secure:true});$.cookie("isDSTSupport",(new Date).hasDaylightSavingTime(),{path:"/;SameSite="+e+";",secure:true});$.cookie("isDSTObserved",moment().isDST(),{path:"/;SameSite="+e+";",secure:true});var t=$("html").attr("data-lang");if(t){$.cookie("ContextLanguageCode",t,{path:"/;SameSite="+e+";",secure:true})}var a=$(".drop_language").parents().next("ul").last()[0];if(a){var n=$("a",a);$(n).each(function(){var e=$(this).attr("data-code");if(e){$(this).on("click",function(){$.cookie("ContextLanguageCode",e,{path:"/;SameSite=Strict;",secure:true})})}})}}catch(e){}return true});$(document).ready(function(){$("section.modal").on("keydown",function(e){var t=$(this).find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]");if(t.last().is("iframe")){var a=t.last().contents().find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter(":focusable");a.last().on("keydown",function(e){if(!e.shiftKey&&e.keyCode==9){t.first().trigger("focus");e.preventDefault()}})}if(e.keyCode==9&&$(document.activeElement).closest("section.modal")[0]==$(this)[0]){if(!e.shiftKey&&$(document.activeElement)[0]==t.last()[0]){t.first().trigger("focus");e.preventDefault()}else if(e.shiftKey&&$(document.activeElement)[0]==t.first()[0]){if(t.last().is("iframe")){var n=t.last().contents().find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter(":focusable");n.last().trigger("focus")}else{t.last().trigger("focus")}e.preventDefault()}}})});portal.SetValidationSummary=function(e){if(e&&e.length>0){var t=$("#"+e);if(t.length){if(t.find("li").length>0){var a=t.find("li");var n="";for(i=0;i<a.length;i++){n=a[i].innerHTML;a[i].setAttribute("aria-label",n)}if(n&&n.length>0){t.attr("role","alert");t.attr("tabindex","0");window.setTimeout(function(){$("#"+e).trigger("focus")},100)}}}}};portal.UpdateValidationSummary=function(e){if(e&&e.length>0){var t=$("#"+e);if(t.length){if(t.find("li").length>0){t.find("ul").attr("role","presentation");$(".nav.nav-tabs.nav-account > li.active > a").removeAttr("tabindex").removeAttr("aria-selected").blur();ConvertErrorstrtoLink(e);setTimeout(function(){t.attr("tabindex","0");t.trigger("focus")},100)}}}};function ConvertErrorstrtoLink(e){var t=$("#"+e);var a=$(".form-horizontal");var l=a.find("input");t.find("li").each(function(){var r=this;var o=r.innerHTML;$.each(l,function(e,t){var a=$(t).prop("labels");if($(a).hasClass("required")){var n=$(a).text().trim();var i=$(t).attr("id");i=i?i.trim():"";if(n!=""&&typeof n!==typeof undefined&&n!==false&&(o.toLowerCase().indexOf(n.toLowerCase())>-1||o.toLowerCase().indexOf(i.toLowerCase())>-1)){$(r).empty().append('<a href="#'+i+'">'+o+"</a>");l.splice(e,1);return false}}})});if(!(t.find("a").length>0)){t.find("li").each(function(){var e=this.innerHTML;$(this).empty().append('<a href="#'+a.find(":input:enabled:visible:not([readonly]):first").attr("id")+'">'+e+"</a>")})}}$(document).ready(function(){var e=portal.IsRequestedFromMaker();if(e){$(":button").each(function(e,t){t.onclick=$.noop});$("a").each(function(e,t){t.removeAttribute("href")})}});function base64DecodeUnicode(e){return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}$(document).ready(function(){var e=$(".portal-pbi-embedded");if(e){e.each(function(e,t){var a=$(t).attr("embedconfig");portalPowerBIEmbedded(JSON.parse(base64DecodeUnicode(a)))})}});function scrollToAndFocusCapatch(e,t){var a=$(".RadCaptcha").find("input[type=text]").first();if(a!==undefined&&a!=null&&a.length>0){var t=a.attr("id");scrollToCapatchPosition(t);setCapatchFocus(t)}}function setCapatchFocus(e){if(e==null){return}var t=document.getElementById(e);if(t!=null){t.focus()}}function scrollToCapatchPosition(e){if(e==null){return}var t=document.getElementById(e);var a=t.offsetLeft;var n=t.offsetTop;var i=t.offsetParent;while(i!=null){a+=i.offsetLeft;n+=i.offsetTop;i=i.offsetParent}window.scrollTo(a,n)}function base64DecodeUnicode(e){return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))}$(document).ready(function(){var e=$(".portal-pbi-embedded");if(e){e.each(function(e,t){var a=$(t).attr("embedconfig");portalPowerBIEmbedded(JSON.parse(base64DecodeUnicode(a)))})}});$(document).ready(function(){if($(".page-header h1").length>0){var e=$(".page-header h1").text();var t=document.createElement("div");t.setAttribute("role","alert");t.setAttribute("aria-roledescription","heading");t.setAttribute("aria-label",e);t.setAttribute("class","sr-only");$(".page-header").append(t)}});portal.IsRequestedFromMaker=function(e){if(!e){var t=document.querySelector("div[data-gjs-type]");return t!==null&&t!==undefined}if(e&&e.attr("data-gjs-type")){return true}return false};portal.setValidationSummaryFocus=function(){var e=$(".validation-summary");if(e!=null&&e!=undefined&&e.is(":visible")){var t=$(".validation-header");e.removeAttr("role");t.attr("role","none");e.attr("tabindex","0");e.trigger("focus");e.find("ul").attr("role","presentation")}};portal.addRoleOnCheckboxLabel=function(e){$(e).each(function(e,t){$(t).attr("role","none")})};$(document).ready(function(){if($(".entity-form").length>0){$(".entity-form").each(function(e){if($(".entity-form")[e].hasAttribute("readonly")){var t=$(".entity-form")[e].querySelectorAll(".lookup[readonly], .picklist[readonly], .MultiSelectPicklist[readonly]");if(t.length>0){t.forEach(function(e){e.closest(".control").setAttribute("tabindex","0")})}}})}if($("tr td .datetime")){if($("div .info").hasClass("required")){$("input.form-control.input-text-box").attr("aria-required","true")}}});